Ext.define("Com.GatotKaca.ERP.module.Personal.controller.OverTime",{extend:"Com.GatotKaca.ERP.module.Personal.controller.OverTimeBase",views:["Com.GatotKaca.ERP.module.Personal.view.OverTime"],store:"Com.GatotKaca.ERP.module.Personal.store.OverTime",fmSelector:"formprovertime",startDate:"prOtFilterFrom",endDate:"prOtFilterTo",init:function(){var b=this;var a=b.getStore(b.store);a.addListener("load",b.onOtLoad,b);b.loadStore(a);b.getStore("Com.GatotKaca.ERP.store.Hour");b.getStore("Com.GatotKaca.ERP.store.Minute");b.getStore("Com.GatotKaca.ERP.store.Agreement");b.control({"formprovertime button[action=reset]":{click:b.resetForm},"formprovertime button[action=save]":{click:b.save},"gridprovertime button[action=refresh]":{click:b.filter},"gridprovertime menu > menuitem[action=preview]":{click:b.preview},"gridprovertime menu > menuitem[action=pdf]":{click:b.exportPDF},"gridprovertime menu > menuitem[action=xls]":{click:b.exportXLS},"gridprovertime menu > menuitem[action=image]":{click:b.exportJPG},"gridprovertime datefield[name=prOtFilterFrom]":{change:b.filter},"gridprovertime datefield[name=prOtFilterTo]":{change:b.filter},gridprovertime:{select:b.viewDetail}});b.callParent(arguments)},onOtLoad:function(c,a,d){this.operationCheck(d);Ext.getCmp("PersonalOtTotal").update("");var b=Ext.getCmp("gridprovertime").total;b=0;Ext.each(a,function(e,f){if(e.data.ot_isapprove===true){b+=e.data.ot_real}});Ext.getCmp("PersonalOtTotal").update("Total : "+this.formatNumber(b)+" hours")},viewDetail:function(d,c,g,a,b,f){var e=this.getForm(this.fmSelector);this.ajaxRequest(BASE_URL+"human_resources/overtime/viewdetail",{ot_id:c.data.ot_id},function(h){e.setValues(h.data[0]);var j=h.data[0].ot_start.split(":");var i=h.data[0].ot_end.split(":");e.findField("ot_start_h").setValue(j[0]);e.findField("ot_start_m").setValue(j[1]);e.findField("ot_end_h").setValue(i[0]);e.findField("ot_end_m").setValue(i[1])})},preview:function(b,a,d){var c=this;c.exportValid(function(f,e){c.ajaxRequest(BASE_URL+"human_resources/overtime/preview",{from:f,to:e},function(g){c.showWindow({html:g.data},"Print Preview","70%","90%","icon-page_white_magnify")})})},exportPDF:function(b,a,c){this.exportValid(function(e,d){window.open(BASE_URL+"human_resources/overtime/export/pdf/"+e+"/"+d)})},exportXLS:function(b,a,c){this.exportValid(function(e,d){window.open(BASE_URL+"human_resources/overtime/export/excel/"+e+"/"+d)})},exportJPG:function(b,a,c){this.exportValid(function(e,d){window.open(BASE_URL+"human_resources/overtime/export/jpg/"+e+"/"+d)})},exportValid:function(d){var a=this;var c=Ext.Date.format(Ext.getCmp(a.startDate).getValue(),DATE_FORMAT);var b=Ext.Date.format(Ext.getCmp(a.endDate).getValue(),DATE_FORMAT);if(c==""){c=FILTER_START;b=FILTER_END}if(d&&typeof(d)==="function"){d(c,b)}}});