Ext.define("Com.GatotKaca.ERP.module.Personal.controller.Profile",{extend:"Com.GatotKaca.ERP.controller.Base",views:["Com.GatotKaca.ERP.module.Personal.view.Profile"],store:"Com.GatotKaca.ERP.module.Personal.store.Profile",fmSelector:"formprprofile",init:function(){var b=this;var a=b.getStore(b.store);b.getStore("Com.GatotKaca.ERP.module.Personal.store.Company");b.getStore("Com.GatotKaca.ERP.module.Personal.store.Religion");b.getStore("Com.GatotKaca.ERP.module.Personal.store.Country");b.getStore("Com.GatotKaca.ERP.module.Personal.store.Citizen");b.getStore("Com.GatotKaca.ERP.module.Personal.store.JobStatus");b.getStore("Com.GatotKaca.ERP.module.Personal.store.JobTitle");b.getStore("Com.GatotKaca.ERP.module.Personal.store.Supervisor");b.getStore("Com.GatotKaca.ERP.module.Personal.store.Department");b.getStore("Com.GatotKaca.ERP.module.Personal.store.OfficeHour");b.getStore("Com.GatotKaca.ERP.module.Personal.store.Province");b.getStore("Com.GatotKaca.ERP.module.Personal.store.District");b.getStore("Com.GatotKaca.ERP.module.Personal.store.BODPlace");b.getStore("Com.GatotKaca.ERP.module.Personal.store.Qualification");b.getStore("Com.GatotKaca.ERP.module.Personal.store.Family");b.getStore("Com.GatotKaca.ERP.module.Personal.store.Experience");b.getStore("Com.GatotKaca.ERP.module.Personal.store.Training");b.getStore("Com.GatotKaca.ERP.module.Personal.store.Language");b.getStore("Com.GatotKaca.ERP.module.Personal.store.Organitation");a.addListener("load",b.initData,b);b.loadStore(a);b.getStore("Com.GatotKaca.ERP.store.Year");b.getStore("Com.GatotKaca.ERP.store.Gender");b.getStore("Com.GatotKaca.ERP.store.MaritalStatus");b.getStore("Com.GatotKaca.ERP.store.BloodType");b.getStore("Com.GatotKaca.ERP.store.Level");b.control({tabprprofile:{tabchange:b.loadTab}});b.callParent(arguments)},loadTab:function(c,a,f,b){var d=this;var e=d.getForm(d.fmSelector).findField("employee_id").getValue();if(a.id!=this.fmSelector){if(a.store!==undefined){d.loadStoreInfo(a.store,e)}}},loadStoreInfo:function(a,b){this.loadStore(a,{employee_id:b})},initData:function(d,a,e){var d=this;d.operationCheck(e);Ext.getCmp("phofile_photo").getEl().dom.src=PROFILEPATH+a[0].data.employee_photo;var c=d.getForm(d.fmSelector);c.getFields().each(function(f){f.setReadOnly(true)});c.setValues(a[0].data);d.getDepartmentByCompany(a[0].data.employee_company,a[0].data.employee_department);d.getDistrictById("Com.GatotKaca.ERP.module.Personal.store.BODPlace",a[0].data.employee_bodplace,function(){c.findField("employee_bodplace").setValue(a[0].data.employee_bodplace)});d.loadStore("Com.GatotKaca.ERP.module.Personal.store.Country",{query:a[0].data.employee_countryname},function(){c.findField("employee_country").setValue(a[0].data.employee_country)});d.loadStore("Com.GatotKaca.ERP.module.Personal.store.Citizen",{query:a[0].data.employee_citizenname},function(){c.findField("employee_citizen").setValue(a[0].data.employee_citizen)});d.loadStore("Com.GatotKaca.ERP.module.Personal.store.OfficeHour",{query:a[0].data.employee_officehourname},function(){c.findField("employee_officehour").setValue(a[0].data.employee_officehour)});d.loadStore("Com.GatotKaca.ERP.module.Personal.store.Company",{query:a[0].data.employee_companyname},function(){c.findField("employee_company").setValue(a[0].data.employee_company)});d.loadStore("Com.GatotKaca.ERP.module.Personal.store.Religion",{query:a[0].data.employee_religionname},function(){c.findField("employee_religion").setValue(a[0].data.employee_religion)});d.loadStore("Com.GatotKaca.ERP.module.Personal.store.JobStatus",{query:a[0].data.employee_jobstatusname},function(){c.findField("employee_jobstatus").setValue(a[0].data.employee_jobstatus)});d.getJobTitle(a[0].data.employee_jobtitlename,a[0].data.employee_jobtitle);d.getEmployeeByJobTitle(a[0].data.employee_jobtitle,a[0].data.employee_supervisor);d.getProvinceByCountry(a[0].data.employee_country,a[0].data.employee_paddress);d.getDistrictByProvince(a[0].data.employee_paddress,a[0].data.employee_daddress);var b="Until";if(a[0].data.employee_ispermenent){b="Promote"}d.selectStatus(b)},selectStatus:function(a){this.getForm(this.fmSelector).findField("employee_end").setFieldLabel(REQUIRED+a)},getDepartmentByCompany:function(a,c){var d=this;var b=d.getStore("Com.GatotKaca.ERP.module.Personal.store.Department");d.loadStore(b,{company_id:a},function(){d.getForm(d.fmSelector).findField("employee_department").setValue(c)})},getDistrictById:function(a,c,d){var a=Ext.getStore(a);var b=this;a.setProxy({type:"ajax",api:{read:BASE_URL+"district/getbyid"},actionMethods:{read:"POST"},reader:{type:"json",root:"data",successProperty:"success"}});b.loadStore(a,{district_id:c},function(){if(d&&typeof(d)==="function"){d()}})},getEmployeeByJobTitle:function(a,b){var c=this;c.loadStore("Com.GatotKaca.ERP.module.Personal.store.Supervisor",{jobtitle_id:a},function(){var d=c.getForm(c.fmSelector).findField("employee_supervisor");d.setValue(b)})},getJobTitle:function(b,c){var a=this;a.loadStore("Com.GatotKaca.ERP.module.Personal.store.JobTitle",{query:b},function(){var d=a.getForm(a.fmSelector).findField("employee_jobtitle");d.setValue(c)})},getProvinceByCountry:function(c,a){var b=this;b.loadStore("Com.GatotKaca.ERP.module.Personal.store.Province",{country_id:c},function(){b.getForm(b.fmSelector).findField("employee_province").setValue(a)})},getDistrictByProvince:function(a,c){var b=this;b.loadStore("Com.GatotKaca.ERP.module.Personal.store.District",{province_id:a},function(){b.getForm(b.fmSelector).findField("employee_disctrict").setValue(c)})}});