Ext.define("GatotKacaErp.module.Personal.controller.Profile",{extend:"GatotKacaErp.controller.Base",views:["GatotKacaErp.module.Personal.view.Profile"],store:"GatotKacaErp.module.Personal.store.Profile",fmSelector:"formprprofile",init:function(){var b=this;var a=b.getStore(b.store);b.getStore("GatotKacaErp.module.Personal.store.Qualification");b.getStore("GatotKacaErp.module.Personal.store.Family");b.getStore("GatotKacaErp.module.Personal.store.Experience");b.getStore("GatotKacaErp.module.Personal.store.Training");b.getStore("GatotKacaErp.module.Personal.store.Language");b.getStore("GatotKacaErp.module.Personal.store.Organitation");a.addListener("load",b.initData,b);b.loadStore(a);b.getStore("GatotKacaErp.store.Company").load();b.getStore("GatotKacaErp.store.OfficeHour").load();b.getStore("GatotKacaErp.store.Religion").load();b.getStore("GatotKacaErp.store.Country").load();b.getStore("GatotKacaErp.store.JobTitle").load();b.getStore("GatotKacaErp.store.JobStatus").load();b.getStore("GatotKacaErp.store.Employee");b.getStore("GatotKacaErp.store.Year");b.getStore("GatotKacaErp.store.Department");b.getStore("GatotKacaErp.store.OfficeHour");b.getStore("GatotKacaErp.store.Gender");b.getStore("GatotKacaErp.store.Province");b.getStore("GatotKacaErp.store.District");b.getStore("GatotKacaErp.store.BODPlace");b.getStore("GatotKacaErp.store.BloodType");b.getStore("GatotKacaErp.store.MaritalStatus");b.getStore("GatotKacaErp.store.Level");b.control({tabprprofile:{tabchange:b.loadTab}});b.callParent(arguments)},loadTab:function(c,a,f,b){var d=this;var e=d.getForm(d.fmSelector).findField("employee_id").getValue();if(a.id!=this.fmSelector){if(a.store!==undefined){d.loadStoreInfo(a.store,e)}}},loadStoreInfo:function(a,b){this.loadStore(a,{employee_id:b})},initData:function(d,a,e){var d=this;d.operationCheck(e);Ext.getCmp("phofile_photo").getEl().dom.src=PROFILEPATH+a[0].data.employee_photo;var c=d.getForm(d.fmSelector);c.getFields().each(function(f){f.setReadOnly(true)});c.setValues(a[0].data);d.getDepartmentByCompany(a[0].data.employee_company,a[0].data.employee_department);d.getDistrictById("GatotKacaErp.store.BODPlace",a[0].data.employee_bodplace,function(){c.findField("employee_bodplace").setValue(a[0].data.employee_bodplace)});d.getEmployeeByJobTitle(a[0].data.employee_jobtitle,a[0].data.employee_supervisor);d.getProvinceByCountry(a[0].data.employee_country,a[0].data.employee_paddress);d.getDistrictByProvince(a[0].data.employee_paddress,a[0].data.employee_daddress);var b="Until";if(a[0].data.employee_ispermenent){b="Promote"}d.selectStatus(b)},selectStatus:function(a){this.getForm(this.fmSelector).findField("employee_end").setFieldLabel(REQUIRED+a)},getDepartmentByCompany:function(a,c){var d=this;var b=d.getStore("GatotKacaErp.store.Department");d.loadStore(b,{company_id:a},function(){d.getForm(d.fmSelector).findField("employee_department").setValue(c)})},getDistrictById:function(a,c,d){var a=Ext.getStore(a);var b=this;a.setProxy({type:"ajax",api:{read:BASE_URL+"district/getbyid"},actionMethods:{read:"POST"},reader:{type:"json",root:"data",successProperty:"success"}});b.loadStore(a,{district_id:c},function(){if(d&&typeof(d)==="function"){d()}})},getEmployeeByJobTitle:function(a,b){var c=this;c.loadStore("GatotKacaErp.store.Employee",{jobtitle_id:a},function(){var d=c.getForm(c.fmSelector).findField("employee_supervisor");d.setValue(b)})},getProvinceByCountry:function(c,a){var b=this;b.loadStore("GatotKacaErp.store.Province",{country_id:c},function(){b.getForm(b.fmSelector).findField("employee_province").setValue(a)})},getDistrictByProvince:function(a,c){var b=this;b.loadStore("GatotKacaErp.store.District",{province_id:a},function(){b.getForm(b.fmSelector).findField("employee_disctrict").setValue(c)})}});