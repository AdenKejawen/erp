Ext.define("GatotKacaErp.module.HumanResources.controller.WorkShift",{extend:"GatotKacaErp.controller.Base",views:["GatotKacaErp.module.HumanResources.view.WorkShift"],store:"GatotKacaErp.module.HumanResources.store.WorkShift",fmSelector:"formworkshift",startDate:"workshiftFilterFrom",endDate:"workshiftFilterTo",init:function(){var b=this;var a=b.getStore(b.store);a.addListener("load",b.onStoreLoad,b);b.loadStore(a);b.getStore("GatotKacaErp.store.OfficeHour").load();b.getStore("GatotKacaErp.module.HumanResources.store.Shiftment");b.control({"gridworkshift textfield[action=search]":{keypress:b.search},"gridworkshift button[action=refresh]":{click:b.reloadStore},gridworkshift:{itemclick:b.viewDetail},"formworkshift button[action=save]":{click:b.save},"formworkshift button[action=reset]":{click:b.resetForm},gridshiftment:{itemclick:b.viewShiftment},"gridshiftment datefield[name=workshiftFilterFrom]":{change:b.filter},"gridshiftment datefield[name=workshiftFilterTo]":{change:b.filter}});b.callParent(arguments)},search:function(d,a,c){var b=this;if(a.ENTER==a.getKey()){this.loadStore(b.store,{query:d.getValue()})}},reloadStore:function(){this.loadStore(this.store)},viewDetail:function(b,e,j,h,i,a){var c=this.getForm(this.fmSelector);c.findField("employee_id").setValue(e.data.employee_id);var d=new Date();var g=new Date(d.getFullYear(),d.getMonth(),1);var f=new Date(d.getFullYear(),d.getMonth()+1,0);this.doFilter(e.data.employee_id,g,f);this.resetForm()},save:function(b,a,e){var d=this;var c=d.getForm(d.fmSelector);if(c.findField("employee_id").getValue()!=""){if(c.isValid()){d.ajaxRequest(BASE_URL+"human_resources/employee/saveshiftment",{shiftment:Ext.JSON.encode(c.getValues())},function(f){d.showMessage({title:"SERVER MESSAGE",msg:f.msg,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});var g=new Date();var i=new Date(g.getFullYear(),g.getMonth(),1);var h=new Date(g.getFullYear(),g.getMonth()+1,0);d.doFilter(c.findField("employee_id").getValue(),i,h);d.resetForm()})}else{d.showMessage({title:"ERROR MESSAGE",msg:"Form is not valid",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}}else{d.showMessage({title:"ERROR MESSAGE",msg:"Employee must be selected",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}},resetForm:function(d,b,f){var e=this.getForm(this.fmSelector);var c=e.findField("employee_id");var a=c.getValue();e.reset();c.setValue(a)},filter:function(b,a,e){var d=this;var c=b.up("form").getForm();var f=c.findField("employee_id").getValue();var h=Ext.Date.format(Ext.getCmp(d.startDate).getValue(),"Y-m-d");var g=Ext.Date.format(Ext.getCmp(d.endDate).getValue(),"Y-m-d");if(f!=""){if(h!=""&&g!=""){d.doFilter(f,h,g)}}},doFilter:function(a,c,b){this.loadStore("GatotKacaErp.module.HumanResources.store.Shiftment",{employee_id:a,from:c,to:b})}});