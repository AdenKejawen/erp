Ext.define("Com.GatotKaca.ERP.module.HumanResources.controller.Employee",{extend:"Com.GatotKaca.ERP.controller.Base",views:["Com.GatotKaca.ERP.module.HumanResources.view.Employee"],store:"Com.GatotKaca.ERP.module.HumanResources.store.Employee",fmSelector:"formemployee",init:function(){var b=this;var a=b.getStore(b.store);a.addListener("load",b.onStoreLoad,b);b.loadStore(a);b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Company");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.OfficeHour");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Religion");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Education");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.FamilyEducation");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.JobStatus");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.LanguageList");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Country");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Citizen");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.JobTitle");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Department");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Province");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.District");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.BODPlace");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.EducationDistrict");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.TrainingDistrict");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Supervisor");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Qualification");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Family");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Experience");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Training");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Language");b.getStore("Com.GatotKaca.ERP.module.HumanResources.store.Organitation");b.getStore("Com.GatotKaca.ERP.store.Family");b.getStore("Com.GatotKaca.ERP.store.Year");b.getStore("Com.GatotKaca.ERP.store.Gender");b.getStore("Com.GatotKaca.ERP.store.Level");b.getStore("Com.GatotKaca.ERP.store.BloodType");b.getStore("Com.GatotKaca.ERP.store.MaritalStatus");b.control({"gridemployee textfield[action=search]":{keypress:b.search},"gridemployee button[action=refresh]":{click:b.reloadStore},gridemployee:{itemclick:b.viewDetail},"formemployee combo[action=company]":{select:b.selectedCompany},"formemployee combo[action=country]":{select:b.selectedCountry},"formemployee combo[action=citizen]":{select:b.selectedCitizen},"formemployee combo[action=province]":{select:b.selectedProvince},"formemployee combo[action=status]":{select:b.selectedStatus},"formemployee combo[action=jobtitle]":{select:b.selectedJobtitle},"formemployee button[action=save]":{click:b.save},"formemployee button[action=reset]":{click:b.resetForm},tabemployee:{tabchange:b.loadTab},"formqualification button[action=save]":{click:b.saveEducation},"formqualification button[action=reset]":{click:b.resetEducation},gridqualification:{itemclick:b.viewEducation,itemcontextmenu:b.showContextMenu},"formfamily button[action=save]":{click:b.saveFamily},"formfamily button[action=reset]":{click:b.resetFamily},gridfamily:{itemclick:b.viewFamily,itemcontextmenu:b.showContextMenu},"formexperience button[action=save]":{click:b.saveExperience},"formexperience button[action=reset]":{click:b.resetExperience},gridexperience:{itemclick:b.viewExperience,itemcontextmenu:b.showContextMenu},"formtraining button[action=save]":{click:b.saveTraining},"formtraining button[action=reset]":{click:b.resetTraining},gridtraining:{itemclick:b.viewTraining,itemcontextmenu:b.showContextMenu},"formlanguageskill button[action=save]":{click:b.saveLanguage},"formlanguageskill button[action=reset]":{click:b.resetLanguage},gridlanguageskill:{itemclick:b.viewLanguage,itemcontextmenu:b.showContextMenu},"formorganitation button[action=save]":{click:b.saveOrganitation},"formorganitation button[action=reset]":{click:b.resetOrganitation},gridorganitation:{itemclick:b.viewOrganitation,itemcontextmenu:b.showContextMenu}});b.callParent(arguments)},viewEducation:function(d,c,h,a,b,g){var f=this;var e=f.getForm("formqualification");f.ajaxRequest(BASE_URL+"human_resources/employee/geteducationbyid",{education_id:c.data.education_id},function(i){e.setValues(i.data[0]);f.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.EducationDistrict",{query:i.data[0].response.data[0].education_districtname},function(){e.findField("education_district").setValue(i.data[0].response.data[0].education_district)})})},viewFamily:function(d,c,h,a,b,g){var f=this;var e=f.getForm("formfamily");f.ajaxRequest(BASE_URL+"human_resources/employee/getfamilybyid",{family_id:c.data.family_id},function(i){e.setValues(i.data[0])})},viewExperience:function(d,c,h,a,b,g){var f=this;var e=f.getForm("formexperience");f.ajaxRequest(BASE_URL+"human_resources/employee/getexperiencebyid",{experience_id:c.data.experience_id},function(i){e.setValues(i.data[0])})},viewTraining:function(d,c,h,a,b,g){var f=this;var e=f.getForm("formtraining");f.ajaxRequest(BASE_URL+"human_resources/employee/gettrainingbyid",{training_id:c.data.training_id},function(i){e.setValues(i.data[0]);f.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.TrainingDistrict",{query:i.data[0].training_district},function(j){e.findField("training_district").setValue(j.data[0].district_id)})})},viewLanguage:function(d,c,h,a,b,g){var f=this;var e=f.getForm("formlanguageskill");f.ajaxRequest(BASE_URL+"human_resources/employee/getlanguagebyid",{language_id:c.data.language_id},function(i){e.setValues(i.data[0])})},viewOrganitation:function(d,c,h,a,b,g){var f=this;var e=f.getForm("formorganitation");f.ajaxRequest(BASE_URL+"human_resources/employee/getorganitationbyid",{organitation_id:c.data.org_id},function(i){e.setValues(i.data[0])})},search:function(d,a,c){var b=this;if(a.ENTER==a.getKey()){b.loadStore(b.store,{query:d.getValue()})}},reloadStore:function(){this.loadStore(this.store)},viewDetail:function(d,c,h,a,b,g){var f=this;var e=f.getForm(f.fmSelector);f.ajaxRequest(BASE_URL+"human_resources/employee/getbyid",{employee_id:c.data.employee_id},function(i){Ext.getCmp("employee_photo").getEl().dom.src=PROFILEPATH+i.data[0].employee_photo;e.setValues(i.data[0]);var k=f.activeTab("tabemployee");if(k.store!==undefined){f.loadStoreInfo(k.store,i.data[0].employee_id)}f.disabled(true);f.getDepartmentByCompany(i.data[0].employee_company,i.data[0].employee_department);f.getJobTitle(i.data[0].employee_jobtitlename,i.data[0].employee_jobtitle);f.getEmployeeByJobTitle(i.data[0].employee_jobtitle,i.data[0].employee_supervisor);f.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.Country",{query:i.data[0].employee_countryname},function(){e.findField("employee_country").setValue(i.data[0].employee_country)});f.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.Citizen",{query:i.data[0].employee_citizenname},function(){e.findField("employee_citizen").setValue(i.data[0].employee_citizen)});f.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.OfficeHour",{query:i.data[0].employee_officehourname},function(){e.findField("employee_officehour").setValue(i.data[0].employee_officehour)});f.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.Company",{query:i.data[0].employee_companyname},function(){e.findField("employee_company").setValue(i.data[0].employee_company)});f.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.BODPlace",{query:i.data[0].employee_bodplacename},function(){e.findField("employee_bodplace").setValue(i.data[0].employee_bodplace)});f.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.Religion",{query:i.data[0].employee_religionname},function(){e.findField("employee_religion").setValue(i.data[0].employee_religion)});f.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.JobStatus",{query:i.data[0].employee_jobstatusname},function(){e.findField("employee_jobstatus").setValue(i.data[0].employee_jobstatus)});f.getProvinceByCountry(i.data[0].employee_country,i.data[0].employee_paddress);f.getDistrictByProvince(i.data[0].employee_paddress,i.data[0].employee_daddress);f.selectEmployee(i.data[0].employee_id);var j="Until";if(i.data[0].employee_ispermenent){j="Promote"}f.selectStatus(j)})},saveEducation:function(b,a,e){var d=this;var c=b.up("form").getForm();if(c.isValid()){d.ajaxRequest(BASE_URL+"human_resources/employee/saveeducation",{education:Ext.JSON.encode(c.getValues())},function(f){d.showMessage({title:"SERVER MESSAGE",msg:f.msg,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});d.resetEducation(b,a,e)})}else{d.showMessage({title:"ERROR MESSAGE",msg:"Form is not valid",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}},resetEducation:function(b,a,c){this.resetFormInfo(b,a,c)},saveFamily:function(b,a,e){var d=this;var c=b.up("form").getForm();if(c.isValid()){d.ajaxRequest(BASE_URL+"human_resources/employee/savefamily",{family:Ext.JSON.encode(c.getValues())},function(f){d.showMessage({title:"SERVER MESSAGE",msg:f.msg,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});d.resetFamily(b,a,e)})}else{d.showMessage({title:"ERROR MESSAGE",msg:"Form is not valid",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}},resetFamily:function(b,a,c){this.resetFormInfo(b,a,c)},saveExperience:function(b,a,e){var d=this;var c=b.up("form").getForm();if(c.isValid()){d.ajaxRequest(BASE_URL+"human_resources/employee/saveexperience",{experience:Ext.JSON.encode(c.getValues())},function(f){d.showMessage({title:"SERVER MESSAGE",msg:f.msg,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});d.resetExperience(b,a,e)})}else{d.showMessage({title:"ERROR MESSAGE",msg:"Form is not valid",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}},resetExperience:function(b,a,c){this.resetFormInfo(b,a,c)},saveTraining:function(b,a,e){var d=this;var c=b.up("form").getForm();if(c.isValid()){d.ajaxRequest(BASE_URL+"human_resources/employee/savetraining",{training:Ext.JSON.encode(c.getValues())},function(f){d.showMessage({title:"SERVER MESSAGE",msg:f.msg,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});d.resetTraining(b,a,e)})}else{d.showMessage({title:"ERROR MESSAGE",msg:"Form is not valid",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}},resetTraining:function(b,a,c){this.resetFormInfo(b,a,c)},saveLanguage:function(b,a,e){var d=this;var c=b.up("form").getForm();if(c.isValid()){d.ajaxRequest(BASE_URL+"human_resources/employee/savelanguage",{language:Ext.JSON.encode(c.getValues())},function(f){d.showMessage({title:"SERVER MESSAGE",msg:f.msg,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});d.resetLanguage(b,a,e)})}else{d.showMessage({title:"ERROR MESSAGE",msg:"Form is not valid",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}},resetLanguage:function(b,a,c){this.resetFormInfo(b,a,c)},saveOrganitation:function(b,a,e){var d=this;var c=b.up("form").getForm();if(c.isValid()){d.ajaxRequest(BASE_URL+"human_resources/employee/saveorganitation",{organitation:Ext.JSON.encode(c.getValues())},function(f){d.showMessage({title:"SERVER MESSAGE",msg:f.msg,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});d.resetOrganitation(b,a,e)})}else{d.showMessage({title:"ERROR MESSAGE",msg:"Form is not valid",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}},resetOrganitation:function(b,a,c){this.resetFormInfo(b,a,c)},selectedCompany:function(d,a,b){var c=this.getForm(this.fmSelector).findField("employee_code");c.setValue(a[0].data.company_code+".");c.focus();this.getDepartmentByCompany(a[0].data.company_id)},selectedCountry:function(c,a,b){this.getProvinceByCountry(a[0].data.country_id)},selectedCitizen:function(c,a,b){var d=this.getForm(this.fmSelector).findField("employee_country");this.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.Country",{query:a[0].data.country_name},function(){d.setValue(a[0].data.country_id)});this.getProvinceByCountry(a[0].data.country_id)},selectedProvince:function(c,a,b){this.getDistrictByProvince(a[0].data.province_id)},selectedJobtitle:function(d,a,b){var c=this.getForm(this.fmSelector).findField("employee_supervisor");this.setLevel(a[0].data.level);this.getEmployeeByJobTitle(a[0].data.jobtitle_id)},selectedStatus:function(d,a,c){var b="Until";if(a[0].data.jobstatus_ispermanent){b="Promote"}this.selectStatus(b)},save:function(c,a,f){var e=this;var d=c.up("form").getForm();var g=d.findField("employee_supervisor");var b=e.getStore("Com.GatotKaca.ERP.module.HumanResources.store.JobTitle");b=b.findRecord("jobtitle_id",d.findField("employee_jobtitle").getValue());b=b.data;if(b.level!==1){g.allowBlank=false;g.validateValue(g.getValue())}if(d.isValid()){d.submit({url:BASE_URL+"human_resources/employee/save",waitMsg:"Saving Employee...",submitEmptyText:false,success:function(h,i){e.showMessage({title:"MESSAGE",msg:i.result.msg,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});e.getStore(e.store).removeAll();e.reloadStore();e.resetForm()},failure:function(h,i){if(i.failureType===Ext.form.action.Action.CONNECT_FAILURE){e.showMessage({title:"MESSAGE",msg:"Connection failure",icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK})}if(i.failureType===Ext.form.action.Action.SERVER_INVALID){e.showMessage({title:"MESSAGE",msg:i.result.msg,icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK})}}})}else{e.showMessage({title:"ERROR MESSAGE",msg:"Form is not valid",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}},resetForm:function(){this.getForm(this.fmSelector).reset();this.selectEmployee(null);this.selectStatus("Until");this.disabled(false);Ext.getCmp("employee_photo").getEl().dom.src=DEFAULT_PROFILE},loadTab:function(c,a,f,b){var d=this;var e=a.getForm().findField("employee_id").getValue();if(a.id!=this.fmSelector){if(e!=""){if(a.store!==undefined){d.loadStoreInfo(a.store,e)}}else{c.setActiveTab(f);d.showMessage({title:"ERROR MESSAGE",msg:"Employee must be selected",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}}},disabled:function(b){var a=this.getForm(this.fmSelector);a.findField("employee_code").setReadOnly(b);a.findField("employee_company").setReadOnly(b);a.findField("employee_department").setReadOnly(b);a.findField("employee_start").setReadOnly(b);a.findField("employee_username").setReadOnly(b);a.findField("employee_jobtitle").setReadOnly(b);a.findField("employee_supervisor").setReadOnly(b);a.findField("employee_jobstatus").setReadOnly(b);a.findField("employee_end").setReadOnly(b)},getDepartmentByCompany:function(a,b){var c=this;c.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.Department",{company_id:a},function(){c.getForm(c.fmSelector).findField("employee_department").setValue(b)})},getProvinceByCountry:function(c,a){var b=this;b.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.Province",{country_id:c},function(){b.getForm(b.fmSelector).findField("employee_province").setValue(a)})},getDistrictByProvince:function(a,c){var b=this;b.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.District",{province_id:a},function(){b.getForm(b.fmSelector).findField("employee_disctrict").setValue(c)})},getEmployeeByJobTitle:function(a,b){var c=this;c.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.Supervisor",{jobtitle_id:a},function(){var d=c.getForm(c.fmSelector).findField("employee_supervisor");d.setValue(b)})},getJobTitle:function(b,c){var a=this;a.loadStore("Com.GatotKaca.ERP.module.HumanResources.store.JobTitle",{query:b},function(){var d=a.getForm(a.fmSelector).findField("employee_jobtitle");d.setValue(c)})},selectEmployee:function(a){this.getForm(this.fmSelector).findField("employee_id").setValue(a);this.getForm("formqualification").findField("employee_id").setValue(a);this.getForm("formfamily").findField("employee_id").setValue(a);this.getForm("formexperience").findField("employee_id").setValue(a);this.getForm("formtraining").findField("employee_id").setValue(a);this.getForm("formlanguageskill").findField("employee_id").setValue(a);this.getForm("formorganitation").findField("employee_id").setValue(a)},selectStatus:function(a){this.getForm(this.fmSelector).findField("employee_end").setFieldLabel(REQUIRED+a)},loadStoreInfo:function(a,b){this.loadStore(a,{employee_id:b})},resetFormInfo:function(c,a,f){var e=c.up("form");var b=e.store;e=e.getForm();var d=e.findField("employee_id").getValue();this.loadStoreInfo(b,d);e.reset();e.findField("employee_id").setValue(d)},setLevel:function(b){var a=this.getForm(this.fmSelector).findField("employee_supervisor");if(b===1){a.setValue(null);a.setReadOnly(true);a.allowBlank=true}else{a.setReadOnly(false);a.allowBlank=false}}});