Ext.define("Com.GatotKaca.ERP.module.Utilities.controller.Role",{extend:"Com.GatotKaca.ERP.controller.Base",views:["Com.GatotKaca.ERP.module.Utilities.view.Role"],store:"Com.GatotKaca.ERP.module.Utilities.store.Role",fmSelector:"formrole",init:function(){var b=this;var a=b.getStore(b.store);a.addListener("load",b.onStoreLoad,b);b.loadStore(a,{status:"all"});b.getStore("Com.GatotKaca.ERP.module.Utilities.store.GroupRole");b.control({"gridusergroup textfield[action=search]":{keypress:b.searchGroup},"gridusergroup button[action=refresh]":{click:b.reloadStore},gridusergroup:{itemclick:b.viewDetail},"gridgrouprole button[action=save]":{click:b.updateRole},"gridgrouprole button[action=refresh]":{click:b.reloadRole}});b.callParent(arguments)},searchGroup:function(d,a,c){var b=this;if(a.ENTER==a.getKey()){b.loadStore(b.store,{query:d.getValue(),status:"all"})}},reloadStore:function(){this.loadStore(this.store,{status:"all"})},viewDetail:function(d,c,g,a,b,f){var e=this;var h=Ext.ComponentQuery.query("#idGroup");h[0].setValue(c.data.group_id);e.loadStore("Com.GatotKaca.ERP.module.Utilities.store.GroupRole",{group_id:c.data.group_id})},updateRole:function(b,j,a){var g=this;var h=g.getStore("Com.GatotKaca.ERP.module.Utilities.store.GroupRole");var c=h.getRange(0,h.getCount());var e=new Array();for(var f=0;f<c.length;f++){var d=c[f];if(d.dirty==true){e.push(d.data)}}if(e.length>0){g.ajaxRequest(BASE_URL+"utilities/role/update",{role:Ext.JSON.encode(e)},function(i){g.showMessage({title:"SERVER MESSAGE",msg:i.msg,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});g.getStore(g.store).removeAll();g.reloadStore();g.reloadRole();g.reloadMenu()})}},reloadRole:function(c,a,e){var d=this;var f=Ext.ComponentQuery.query("#idGroup");var b=f[0].getValue();if(b!=""){d.loadStore("Com.GatotKaca.ERP.module.Utilities.store.GroupRole",{group_id:b})}}});