Ext.define("Com.GatotKaca.ERP.module.Utilities.controller.User",{extend:"Com.GatotKaca.ERP.controller.Base",views:["Com.GatotKaca.ERP.module.Utilities.view.User"],store:"Com.GatotKaca.ERP.module.Utilities.store.User",fmSelector:"formuser",init:function(){var b=this;var a=b.getStore(b.store);a.addListener("load",b.onStoreLoad,b);b.loadStore(a,{status:"all"});b.getStore("Com.GatotKaca.ERP.module.Utilities.store.UserRole");b.getStore("Com.GatotKaca.ERP.store.Group");b.control({"griduser textfield[action=search]":{keypress:b.search},"griduser button[action=refresh]":{click:b.reloadStore},griduser:{itemclick:b.viewDetail},"formuser button[action=save]":{click:b.save}});b.callParent(arguments)},search:function(d,a,c){var b=this;if(a.ENTER==a.getKey()){b.loadStore(b.store,{query:d.getValue(),status:"all"})}},reloadStore:function(){this.loadStore(this.store,{status:"all"})},viewDetail:function(d,c,h,a,b,g){var f=this;var e=f.getForm(f.fmSelector);f.ajaxRequest(BASE_URL+"utilities/user/getbyid",{user_id:c.data.user_id,table:c.data.table},function(i){e.setValues(i.data[0]);f.loadStore("Com.GatotKaca.ERP.store.Group",{query:i.data[0].group_name},function(){e.findField("group_name").setValue(i.data[0].group_id)});f.loadStore("Com.GatotKaca.ERP.module.Utilities.store.UserRole",{group_id:i.data[0].group_id})})},save:function(c,a,f){var e=this;var d=c.up("form").getForm();var b=d.findField("npassword");var g=b.getValue();if(!d.findField("user_status").getValue()&&d.findField("user_online").getValue()){e.showMessage({title:"ERROR MESSAGE",msg:"The user is online. Are you sure to continue?",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.YESNO},function(j,h,i){if(j=="yes"){e.statusChange(d)}})}else{e.statusChange(d)}},extraMessage:function(b){var a=this;if(!b.findField("user_status").getValue()&&b.findField("user_online").getValue()){a.showMessage({title:"NOTIFICATION MESSAGE",msg:"The user is online. Are you sure to continue?",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.YESNO},function(e,c,d){if(e=="yes"){a.statusChange(b)}})}else{a.statusChange(b)}},statusChange:function(b){var a=this;a.ajaxRequest(BASE_URL+"utilities/user/update",{user:Ext.JSON.encode(b.getValues())},function(c){a.showMessage({title:"SERVER MESSAGE",msg:c.msg,minWidth:199,minHeight:127,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});a.getStore(a.store).removeAll();a.reloadStore();a.getStore("Com.GatotKaca.ERP.module.Utilities.store.UserRole").removeAll();b.reset()})}});