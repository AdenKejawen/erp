Ext.define("Com.GatotKaca.ERP.module.GeneralSetup.controller.JobTitle",{extend:"Com.GatotKaca.ERP.controller.Base",views:["Com.GatotKaca.ERP.module.GeneralSetup.view.JobTitle"],store:"Com.GatotKaca.ERP.module.GeneralSetup.store.JobTitle",fmSelector:"formjobtitle",init:function(){var b=this;var a=b.getStore(b.store);a.addListener("load",b.onStoreLoad,b);b.loadStore(a);a=b.getStore("Com.GatotKaca.ERP.store.JobByLevel");b.getStore("Com.GatotKaca.ERP.store.JobLevel");b.control({"formjobtitle button[action=reset]":{click:b.resetForm},"formjobtitle button[action=save]":{click:b.save},"formjobtitle combo[action=level]":{select:b.selectLevel},"gridjobtitle  button[action=refresh]":{click:b.reloadStore},"gridjobtitle textfield[action=search]":{keypress:b.search},gridjobtitle:{itemclick:b.viewDetail,itemcontextmenu:b.showContextMenu}});b.callParent(arguments)},reloadStore:function(){this.loadStore(this.store)},viewDetail:function(d,c,h,a,b,g){var f=this;var e=f.getForm(f.fmSelector);f.ajaxRequest(BASE_URL+"jobtitle/getbyid",{jobtitle_id:c.data.jobtitle_id},function(i){e.setValues(i.data[0]);f.loadStore("Com.GatotKaca.ERP.store.JobLevel",{query:i.data[0].jobtitle_levelname},function(){e.findField("jobtitle_level").setValue(i.data[0].jobtitle_level)});f.loadStore("Com.GatotKaca.ERP.store.JobByLevel",{level:i.data[0].jobtitle_level},function(){e.findField("jobtitle_parent").setValue(i.data[0].jobtitle_parent)})})},save:function(b,a,e){var d=this;var c=b.up("form").getForm();if(c.isValid()){d.ajaxRequest(BASE_URL+"jobtitle/save",{jobtitle:Ext.JSON.encode(c.getValues())},function(f){d.showMessage({title:"SERVER MESSAGE",msg:f.msg,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});d.getStore(d.store).removeAll();d.reloadStore();d.resetForm()})}else{d.showMessage({title:"ERROR MESSAGE",msg:"Form is not valid",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}},search:function(d,a,c){var b=this;if(a.ENTER==a.getKey()){b.loadStore(b.store,{query:d.getValue()})}},resetForm:function(){this.getForm(this.fmSelector).reset()},selectLevel:function(d,a,b){var c=d.up("form").getForm();if(a[0].data.joblevel_level===1){c.findField("jobtitle_parent").setReadOnly(true)}else{c.findField("jobtitle_parent").setReadOnly(false);this.loadStore("Com.GatotKaca.ERP.store.JobByLevel",{level:a[0].data.joblevel_id})}}});