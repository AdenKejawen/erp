Ext.define("GatotKacaErp.module.GeneralSetup.controller.Company",{extend:"GatotKacaErp.controller.Base",views:["GatotKacaErp.module.GeneralSetup.view.Company"],store:"GatotKacaErp.module.GeneralSetup.store.Company",fmSelector:"formcompany",init:function(){var b=this;var a=b.getStore(b.store);b.getStore("GatotKacaErp.store.Company").load();b.getStore("GatotKacaErp.store.Day");b.getStore("GatotKacaErp.module.GeneralSetup.store.Division");a.addListener("load",b.onStoreLoad,b);b.loadStore(a);b.control({"formcompany button[action=reset]":{click:b.resetForm},"formcompany button[action=save]":{click:b.save},"gridcompany  button[action=refresh]":{click:b.reloadStore},"gridcompany textfield[action=search]":{keypress:b.search},gridcompany:{itemclick:b.viewDetail,itemcontextmenu:b.showContextMenu}});b.callParent(arguments)},reloadStore:function(){this.loadStore(this.store)},search:function(d,a,c){var b=this;if(a.ENTER==a.getKey()){b.loadStore(b.store,{query:d.getValue()})}},viewDetail:function(d,c,g,a,b,f){var e=this.getForm(this.fmSelector);this.ajaxRequest(BASE_URL+"company/getbyid",{company_id:c.data.company_id},function(h){e.setValues(h.data[0]);e.findField("company_code").setReadOnly(true)});this.loadStore("GatotKacaErp.module.GeneralSetup.store.Division",{company_id:c.data.company_id})},save:function(d,l,a){var j=this;var c=d.up("form").getForm();var b=c.findField("company_id").getValue();var h=new Array();if(b!==""&&b!==null){var k=j.getStore("GatotKacaErp.module.GeneralSetup.store.Division");var e=k.getRange(0,k.getCount());for(var g=0;g<e.length;g++){var f=e[g];if(f.dirty==true){h.push(f.data)}}k.removeAll()}if(c.isValid()){j.ajaxRequest(BASE_URL+"company/save",{company:Ext.JSON.encode(c.getValues()),division:Ext.JSON.encode(h)},function(i){j.showMessage({title:"SERVER MESSAGE",msg:i.msg,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});j.getStore(j.store).removeAll();j.reloadStore();j.resetForm()})}else{j.showMessage({title:"ERROR MESSAGE",msg:"Form is not valid",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}},resetForm:function(){var a=this.getForm(this.fmSelector);a.reset();a.findField("company_code").setReadOnly(false);this.getStore("GatotKacaErp.module.GeneralSetup.store.Division").removeAll()}});