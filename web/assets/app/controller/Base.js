Ext.define("GatotKacaErp.controller.Base",{extend:"Ext.app.Controller",views:["GatotKacaErp.view.ContextMenu"],init:function(){var a=this;a.control({"#deleteItem":{click:a.deleteItem}});a.callParent(arguments)},getForm:function(a){return Ext.getCmp(a).getForm()},operationCheck:function(a){if(!a){this.showMessage({title:"SERVER MESSAGE",msg:"Unknow Error. Contact your IT Division please",icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK})}return true},onStoreLoad:function(b,a,c){if(this.operationCheck(c)){return true}},loadStore:function(a,d,e){var c=this;if(!(a instanceof Ext.data.Store)){a=c.getStore(a)}var b={};if(d){b.params=d}if(e&&typeof(e)==="function"){b.callback=function(g,f,h){if(c.operationCheck(h)){e(g)}}}else{b.callback=function(g,f,h){c.operationCheck(h)}}a.load(b)},showMessage:function(a,b){if(b&&typeof(b)==="function"){Ext.MessageBox.show({title:a.title,msg:a.msg,minWidth:199,minHeight:127,icon:a.icon,buttons:a.buttons,fn:function(e,c,d){b(e,c,d)}})}else{Ext.MessageBox.show({title:a.title,msg:a.msg,minWidth:199,minHeight:127,icon:a.icon,buttons:a.buttons})}},ajaxRequest:function(a,c,d){var b=this;Ext.getBody().mask("Please Wait...","x-mask-loading");Ext.Ajax.request({url:a,method:"POST",params:c,success:function(e){var f=Ext.JSON.decode(e.responseText);if(!f.success){if(f.hasOwnProperty("redirect")){window.location=f.redirect}else{b.showMessage({title:"ERROR MESSAGE",msg:f.msg,icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK});Ext.getBody().unmask()}}else{if(d&&typeof(d)==="function"){Ext.getBody().unmask();d(f)}}},failure:function(e,f){Ext.getBody().unmask();b.showMessage({title:"SERVER MESSAGE",msg:"Unknow Error. Contact your IT Division please",icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK})}})},showWindow:function(d,f,c,a,b){var e=Ext.create("Ext.window.Window",{title:f,frame:true,modal:true,autoScroll:true,modal:true,iconCls:b,width:c,height:a});e.add(d);e.show()},showContextMenu:function(c,b,e,f,a){var d=Ext.getCmp("contextMenu");if(d===undefined){d=Ext.create("GatotKacaErp.view.ContextMenu")}d.setData(b.data,c.store);d.showAt(a.getX(),a.getY())},reloadMenu:function(){this.getStore("GatotKacaErp.store.TreeStore").load()},activeTab:function(a){var b=Ext.getCmp(a);return b.getActiveTab()},resetProxy:function(a,b){a=Ext.getStore(a);a.setProxy({type:"ajax",api:{read:b},actionMethods:{read:"POST"},reader:{type:"json",root:"data",successProperty:"success"}})},deleteItem:function(){var c=this;var b=Ext.getCmp("contextMenu");var a=b.getRecord();c.showMessage({title:"NOTIFICATION MESSAGE",msg:"Are you sure to delete "+a[b.getInitial()]+"?",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.YESNO},function(f,d,e){if(f=="yes"){c.ajaxRequest(b.getProxy(),{id:a[b.getPrimary()]},function(g){c.showMessage({title:"SERVER MESSAGE",msg:g.msg,icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK});c.loadStore(b.getStore())})}})}});