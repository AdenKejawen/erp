Ext.define("GatotKacaErp.controller.Login",{extend:"Ext.app.Controller",views:["GatotKacaErp.view.Login"],init:function(){this.control({"loginform button[action=login]":{click:this.loginProses},"loginform textfield[action=forceLogin]":{keypress:this.forceLogin}})},loginProses:function(b,g,a){var f=b.up("window");var c=f.down("form");var d=c.getValues();if(c.getForm().isValid()){this.login(d.username,d.password)}else{Ext.MessageBox.show({title:"ERROR MESSAGE",msg:"Username and Password are required.",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}},forceLogin:function(d,a,c){if(a.ENTER==a.getKey()){var b=d.up("form");var e=b.getValues();if(b.getForm().isValid()){this.login(e.username,e.password)}else{Ext.MessageBox.show({title:"ERROR MESSAGE",msg:"Username and Password are required.",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}}},login:function(b,a){Ext.Ajax.request({url:BASE_URL+"auth",params:{username:b,password:a,client_id:SECRET_KEY},method:"POST",success:function(c){var c=Ext.JSON.decode(c.responseText);if(c.success){window.location=c.redirect}else{Ext.MessageBox.show({title:"ERROR MESSAGE",msg:c.message,icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}},failure:function(c){Ext.MessageBox.show({title:"ERROR MESSAGE",msg:"Unknow Error. Please reload page.",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK})}})}});