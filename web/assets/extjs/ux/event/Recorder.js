Ext.define("Ext.ux.event.Recorder",function(){function a(c,b){return c.x==b.x&&c.y==b.y}return{extend:"Ext.ux.event.Driver",eventsToRecord:function(){var c={kind:"keyboard",modKeys:true,key:true,bubbles:true},b={kind:"mouse",button:true,modKeys:true,xy:true,bubbles:true};return{keydown:c,keypress:c,keyup:c,mousemove:b,mouseover:b,mouseout:b,click:b,mousedown:b,mouseup:b,scroll:{kind:"misc",bubbles:false}}}(),ignoreIdRegEx:/ext-gen(?:\d+)/,constructor:function(b){var d=this,c=b&&b.eventsToRecord;if(c){d.eventsToRecord=Ext.apply(Ext.apply({},d.eventsToRecord),c);delete b.eventsToRecord}d.callParent(arguments);d.addEvents("add","coalesce");d.clear();d.modKeys=[];d.attachTo=d.attachTo||window},clear:function(){this.eventsRecorded=[]},coalesce:function(g){var e=this,c=e.eventsRecorded,d=c.length,b=d&&c[d-1],f;if(!b){return false}if(g.type=="mousemove"){if(b.type=="mousemove"&&g.ts-b.ts<200){g.ts=b.ts;c[d-1]=g;return true}}else{if(g.type=="click"){if(d>=2&&b.type=="mouseup"&&(f=c[d-2]).type=="mousedown"){if(g.button==b.button&&g.button==f.button&&g.target==b.target&&g.target==f.target&&a(g,b)&&a(g,f)){c.pop();f.type="mduclick";return true}}}}return false},getElementXPath:function(f){var i=this,h=false,c=[],g,e,d,b;for(d=f;d;d=d.parentNode){if(d==i.attachTo.document.body){c.unshift("~");h=true;break}if(d.id&&!i.ignoreIdRegEx.test(d.id)){c.unshift("#"+d.id);h=true;break}for(g=1,e=d;!!(e=e.previousSibling);){if(e.tagName==d.tagName){++g}}b=d.tagName.toLowerCase();if(g<2){c.unshift(b)}else{c.unshift(b+"["+g+"]")}}return h?c.join("/"):null},getRecordedEvents:function(){return this.eventsRecorded},onDomInsert:function(b,c){this.watchTree(c)},onDomRemove:function(b,c){this.unwatchTree(c)},onEvent:function(h){var d=this,g=d.eventsToRecord[h.type],c,j,b,i={type:h.type,ts:d.getTimestamp(),target:d.getElementXPath(h.target)},f;if(!i.target){return}c=h.target.ownerDocument;c=c.defaultView||c.parentWindow;if(c!==d.attachTo){return}if(g.xy){f=h.getXY();if(i.target){b=Ext.fly(h.getTarget()).getXY();f[0]-=b[0];f[1]-=b[1]}i.x=f[0];i.y=f[1]}if(g.button){i.button=h.button}if(g.wheel){i.wheel=h.getWheelDelta()}if(g.modKeys){d.modKeys[0]=h.altKey?"A":"";d.modKeys[1]=h.ctrlKey?"C":"";d.modKeys[2]=h.metaKey?"M":"";d.modKeys[3]=h.shiftKey?"S":"";j=d.modKeys.join("");if(j){i.modKeys=j}}if(g.key){i.charCode=h.getCharCode();i.keyCode=h.getKey()}if(d.coalesce(i)){d.fireEvent("coalesce",d,i)}else{d.eventsRecorded.push(i);d.fireEvent("add",d,i)}},onStart:function(){var f=this,d={DOMNodeInserted:f.onDomInsert,DOMNodeRemoved:f.onDomRemove,scope:f},e=(f.nonBubbleEvents={}),g=f.attachTo.Ext.dd.DragDropManager,c=f.attachTo.Ext.EventObjectImpl.prototype;f.watchingNodes={};Ext.Object.each(f.eventsToRecord,function(h,i){if(i){if(i.bubbles){d[h]=f.onEvent}else{e[h]=i}}});f.ddmStopEvent=g.stopEvent;g.stopEvent=Ext.Function.createSequence(g.stopEvent,function(h){f.onEvent(h)});f.evStopEvent=c.stopEvent;c.stopEvent=Ext.Function.createSequence(c.stopEvent,function(){f.onEvent(this)});var b=f.attachTo.Ext.getBody();b.on(d);f.watchTree(b.dom)},onStop:function(){var c=this,b=c.attachTo.Ext.getBody();Ext.Object.each(c.eventsToRecord,function(d,e){if(e){b.un(d,c.onEvent,c)}});c.attachTo.Ext.dd.DragDropManager.stopEvent=c.ddmStopEvent;c.attachTo.Ext.EventObjectImpl.prototype.stopEvent=c.evStopEvent;c.unwatchTree(b.dom)},watchTree:function(c){if(c.nodeType!=1){return}var e=this,f=(c.tagName=="BODY")?"$":c.id,d=e.watchingNodes;if(f&&!d[f]){var b={scope:e};Ext.Object.each(e.nonBubbleEvents,function(g,h){if(h){b[g]=e.onEvent}});e.attachTo.Ext.fly(c).on(b);d[f]=true;console.log("watch "+c.tagName+"#"+f)}Ext.each(c.childNodes,e.watchTree,e)},unwatchTree:function(b){if(b.nodeType!=1){return}var d=this,e=(b.tagName=="BODY")?"$":b.id,c=d.watchingNodes;if(e&&!c[e]){Ext.Object.each(d.nonBubbleEvents,function(f,g){d.attachTo.Ext.fly(b).un(f,d.onEvent,d)});delete c[e];console.log("unwatch "+b.tagName+"#"+e)}Ext.each(b.childNodes,d.unwatchTree,d)}}}());