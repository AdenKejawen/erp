Ext.define("Ext.ux.TreePicker",{extend:"Ext.form.field.Picker",xtype:"treepicker",triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",config:{store:null,displayField:null,columns:null,selectOnTab:true,maxPickerHeight:300,minPickerHeight:100},editable:false,initComponent:function(){var a=this;a.callParent(arguments);a.addEvents("select");a.store.on("load",a.onLoad,a)},createPicker:function(){var c=this,b=Ext.create("Ext.tree.Panel",{store:c.store,floating:true,hidden:true,displayField:c.displayField,columns:c.columns,maxHeight:c.maxTreeHeight,shadow:false,manageHeight:false,listeners:{itemclick:Ext.bind(c.onItemClick,c)},viewConfig:{listeners:{render:function(d){d.getEl().on("keypress",c.onPickerKeypress,c)}}}}),a=b.getView();a.on("render",c.setPickerViewStyles,c);if(Ext.isIE9&&Ext.isStrict){a.on({scope:c,highlightitem:c.repaintPickerView,unhighlightitem:c.repaintPickerView,afteritemexpand:c.repaintPickerView,afteritemcollapse:c.repaintPickerView})}return b},setPickerViewStyles:function(a){a.getEl().setStyle({"min-height":this.minPickerHeight+"px","max-height":this.maxPickerHeight+"px"})},repaintPickerView:function(){var a=this.picker.getView().getEl().dom.style;a.display=a.display},alignPicker:function(){var b=this,a;if(b.isExpanded){a=b.getPicker();if(b.matchFieldWidth){a.setWidth(b.bodyEl.getWidth())}if(a.isFloating()){b.doAlign()}}},onItemClick:function(b,a,c,f,d){this.selectItem(a)},onPickerKeypress:function(c,b){var a=c.getKey();if(a===c.ENTER||(a===c.TAB&&this.selectOnTab)){this.selectItem(this.picker.getSelectionModel().getSelection()[0])}},selectItem:function(a){var b=this;b.setValue(a.getId());b.picker.hide();b.inputEl.focus();b.fireEvent("select",b,a)},onExpand:function(){var c=this,b=c.picker,a=b.store,d=c.value;if(d){b.selectPath(a.getNodeById(d).getPath())}else{b.getSelectionModel().select(a.getRootNode())}Ext.defer(function(){b.getView().focus()},1)},setValue:function(c){var b=this,a;b.value=c;if(b.store.loading){return b}a=c?b.store.getNodeById(c):b.store.getRootNode();if(c===undefined){a=b.store.getRootNode();b.value=a.getId()}else{a=b.store.getNodeById(c)}b.setRawValue(a?a.get(b.displayField):"");return b},getSubmitValue:function(){return this.value},getValue:function(){return this.value},onLoad:function(){var a=this.value;if(a){this.setValue(a)}}});