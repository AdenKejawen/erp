Ext.define("Ext.ux.TreePicker",{extend:"Ext.form.field.Picker",xtype:"treepicker",uses:["Ext.tree.Panel"],triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",config:{store:null,displayField:null,columns:null,selectOnTab:true,maxPickerHeight:300,minPickerHeight:100},editable:false,initComponent:function(){var a=this;a.callParent(arguments);a.addEvents("select");a.mon(a.store,{scope:a,load:a.onLoad,update:a.onUpdate})},createPicker:function(){var c=this,b=new Ext.tree.Panel({shrinkWrapDock:2,store:c.store,floating:true,displayField:c.displayField,columns:c.columns,minHeight:c.minPickerHeight,maxHeight:c.maxPickerHeight,manageHeight:false,shadow:false,listeners:{scope:c,itemclick:c.onItemClick},viewConfig:{listeners:{scope:c,render:c.onViewRender}}}),a=b.getView();if(Ext.isIE9&&Ext.isStrict){a.on({scope:c,highlightitem:c.repaintPickerView,unhighlightitem:c.repaintPickerView,afteritemexpand:c.repaintPickerView,afteritemcollapse:c.repaintPickerView})}return b},onViewRender:function(a){a.getEl().on("keypress",this.onPickerKeypress,this)},repaintPickerView:function(){var a=this.picker.getView().getEl().dom.style;a.display=a.display},alignPicker:function(){var b=this,a;if(b.isExpanded){a=b.getPicker();if(b.matchFieldWidth){a.setWidth(b.bodyEl.getWidth())}if(a.isFloating()){b.doAlign()}}},onItemClick:function(b,a,c,f,d){this.selectItem(a)},onPickerKeypress:function(c,b){var a=c.getKey();if(a===c.ENTER||(a===c.TAB&&this.selectOnTab)){this.selectItem(this.picker.getSelectionModel().getSelection()[0])}},selectItem:function(a){var b=this;b.setValue(a.getId());b.picker.hide();b.inputEl.focus();b.fireEvent("select",b,a)},onExpand:function(){var d=this,b=d.picker,a=b.store,e=d.value,c;if(e){c=a.getNodeById(e)}if(!c){c=a.getRootNode()}b.selectPath(c.getPath());Ext.defer(function(){b.getView().focus()},1)},setValue:function(c){var b=this,a;b.value=c;if(b.store.loading){return b}a=c?b.store.getNodeById(c):b.store.getRootNode();if(c===undefined){a=b.store.getRootNode();b.value=a.getId()}else{a=b.store.getNodeById(c)}b.setRawValue(a?a.get(b.displayField):"");return b},getSubmitValue:function(){return this.value},getValue:function(){return this.value},onLoad:function(){var a=this.value;if(a){this.setValue(a)}},onUpdate:function(a,e,b,c){var d=this.displayField;if(b==="edit"&&c&&Ext.Array.contains(c,d)&&this.value===e.getId()){this.setRawValue(e.get(d))}}});