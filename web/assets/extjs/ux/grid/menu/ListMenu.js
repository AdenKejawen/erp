Ext.define("Ext.ux.grid.menu.ListMenu",{extend:"Ext.menu.Menu",idField:"id",labelField:"text",loadingText:"Loading...",loadOnShow:true,single:false,showSeparator:false,constructor:function(b){var e=this,c,d,a,f;e.selected=[];e.addEvents("checkchange");e.callParent([b=b||{}]);if(!b.store&&b.options){c=[];for(d=0,a=b.options.length;d<a;d++){f=b.options[d];switch(Ext.type(f)){case"array":c.push(f);break;case"object":c.push([f[e.idField],f[e.labelField]]);break;case"string":c.push([f,f]);break}}e.store=Ext.create("Ext.data.ArrayStore",{fields:[e.idField,e.labelField],data:c,listeners:{load:e.onLoad,scope:e}});e.loaded=true;e.autoStore=true}else{e.add({text:e.loadingText,iconCls:"loading-indicator"});e.store.on("load",e.onLoad,e)}},destroy:function(){var b=this,a=b.store;if(a){if(b.autoStore){a.destroyStore()}else{a.un("unload",b.onLoad,b)}}b.callParent()},show:function(){if(this.loadOnShow&&!this.loaded&&!this.store.loading){this.store.load()}this.callParent()},onLoad:function(c,b){var g=this,f,h,d,a,e={checkchange:g.checkChange,scope:g};this.suspendLayouts();g.removeAll(true);f=g.single?Ext.id():null;for(d=0,a=b.length;d<a;d++){h=b[d].get(g.idField);g.add(Ext.create("Ext.menu.CheckItem",{text:b[d].get(g.labelField),group:f,checked:Ext.Array.contains(g.selected,h),hideOnClick:false,value:h,listeners:e}))}g.loaded=true;this.resumeLayouts(true);g.fireEvent("load",g,b)},getSelected:function(){return this.selected},setSelected:function(a){a=this.selected=[].concat(a);if(this.loaded){this.items.each(function(d){d.setChecked(false,true);for(var c=0,b=a.length;c<b;c++){if(d.value==a[c]){d.setChecked(true,true)}}},this)}},checkChange:function(b,a){var c=[];this.items.each(function(d){if(d.checked){c.push(d.value)}},this);this.selected=c;this.fireEvent("checkchange",b,a)}});