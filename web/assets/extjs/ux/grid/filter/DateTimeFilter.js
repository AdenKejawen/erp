Ext.define("Ext.ux.grid.filter.DateTimeFilter",{extend:"Ext.ux.grid.filter.DateFilter",alias:"gridfilter.datetime",dateDefaults:{xtype:"datepicker",format:"m/d/Y"},timeDefaults:{xtype:"timepicker",width:100,height:200,format:"g:i A"},dockDefaults:{dock:"top",buttonText:"Filter"},selectDateToFilter:true,positionDatepickerFirst:true,reTime:/\s(am|pm)/i,reItemId:/\w*-(\w*)$/,addTimeSelection:function(c,k){var h=this,l=k.getSelectionModel().getSelection(),b,g,j,a,e=0,f=[],d=["setHours","setMinutes","setSeconds","setMilliseconds"];if(l.length){b=l[0].get("disp");f=b.replace(h.reTime,"").split(":");for(g=f.length;e<g;e++){j=d[e];a=f[e];if(a){c[j](parseInt(a,10))}}}return c},init:function(b){var l=this,a=Ext.applyIf(l.date||{},l.dateDefaults),n=Ext.applyIf(l.time||{},l.timeDefaults),d=l.dock,c={click:{scope:l,click:l.onMenuSelect},select:{scope:l,select:l.onMenuSelect}},j,f,h,m,g,k=[a,n],e=0;if(!l.positionDatepickerFirst){k=k.reverse();e=1}j=Ext.apply(l.pickerOpts,{xtype:!d?"container":"panel",layout:"hbox",items:k});if(!d){if(l.selectDateToFilter){a.listeners=c.select}else{n.listeners=c.select}}else{if(d){l.selectDateToFilter=null;if(d.dockedItems){j.dockedItems=d.dockedItems;j.dockedItems.items[d.bindToItem||0].listeners=c.click}else{if(Ext.isBoolean(d)){d={}}d=Ext.applyIf(d,l.dockDefaults);j.dockedItems={xtype:"toolbar",dock:d.dock,items:[{xtype:"button",text:d.buttonText,flex:1,listeners:c.click}]}}}}l.fields={};for(f=0,h=l.menuItems.length;f<h;f++){m=l.menuItems[f];if(m!=="-"){j.items[e].itemId=m;g={itemId:"range-"+m,text:l[m+"Text"],menu:Ext.create("Ext.menu.Menu",{items:j}),listeners:{scope:l,checkchange:l.onCheckChange}};m=l.fields[m]=Ext.create("Ext.menu.CheckItem",g)}l.menu.add(m)}l.values={}},onCheckChange:function(e,d){var c=this,h=e.menu,b=h.down("timepicker"),f=h.down("datepicker"),g=f.itemId,a=c.values;if(d){a[g]=c.addTimeSelection(f.value,b)}else{delete a[g]}c.setActive(c.isActivatable());c.fireEvent("update",c)},onMenuSelect:function(d,c){var e=this,g=e.menu,b=g.getFocusEl().itemId.replace(e.reItemId,"$1"),a=e.fields,f;d=g.queryById(b);f=e.fields[d.itemId];f.setChecked(true);if(f==a.on){a.before.setChecked(false,true);a.after.setChecked(false,true)}else{a.on.setChecked(false,true);if(f==a.after&&e.getFieldValue("before")<c){a.before.setChecked(false,true)}else{if(f==a.before&&e.getFieldValue("after")>c){a.after.setChecked(false,true)}}}e.fireEvent("update",e);d.ownerCt.ownerCt.hide()},getSerialArgs:function(){var d=this,c,a=d.fields,b=[];for(c in a){if(a[c].checked){b.push({type:"datetime",comparison:d.compareMap[c],value:Ext.Date.format(d.getFieldValue(c),(d.date.format||d.dateDefaults.format)+" "+(d.time.format||d.timeDefaults.format))})}}return b},setValue:function(f,c){var d=this,a=d.fields,b,g,e;for(b in a){g=f[b];if(g){e=d.menu.down('datepicker[itemId="'+b+'"]');e.update(g);e.value=g;a[b].setChecked(true)}else{if(!c){a[b].setChecked(false)}}}d.fireEvent("update",d)},validateRecord:function(a){var c=this,b,e,d=a.get(c.dataIndex);if(!Ext.isDate(d)){return false}d=d.getTime();for(b in c.fields){if(c.fields[b].checked){e=c.getFieldValue(b).getTime();if(b=="before"&&e<=d){return false}if(b=="after"&&e>=d){return false}if(b=="on"&&e!=d){return false}}}return true}});