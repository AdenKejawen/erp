Ext.define("Ext.ux.util.PDF.TextLayerBuilder",{textLayerDiv:null,constructor:function(a){this.textLayerDiv=a.textLayerDiv},beginLayout:function(){this.textDivs=[];this.textLayerQueue=[]},endLayout:function(){var h=this,i=h.textDivs,g=h.textLayerDiv,a=null,j=false,k=0,d=500,b=document.createElement("canvas"),l=b.getContext("2d");function c(){if(i.length===0){clearInterval(a);j=true;h.textLayerDiv=g=b=l=null;return}var o=i.shift();if(o.dataset.textLength>0){g.appendChild(o);if(o.dataset.textLength>1){l.font=o.style.fontSize+" sans-serif";var p=l.measureText(o.textContent).width;var n=o.dataset.canvasWidth/p;var q=(function(){if("result" in arguments.callee){return arguments.callee.result}var r=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/;var t=document.getElementsByTagName("script")[0];for(var s in t.style){if(r.test(s)){return arguments.callee.result=s.match(r)[0]}}if("WebkitOpacity" in t.style){return arguments.callee.result="Webkit"}if("KhtmlOpacity" in t.style){return arguments.callee.result="Khtml"}return arguments.callee.result=""})();var m=Ext.get(o);m.setStyle(q+"-transform","scale("+n+", 1)");m.setStyle(q+"-transformOrigin","0% 0%")}}}a=setInterval(c,k);var f=null;function e(){if(j){window.removeEventListener("scroll",e,false);return}clearInterval(a);clearTimeout(f);f=setTimeout(function m(){a=setInterval(c,k)},d)}window.addEventListener("scroll",e,false)},appendText:function(e,c,d){var a=document.createElement("div");var b=d*e.geom.vScale;a.dataset.canvasWidth=e.canvasWidth*e.geom.hScale;a.dataset.fontName=c;a.style.fontSize=b+"px";a.style.left=e.geom.x+"px";a.style.top=(e.geom.y-b)+"px";a.textContent=PDFJS.bidi(e,-1);a.dir=e.direction;a.dataset.textLength=e.length;this.textDivs.push(a)}});