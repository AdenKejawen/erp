Ext.define("Ext.grid.feature.Summary",{extend:"Ext.grid.feature.AbstractSummary",alias:"feature.summary",dock:undefined,dockedSummaryCls:Ext.baseCSSPrefix+"docked-summary",panelBodyCls:Ext.baseCSSPrefix+"summary-",init:function(b){var d=this,a=d.view,c=a.tableTpl;d.callParent(arguments);if(d.dock){b.headerCt.on({afterlayout:d.onStoreUpdate,scope:d});d.grid.on({beforerender:function(){d.summaryBar=d.grid.addDocked({childEls:["innerCt"],renderTpl:'<div id="{id}-innerCt"><table class="'+Ext.baseCSSPrefix+'grid-table"><tr class="'+d.summaryRowCls+'"></tr></table></div>',style:"overflow:hidden",itemId:"summaryBar",cls:[d.dockedSummaryCls,d.dockedSummaryCls+"-"+d.dock],xtype:"component",dock:d.dock,weight:10000000})[0]},afterrender:function(){d.grid.body.addCls(d.panelBodyCls+d.dock);d.view.mon(d.view.el,{scroll:d.onViewScroll,scope:d});d.onStoreUpdate()},single:true});d.grid.headerCt.afterComponentLayout=Ext.Function.createSequence(d.grid.headerCt.afterComponentLayout,function(){d.summaryBar.innerCt.setWidth(this.getFullWidth()+Ext.getScrollbarSize().width)})}else{while(c.nextTpl){c=c.nextTpl}c.renderTFoot=d.renderTFoot}d.grid.on({columnmove:d.onStoreUpdate,scope:d});d.view.mon(d.view.store,{update:d.onStoreUpdate,datachanged:d.onStoreUpdate,scope:d})},renderTFoot:function(b,c){var a=b.view,d=a.findFeature("summary");c.push("<tfoot>");d.outputSummaryRecord(d.createSummaryRecord(a),b,c);c.push("</tfoot>")},vetoEvent:function(a,c,d,b){return !b.getTarget(this.summaryRowSelector)},onViewScroll:function(){this.summaryBar.el.dom.scrollLeft=this.view.el.dom.scrollLeft},createSummaryRecord:function(a){var d=a.headerCt.getVisibleGridColumns(),g={records:a.store.getRange()},f=d.length,c,e,b=this.summaryRecord||(this.summaryRecord=new a.store.model(null,a.id+"-summary-record"));b.beginEdit();for(c=0;c<f;c++){e=d[c];if(!e.dataIndex){e.dataIndex=e.id}b.set(e.dataIndex,this.getSummary(a.store,e.summaryType,e.dataIndex,g))}b.endEdit(true);b.commit(true);b.isSummary=true;return b},onStoreUpdate:function(){var d=this,a=this.createSummaryRecord(this.view),c=d.view.createRowElement(a,-1),b,e;if(d.dock){b=d.summaryBar.el.down("."+d.summaryRowCls,true)}else{b=d.view.getNode(a)}e=b.parentNode;e.insertBefore(c,b);e.removeChild(b);if(d.lockingPartner&&d.lockingPartner.grid.rendered&&!d.calledFromLockingPartner){d.lockingPartner.calledFromLockingPartner=true;d.lockingPartner.onStoreUpdate();d.lockingPartner.calledFromLockingPartner=false}if(d.dock){d.onColumnHeaderLayout()}},onColumnHeaderLayout:function(){var b=this.view,d=b.headerCt.getGridColumns(),f,a=d.length,c,g=this.summaryBar.el,e;for(c=0;c<a;c++){f=d[c];e=g.down(b.getCellSelector(f));if(e){if(f.hidden){e.setDisplayed(false)}else{e.setDisplayed(true);e.setWidth(f.width||(f.lastBox?f.lastBox.width:100))}}}}});