Ext.define("Ext.grid.plugin.HeaderResizer",{extend:"Ext.AbstractPlugin",requires:["Ext.dd.DragTracker","Ext.util.Region"],alias:"plugin.gridheaderresizer",disabled:false,config:{dynamic:false},colHeaderCls:Ext.baseCSSPrefix+"column-header",minColWidth:40,maxColWidth:1000,wResizeCursor:"col-resize",eResizeCursor:"col-resize",init:function(a){this.headerCt=a;a.on("render",this.afterHeaderRender,this,{single:true})},destroy:function(){if(this.tracker){this.tracker.destroy()}},afterHeaderRender:function(){var b=this.headerCt,a=b.el;b.mon(a,"mousemove",this.onHeaderCtMouseMove,this);this.tracker=new Ext.dd.DragTracker({disabled:this.disabled,onBeforeStart:Ext.Function.bind(this.onBeforeStart,this),onStart:Ext.Function.bind(this.onStart,this),onDrag:Ext.Function.bind(this.onDrag,this),onEnd:Ext.Function.bind(this.onEnd,this),tolerance:3,autoStart:300,el:a})},onHeaderCtMouseMove:function(b,j){var d=this,a,h,i,f,c,g;if(d.headerCt.dragging){if(d.activeHd){d.activeHd.el.dom.style.cursor="";delete d.activeHd}}else{h=b.getTarget("."+d.colHeaderCls,3,true);if(h){i=Ext.getCmp(h.id);if(i.isOnLeftEdge(b)){f=i.previousNode("gridcolumn:not([hidden]):not([isGroupHeader])");if(f){g=d.headerCt.up("tablepanel");c=f.up("tablepanel");if(!((c===g)||((g.ownerCt.isXType("tablepanel"))&&g.ownerCt.view.lockedGrid===c))){f=null}}}else{if(i.isOnRightEdge(b)){f=i}else{f=null}}if(f){if(f.isGroupHeader){a=f.getGridColumns();f=a[a.length-1]}if(f&&!(f.fixed||(f.resizable===false)||d.disabled)){d.activeHd=f;i.el.dom.style.cursor=d.eResizeCursor;if(i.triggerEl){i.triggerEl.dom.style.cursor=d.eResizeCursor}}}else{i.el.dom.style.cursor="";if(i.triggerEl){i.triggerEl.dom.style.cursor=""}d.activeHd=null}}}},onBeforeStart:function(a){this.dragHd=this.activeHd;if(!!this.dragHd&&!this.headerCt.dragging){this.tracker.constrainTo=this.getConstrainRegion();return true}else{this.headerCt.dragging=false;return false}},getConstrainRegion:function(){var c=this,a=c.dragHd.el,d=0,b,e;if(c.headerCt.forceFit){b=c.dragHd.nextNode("gridcolumn:not([hidden]):not([isGroupHeader])");if(b){if(!c.headerInSameGrid(b)){b=null}d=b.getWidth()-c.minColWidth}}else{if((e=c.dragHd.up("tablepanel")).isLocked){d=c.dragHd.up("[scrollerOwner]").getWidth()-e.getWidth()-30}else{d=c.maxColWidth-a.getWidth()}}return c.adjustConstrainRegion(a.getRegion(),0,d,0,c.minColWidth)},onStart:function(g){var h=this,f=h.dragHd,b=f.el.getWidth(),d=f.getOwnerHeaderCt(),k,j,l,c,a,i,m;h.headerCt.dragging=true;h.origWidth=b;if(!h.dynamic){l=c=d.up("tablepanel");if(l.ownerLockable){c=l.ownerLockable}k=h.getLeftMarkerX(c);a=c.getLhsMarker();i=c.getRhsMarker();m=l.body.getHeight()+d.getHeight();j=d.getOffsetsTo(c)[1];a.setLocalY(j);i.setLocalY(j);a.setHeight(m);i.setHeight(m);h.setMarkerX(a,k);h.setMarkerX(i,k+b)}},onDrag:function(b){var a=this,c;if(a.dynamic){a.doResize()}else{c=this.headerCt.up("tablepanel");if(c.ownerLockable){c=c.ownerLockable}this.setMarkerX(this.getMovingMarker(c),this.calculateDragX(c))}},getMovingMarker:function(a){return a.getRhsMarker()},onEnd:function(a){this.headerCt.dragging=false;if(this.dragHd){if(!this.dynamic){var b=this.headerCt.up("tablepanel");if(b.ownerLockable){b=b.ownerLockable}this.setMarkerX(b.getLhsMarker(),-9999);this.setMarkerX(b.getRhsMarker(),-9999)}this.doResize()}},doResize:function(){var c=this,b=c.dragHd,a,d;if(b){d=c.tracker.getOffset("point");if(b.flex){delete b.flex}Ext.suspendLayouts();c.adjustColumnWidth(d[0]);if(c.headerCt.forceFit){a=b.nextNode("gridcolumn:not([hidden]):not([isGroupHeader])");if(a&&!c.headerInSameGrid(a)){a=null}if(a){delete a.flex;a.setWidth(a.getWidth()-d[0])}}Ext.resumeLayouts(true)}},headerInSameGrid:function(b){var a=this.dragHd.up("tablepanel");return !!b.up(a)},disable:function(){this.disabled=true;if(this.tracker){this.tracker.disable()}},enable:function(){this.disabled=false;if(this.tracker){this.tracker.enable()}},calculateDragX:function(a){return this.tracker.getXY("point")[0]-a.getX()-a.el.getBorderWidth("l")},getLeftMarkerX:function(a){return this.dragHd.getX()-a.getX()-a.el.getBorderWidth("l")-1},setMarkerX:function(b,a){b.setLocalX(a)},adjustConstrainRegion:function(f,d,e,a,c){return f.adjust(d,e,a,c)},adjustColumnWidth:function(a){this.dragHd.setWidth(this.origWidth+a)}});