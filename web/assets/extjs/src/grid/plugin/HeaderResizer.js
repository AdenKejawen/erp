Ext.define("Ext.grid.plugin.HeaderResizer",{extend:"Ext.AbstractPlugin",requires:["Ext.dd.DragTracker","Ext.util.Region"],alias:"plugin.gridheaderresizer",disabled:false,config:{dynamic:false},colHeaderCls:Ext.baseCSSPrefix+"column-header",minColWidth:40,maxColWidth:1000,wResizeCursor:"col-resize",eResizeCursor:"col-resize",init:function(a){this.headerCt=a;a.on("render",this.afterHeaderRender,this,{single:true})},destroy:function(){if(this.tracker){this.tracker.destroy()}},afterHeaderRender:function(){var b=this.headerCt,a=b.el;b.mon(a,"mousemove",this.onHeaderCtMouseMove,this);this.tracker=new Ext.dd.DragTracker({disabled:this.disabled,onBeforeStart:Ext.Function.bind(this.onBeforeStart,this),onStart:Ext.Function.bind(this.onStart,this),onDrag:Ext.Function.bind(this.onDrag,this),onEnd:Ext.Function.bind(this.onEnd,this),tolerance:3,autoStart:300,el:a})},onHeaderCtMouseMove:function(b,j){var d=this,a,h,i,f,c,g;if(d.headerCt.dragging){if(d.activeHd){d.activeHd.el.dom.style.cursor="";delete d.activeHd}}else{h=b.getTarget("."+d.colHeaderCls,3,true);if(h){i=Ext.getCmp(h.id);if(i.isOnLeftEdge(b)){f=i.previousNode("gridcolumn:not([hidden]):not([isGroupHeader])");if(f){g=d.headerCt.up("tablepanel");c=f.up("tablepanel");if(!((c===g)||((g.ownerCt.isXType("tablepanel"))&&g.ownerCt.view.lockedGrid===c))){f=null}}}else{if(i.isOnRightEdge(b)){f=i}else{f=null}}if(f){if(f.isGroupHeader){a=f.getGridColumns();f=a[a.length-1]}if(f&&!(f.fixed||(f.resizable===false)||d.disabled)){d.activeHd=f;i.el.dom.style.cursor=d.eResizeCursor}}else{i.el.dom.style.cursor="";delete d.activeHd}}}},onBeforeStart:function(b){var a=b.getTarget();this.dragHd=this.activeHd;if(!!this.dragHd&&!Ext.fly(a).hasCls(Ext.baseCSSPrefix+"column-header-trigger")&&!this.headerCt.dragging){this.tracker.constrainTo=this.getConstrainRegion();return true}else{this.headerCt.dragging=false;return false}},getConstrainRegion:function(){var c=this,a=c.dragHd.el,b;if(c.headerCt.forceFit){b=c.dragHd.nextNode("gridcolumn:not([hidden]):not([isGroupHeader])")}return c.adjustConstrainRegion(Ext.util.Region.getRegion(a),0,c.headerCt.forceFit?(b?b.getWidth()-c.minColWidth:0):c.maxColWidth-a.getWidth(),0,c.minColWidth)},onStart:function(g){var h=this,f=h.dragHd,n=f.el,c=n.getWidth(),d=h.headerCt,o=g.getTarget(),k,j,l,p,a,b,i,m;if(h.dragHd&&!Ext.fly(o).hasCls(Ext.baseCSSPrefix+"column-header-trigger")){d.dragging=true}h.origWidth=c;if(!h.dynamic){k=h.getDragHdX();l=d.up("tablepanel");p=h.dragHd.up(":not([isGroupHeader])");a=p.up();b=l.getLhsMarker();i=l.getRhsMarker();m=a.body.getHeight()+d.getHeight();j=n.getY()-l.getY();k+=h.getViewOffset(l);b.setLocalY(j);i.setLocalY(j);b.setHeight(m);i.setHeight(m);h.setMarkerX(b,k);h.setMarkerX(i,k+c)}},onDrag:function(b){if(!this.dynamic){var a=this.headerCt.up("tablepanel");this.setMarkerX(a.getRhsMarker(),this.calculateDragX(a))}else{this.doResize()}},onEnd:function(d){this.headerCt.dragging=false;if(this.dragHd){if(!this.dynamic){var b=this.headerCt.up("tablepanel"),c=b.getLhsMarker(),f=b.getRhsMarker(),a=-9999;this.setMarkerX(c,a);this.setMarkerX(f,a)}this.doResize()}},doResize:function(){if(this.dragHd){var b=this.dragHd,a,c=this.tracker.getOffset("point");if(b.flex){delete b.flex}Ext.suspendLayouts();this.adjustColumnWidth(c[0]);if(this.headerCt.forceFit){a=b.nextNode("gridcolumn:not([hidden]):not([isGroupHeader])");if(a){delete a.flex;a.setWidth(a.getWidth()-c[0])}}Ext.resumeLayouts(true)}},disable:function(){this.disabled=true;if(this.tracker){this.tracker.disable()}},enable:function(){this.disabled=false;if(this.tracker){this.tracker.enable()}},calculateDragX:function(a){return this.tracker.getXY("point")[0]-a.getX()},getDragHdX:function(){return this.dragHd.el.getLocalX()},setMarkerX:function(b,a){b.setLocalX(a)},adjustConstrainRegion:function(f,d,e,a,c){return f.adjust(d,e,a,c)},adjustColumnWidth:function(a){this.dragHd.setWidth(this.origWidth+a)},getViewOffset:function(a){return a.view.getX()-a.getX()-a.el.getBorderWidth("l")}});