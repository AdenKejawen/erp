Ext.define("Ext.selection.RowModel",{extend:"Ext.selection.Model",alias:"selection.rowmodel",requires:["Ext.util.KeyNav"],deltaScroll:5,enableKeyNav:true,ignoreRightMouseSelection:false,constructor:function(){this.addEvents("beforedeselect","beforeselect","deselect","select");this.views=[];this.callParent(arguments)},bindComponent:function(a){var b=this;a.on({itemmousedown:b.onRowMouseDown,itemclick:b.onRowClick,scope:b});if(b.enableKeyNav){b.initKeyNav(a)}},initKeyNav:function(a){var b=this;if(!a.rendered){a.on("render",Ext.Function.bind(b.initKeyNav,b,[a],0),b,{single:true});return}a.el.set({tabIndex:-1});b.keyNav=new Ext.util.KeyNav({target:a,ignoreInputFields:true,eventName:"itemkeydown",processEvent:function(d,c,g,e,f){f.record=c;f.recordIndex=e;return f},up:b.onKeyUp,down:b.onKeyDown,right:b.onKeyRight,left:b.onKeyLeft,pageDown:b.onKeyPageDown,pageUp:b.onKeyPageUp,home:b.onKeyHome,end:b.onKeyEnd,space:b.onKeySpace,enter:b.onKeyEnter,scope:b})},onUpdate:function(b){var d=this,a=d.view,c;if(a&&d.isSelected(b)){c=a.indexOf(b);a.onRowSelect(c);if(b===d.lastFocused){a.onRowFocus(c,true)}}},getRowsVisible:function(){var e=false,a=this.views[0],d=a.all.first(),b,c;if(d){b=d.getHeight();c=a.el.getHeight();e=Math.floor(c/b)}return e},onKeyEnd:function(c){var b=this,a=b.views[0];if(a.bufferedRenderer){a.bufferedRenderer.scrollTo(b.store.getCount()-1,false,function(e,d){b.afterKeyNavigate(c,d)})}else{b.afterKeyNavigate(c,a.getRecord(a.all.getCount()-1))}},onKeyHome:function(c){var b=this,a=b.views[0];if(a.bufferedRenderer){a.bufferedRenderer.scrollTo(0,false,function(e,d){b.afterKeyNavigate(c,d)})}else{b.afterKeyNavigate(c,a.getRecord(0))}},onKeyPageUp:function(f){var d=this,a=d.views[0],g=d.getRowsVisible(),c,b;if(g){if(a.bufferedRenderer){c=Math.max(f.recordIndex-g,0);(d.lastKeyEvent||(d.lastKeyEvent=new Ext.EventObjectImpl())).setEvent(f.browserEvent);a.bufferedRenderer.scrollTo(c,false,d.afterBufferedScrollTo,d)}else{b=a.walkRecs(f.record,-g);d.afterKeyNavigate(f,b)}}},onKeyPageDown:function(f){var d=this,a=d.views[0],g=d.getRowsVisible(),c,b;if(g){if(a.bufferedRenderer){c=Math.min(f.recordIndex+g,d.store.getCount()-1);(d.lastKeyEvent||(d.lastKeyEvent=new Ext.EventObjectImpl())).setEvent(f.browserEvent);a.bufferedRenderer.scrollTo(c,false,d.afterBufferedScrollTo,d)}else{b=a.walkRecs(f.record,g);d.afterKeyNavigate(f,b)}}},onKeySpace:function(b){var a=this.lastFocused;if(a){this.afterKeyNavigate(b,a)}},onKeyEnter:Ext.emptyFn,onKeyUp:function(b){var a=this.views[0].walkRecs(b.record,-1);if(a){this.afterKeyNavigate(b,a)}},onKeyDown:function(b){var a=this.views[0].walkRecs(b.record,1);if(a){this.afterKeyNavigate(b,a)}},afterBufferedScrollTo:function(b,a){this.afterKeyNavigate(this.lastKeyEvent,a)},scrollByDeltaX:function(d){var a=this.views[0],c=a.up(),b=c.horizontalScroller;if(b){b.scrollByDeltaX(d)}},onKeyLeft:function(a){this.scrollByDeltaX(-this.deltaScroll)},onKeyRight:function(a){this.scrollByDeltaX(this.deltaScroll)},onRowMouseDown:function(b,a,f,c,g){var d=this;if(c!==-1){if(!d.allowRightMouseSelection(g)){return}if(!d.isSelected(a)){d.mousedownAction=true;d.processSelection(b,a,f,c,g)}else{d.mousedownAction=false}}},onVetoUIEvent:function(f,c,a,h,d,g,b){if(f=="mousedown"){this.mousedownAction=!this.isSelected(b)}},onRowClick:function(b,a,d,c,f){if(this.mousedownAction){this.mousedownAction=false}else{this.processSelection(b,a,d,c,f)}},processSelection:function(b,a,d,c,f){this.selectWithEvent(a,f)},allowRightMouseSelection:function(a){var b=this.ignoreRightMouseSelection&&a.button!==0;if(b){b=this.hasSelection()}return !b},onSelectChange:function(f,c,j,a){var h=this,k=h.views,d=k.length,b=k[0].indexOf(f),g=c?"select":"deselect",e=0;if((j||h.fireEvent("before"+g,h,f,b))!==false&&a()!==false){for(;e<d;e++){if(c){k[e].onRowSelect(b,j)}else{k[e].onRowDeselect(b,j)}}if(!j){h.fireEvent(g,h,f,b)}}},onLastFocusChanged:function(g,c,b){var a=this.views,f=a.length,e,d=0;if(g){e=a[0].indexOf(g);if(e!=-1){for(;d<f;d++){a[d].onRowFocus(e,false,true)}}}if(c){e=a[0].indexOf(c);if(e!=-1){for(d=0;d<f;d++){a[d].onRowFocus(e,true,b)}}}this.callParent(arguments)},onEditorTab:function(d,h){var f=this,c=f.views[0],b=d.getActiveRecord(),i=d.getActiveColumn(),a=c.getPosition(b,i),g=h.shiftKey?"left":"right";do{a=c.walkCells(a,g,h,f.preventWrap)}while(a&&(!a.columnHeader.getEditor(b)||!d.startEditByPosition(a)))},getCurrentPosition:function(){var a=this.selected.items[0];if(a){return new Ext.grid.CellContext(this.view).setPosition(this.store.indexOf(a),0)}},selectByPosition:function(a){this.select(this.store.getAt(a.row))},selectNext:function(g,c){var f=this,b=f.store,e=f.getSelection(),a=e[e.length-1],d=f.views[0].indexOf(a)+1,h;if(d===b.getCount()||d===0){h=false}else{f.doSelect(d,g,c);h=true}return h},selectPrevious:function(f,b){var e=this,d=e.getSelection(),a=d[0],c=e.views[0].indexOf(a)-1,g;if(c<0){g=false}else{e.doSelect(c,f,b);g=true}return g},isRowSelected:function(a,b){return this.isSelected(a)}});