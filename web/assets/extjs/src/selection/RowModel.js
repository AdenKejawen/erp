Ext.define("Ext.selection.RowModel",{extend:"Ext.selection.Model",alias:"selection.rowmodel",requires:["Ext.util.KeyNav"],deltaScroll:5,enableKeyNav:true,ignoreRightMouseSelection:false,constructor:function(){this.addEvents("beforedeselect","beforeselect","deselect","select");this.views=[];this.callParent(arguments)},bindComponent:function(a){var b=this;b.views=b.views||[];b.views.push(a);b.bindStore(a.getStore(),true);a.on({itemmousedown:b.onRowMouseDown,scope:b});if(b.enableKeyNav){b.initKeyNav(a)}},initKeyNav:function(a){var b=this;if(!a.rendered){a.on("render",Ext.Function.bind(b.initKeyNav,b,[a],0),b,{single:true});return}a.el.set({tabIndex:-1});b.keyNav=new Ext.util.KeyNav({target:a,ignoreInputFields:true,eventName:"itemkeydown",processEvent:function(d,c,g,e,f){f.record=c;f.recordIndex=e;return f},up:b.onKeyUp,down:b.onKeyDown,right:b.onKeyRight,left:b.onKeyLeft,pageDown:b.onKeyPageDown,pageUp:b.onKeyPageUp,home:b.onKeyHome,end:b.onKeyEnd,space:b.onKeySpace,enter:b.onKeyEnter,scope:b})},onUpdate:function(b){var d=this,a=d.view,c;if(a&&d.isSelected(b)){c=a.indexOf(b);a.onRowSelect(c);if(b===d.lastFocused){a.onRowFocus(c,true)}}},getRowsVisible:function(){var e=false,a=this.views[0],d=a.all.first(),b,c;if(d){b=d.getHeight();c=a.el.getHeight();e=Math.floor(c/b)}return e},onKeyEnd:function(c){var b=this,a=b.views[0].all.last();if(a){if(c.shiftKey){b.selectRange(a,b.lastFocused||0);b.setLastFocused(a)}else{if(c.ctrlKey){b.setLastFocused(a)}else{b.doSelect(a)}}}},onKeyHome:function(b){var a=this,c=a.views[0].all.first();if(c){if(b.shiftKey){a.selectRange(c,a.lastFocused||0);a.setLastFocused(c)}else{if(b.ctrlKey){a.setLastFocused(c)}else{a.doSelect(c,false)}}}},onKeyPageUp:function(f){var d=this,g=d.getRowsVisible(),b,c,a;if(g){b=f.recordIndex;c=b-g;if(c<0){c=0}a=d.views[0].getRecord(c);if(f.shiftKey){d.selectRange(a,f.record,f.ctrlKey,"up");d.setLastFocused(a)}else{if(f.ctrlKey){f.preventDefault();d.setLastFocused(a)}else{d.doSelect(a)}}}},onKeyPageDown:function(f){var c=this,g=c.getRowsVisible(),a,d,b;if(g){a=f.recordIndex;d=a+g;if(d>=c.store.getCount()){d=c.store.getCount()-1}b=c.views[0].getAt(d);if(f.shiftKey){c.selectRange(b,f.record,f.ctrlKey,"down");c.setLastFocused(b)}else{if(f.ctrlKey){f.preventDefault();c.setLastFocused(b)}else{c.doSelect(b)}}}},onKeySpace:function(c){var b=this,a=b.lastFocused;if(a){if(b.isSelected(a)){b.doDeselect(a,false)}else{b.doSelect(a,true)}}},onKeyEnter:Ext.emptyFn,onKeyUp:function(d){var c=this,f={row:c.lastFocused?c.views[0].indexOf(c.lastFocused,true):c.view.all.endIndex+1,column:0},b,a;if(f.row>0){b=c.view.walkCells(f,"up",d);a=b?c.views[0].getRecord(b.row):null;if(a){if(d.shiftKey&&c.lastFocused){if(c.isSelected(c.lastFocused)&&c.isSelected(a)){c.doDeselect(c.lastFocused,true);c.setLastFocused(a)}else{if(!c.isSelected(c.lastFocused)){c.doSelect(c.lastFocused,true);c.doSelect(a,true)}else{c.doSelect(a,true)}}}else{if(d.ctrlKey){c.setLastFocused(a)}else{c.doSelect(a)}}}}},onKeyDown:function(d){var c=this,f={row:c.lastFocused?c.views[0].indexOf(c.lastFocused):0,column:0},b,a;b=c.view.walkCells(f,"down",d);a=b?c.views[0].getRecord(b.row):null;if(a){if(c.selected.getCount()===0){if(!d.ctrlKey){c.doSelect(a)}else{c.setLastFocused(a)}}else{if(d.shiftKey&&c.lastFocused){if(c.isSelected(c.lastFocused)&&c.isSelected(a)){c.doDeselect(c.lastFocused,true);c.setLastFocused(a)}else{if(!c.isSelected(c.lastFocused)){c.doSelect(c.lastFocused,true);c.doSelect(a,true)}else{c.doSelect(a,true)}}}else{if(d.ctrlKey){c.setLastFocused(a)}else{c.doSelect(a)}}}}},scrollByDeltaX:function(d){var a=this.views[0],c=a.up(),b=c.horizontalScroller;if(b){b.scrollByDeltaX(d)}},onKeyLeft:function(a){this.scrollByDeltaX(-this.deltaScroll)},onKeyRight:function(a){this.scrollByDeltaX(this.deltaScroll)},onRowMouseDown:function(b,a,d,c,f){if(c!==-1){if(!this.allowRightMouseSelection(f)){return}if(f.button===0||!this.isSelected(a)){this.selectWithEvent(a,f)}}},allowRightMouseSelection:function(a){var b=this.ignoreRightMouseSelection&&a.button!==0;if(b){b=this.hasSelection()}return !b},onSelectChange:function(f,c,j,a){var h=this,k=h.views,d=k.length,b=k[0].indexOf(f),g=c?"select":"deselect",e=0;if((j||h.fireEvent("before"+g,h,f,b))!==false&&a()!==false){for(;e<d;e++){if(c){k[e].onRowSelect(b,j)}else{k[e].onRowDeselect(b,j)}}if(!j){h.fireEvent(g,h,f,b)}}},onLastFocusChanged:function(g,c,b){var a=this.views,f=a.length,e,d=0;if(g){e=a[0].indexOf(g);if(e!=-1){for(;d<f;d++){a[d].onRowFocus(e,false)}}}if(c){e=a[0].indexOf(c);if(e!=-1){for(d=0;d<f;d++){a[d].onRowFocus(e,true,b)}}}this.callParent()},onEditorTab:function(d,h){var f=this,c=f.views[0],b=d.getActiveRecord(),i=d.getActiveColumn(),a=c.getPosition(b,i),g=h.shiftKey?"left":"right";do{a=c.walkCells(a,g,h,f.preventWrap)}while(a&&(!c.headerCt.getHeaderAtIndex(a.column).getEditor(b)||!d.startEditByPosition(a)))},getCurrentPosition:function(){var a=this.selected.items[0];if(a){return{row:this.store.indexOf(a),column:0}}},selectByPosition:function(a){var b=this.store.getAt(a.row);this.select(b)},selectNext:function(g,c){var f=this,b=f.store,e=f.getSelection(),a=e[e.length-1],d=f.views[0].indexOf(a)+1,h;if(d===b.getCount()||d===0){h=false}else{f.doSelect(d,g,c);h=true}return h},selectPrevious:function(f,b){var e=this,d=e.getSelection(),a=d[0],c=e.views[0].indexOf(a)-1,g;if(c<0){g=false}else{e.doSelect(c,f,b);g=true}return g},isRowSelected:function(a,b){return this.isSelected(a)}});