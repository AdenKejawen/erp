Ext.define("Ext.chart.series.Gauge",{extend:"Ext.chart.series.Series",type:"gauge",alias:"series.gauge",rad:Math.PI/180,highlightDuration:150,angleField:false,needle:false,donut:false,showInLegend:false,style:{},constructor:function(b){this.callParent(arguments);var g=this,f=g.chart,a=f.surface,h=f.store,j=f.shadow,d,c,e;Ext.apply(g,b,{shadowAttributes:[{"stroke-width":6,"stroke-opacity":1,stroke:"rgb(200, 200, 200)",translate:{x:1.2,y:2}},{"stroke-width":4,"stroke-opacity":1,stroke:"rgb(150, 150, 150)",translate:{x:0.9,y:1.5}},{"stroke-width":2,"stroke-opacity":1,stroke:"rgb(100, 100, 100)",translate:{x:0.6,y:1}}]});g.group=a.getGroup(g.seriesId);if(j){for(d=0,c=g.shadowAttributes.length;d<c;d++){g.shadowGroups.push(a.getGroup(g.seriesId+"-shadows"+d))}}a.customAttributes.segment=function(i){return g.getSegment(i)}},initialize:function(){var d=this,a=d.chart.getChartStore(),e=a.data.items,b=d.label,c=e.length;d.yField=[];if(b&&b.field&&c>0){d.yField.push(e[0].get(b.field))}},getSegment:function(b){var B=this,A=B.rad,d=Math.cos,a=Math.sin,m=Math.abs,j=B.centerX,h=B.centerY,v=0,u=0,t=0,q=0,g=0,f=0,e=0,c=0,w=0.01,l=b.endRho-b.startRho,p=b.startAngle,o=b.endAngle,i=(p+o)/2*A,k=b.margin||0,s=m(o-p)>180,C=Math.min(p,o)*A,z=Math.max(p,o)*A,n=false;j+=k*d(i);h+=k*a(i);v=j+b.startRho*d(C);g=h+b.startRho*a(C);u=j+b.endRho*d(C);f=h+b.endRho*a(C);t=j+b.startRho*d(z);e=h+b.startRho*a(z);q=j+b.endRho*d(z);c=h+b.endRho*a(z);if(m(v-t)<=w&&m(g-e)<=w){n=true}if(n){return{path:[["M",v,g],["L",u,f],["A",b.endRho,b.endRho,0,+s,1,q,c],["Z"]]}}else{return{path:[["M",v,g],["L",u,f],["A",b.endRho,b.endRho,0,+s,1,q,c],["L",t,e],["A",b.startRho,b.startRho,0,+s,0,v,g],["Z"]]}}},calcMiddle:function(o){var j=this,k=j.rad,n=o.slice,m=j.centerX,l=j.centerY,i=n.startAngle,e=n.endAngle,h=Math.max(("rho" in n)?n.rho:j.radius,j.label.minMargin),g=+j.donut,b=Math.min(i,e)*k,a=Math.max(i,e)*k,d=-(b+(a-b)/2),f=m+(o.endRho+o.startRho)/2*Math.cos(d),c=l-(o.endRho+o.startRho)/2*Math.sin(d);o.middle={x:f,y:c}},drawSeries:function(){var v=this,T=v.chart,b=T.getChartStore(),z=v.group,P=v.chart.animate,C=v.chart.axes.get(0),D=C&&C.minimum||v.minimum||0,H=C&&C.maximum||v.maximum||0,m=v.angleField||v.field||v.xField,J=T.surface,G=T.chartBBox,g=v.rad,c=+v.donut,U={},A=[],l=v.seriesStyle,a=v.seriesLabelStyle,f=v.colorArrayStyle,y=f&&f.length||0,h=Math.cos,r=Math.sin,s,e,d,u,q,B,L,E,F,I,R,Q,k,S,w,n,N,O,o,x,t,M,K;Ext.apply(l,v.style||{});v.setBBox();x=v.bbox;if(v.colorSet){f=v.colorSet;y=f.length}if(!b||!b.getCount()||v.seriesIsHidden){v.hide();v.items=[];return}e=v.centerX=G.x+(G.width/2);d=v.centerY=G.y+G.height;v.radius=Math.min(e-G.x,d-G.y);v.slices=q=[];v.items=A=[];if(!v.value){I=b.getAt(0);v.value=I.get(m)}L=v.value;if(v.needle){M={series:v,value:L,startAngle:-180,endAngle:0,rho:v.radius};t=-180*(1-(L-D)/(H-D));q.push(M)}else{t=-180*(1-(L-D)/(H-D));M={series:v,value:L,startAngle:-180,endAngle:t,rho:v.radius};K={series:v,value:v.maximum-L,startAngle:t,endAngle:0,rho:v.radius};q.push(M,K)}for(R=0,F=q.length;R<F;R++){u=q[R];B=z.getAt(R);s=Ext.apply({segment:{startAngle:u.startAngle,endAngle:u.endAngle,margin:0,rho:u.rho,startRho:u.rho*+c/100,endRho:u.rho}},Ext.apply(l,f&&{fill:f[R%y]}||{}));E=Ext.apply({},s.segment,{slice:u,series:v,storeItem:I,index:R});A[R]=E;if(!B){o=Ext.apply({type:"path",group:z},Ext.apply(l,f&&{fill:f[R%y]}||{}));B=J.add(Ext.apply(o,s))}u.sprite=u.sprite||[];E.sprite=B;u.sprite.push(B);if(P){s=v.renderer(B,I,s,R,b);B._to=s;v.onAnimate(B,{to:s})}else{s=v.renderer(B,I,Ext.apply(s,{hidden:false}),R,b);B.setAttributes(s,true)}}if(v.needle){t=t*Math.PI/180;if(!v.needleSprite){v.needleSprite=v.chart.surface.add({type:"path",path:["M",e+(v.radius*+c/100)*h(t),d+-Math.abs((v.radius*+c/100)*r(t)),"L",e+v.radius*h(t),d+-Math.abs(v.radius*r(t))],"stroke-width":4,stroke:"#222"})}else{if(P){v.onAnimate(v.needleSprite,{to:{path:["M",e+(v.radius*+c/100)*h(t),d+-Math.abs((v.radius*+c/100)*r(t)),"L",e+v.radius*h(t),d+-Math.abs(v.radius*r(t))]}})}else{v.needleSprite.setAttributes({type:"path",path:["M",e+(v.radius*+c/100)*h(t),d+-Math.abs((v.radius*+c/100)*r(t)),"L",e+v.radius*h(t),d+-Math.abs(v.radius*r(t))]})}}v.needleSprite.setAttributes({hidden:false},true)}delete v.value},setValue:function(a){this.value=a;this.drawSeries()},onCreateLabel:function(c,b,a,d){},onPlaceLabel:function(c,f,e,d,g,a,b){},onPlaceCallout:function(){},onAnimate:function(b,a){b.show();return this.callParent(arguments)},isItemInPoint:function(k,h,m,e){var g=this,d=g.centerX,c=g.centerY,o=Math.abs,n=o(k-d),l=o(h-c),f=m.startAngle,a=m.endAngle,j=Math.sqrt(n*n+l*l),b=Math.atan2(h-c,k-d)/g.rad;return(e===0)&&(b>=f&&b<a&&j>=m.startRho&&j<=m.endRho)},getLegendColor:function(b){var a=this.colorSet||this.colorArrayStyle;return a[b%a.length]}});