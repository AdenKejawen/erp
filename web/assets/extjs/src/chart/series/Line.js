Ext.define("Ext.chart.series.Line",{extend:"Ext.chart.series.Cartesian",alternateClassName:["Ext.chart.LineSeries","Ext.chart.LineChart"],requires:["Ext.chart.axis.Axis","Ext.chart.Shape","Ext.draw.Draw","Ext.fx.Anim"],type:"line",alias:"series.line",selectionTolerance:20,showMarkers:true,markerConfig:{},style:{},smooth:false,defaultSmoothness:3,fill:false,constructor:function(c){this.callParent(arguments);var e=this,a=e.chart.surface,f=e.chart.shadow,d,b;c.highlightCfg=Ext.Object.merge({"stroke-width":3},c.highlightCfg);Ext.apply(e,c,{shadowAttributes:[{"stroke-width":6,"stroke-opacity":0.05,stroke:"rgb(0, 0, 0)",translate:{x:1,y:1}},{"stroke-width":4,"stroke-opacity":0.1,stroke:"rgb(0, 0, 0)",translate:{x:1,y:1}},{"stroke-width":2,"stroke-opacity":0.15,stroke:"rgb(0, 0, 0)",translate:{x:1,y:1}}]});e.group=a.getGroup(e.seriesId);if(e.showMarkers){e.markerGroup=a.getGroup(e.seriesId+"-markers")}if(f){for(d=0,b=e.shadowAttributes.length;d<b;d++){e.shadowGroups.push(a.getGroup(e.seriesId+"-shadows"+d))}}},shrink:function(b,j,k){var g=b.length,h=Math.floor(g/k),f=1,d=0,a=0,e=[+b[0]],c=[+j[0]];for(;f<g;++f){d+=+b[f]||0;a+=+j[f]||0;if(f%h==0){e.push(d/h);c.push(a/h);d=0;a=0}}return{x:e,y:c}},drawSeries:function(){var ao=this,aB=ao.chart,V=aB.axes,aw=aB.getChartStore(),A=aw.data.items,at,Y=aw.getCount(),w=ao.chart.surface,av={},U=ao.group,N=ao.showMarkers,aH=ao.markerGroup,G=aB.shadow,F=ao.shadowGroups,ab=ao.shadowAttributes,R=ao.smooth,r=F.length,az=["M"],W=["M"],d=["M"],b=["M"],M=aB.markerIndex,an=[].concat(ao.axis),am,aC=[],al={},af=[],z={},L=false,T=[],aG=Ext.apply({},ao.markerStyle),ae=ao.seriesStyle,v=ao.colorArrayStyle,S=v&&v.length||0,O=Ext.isNumber,aD=ao.seriesIdx,h=ao.getAxesForXAndYFields(),m=h.xAxis,aF=h.yAxis,ad=m?V.get(m).type:"",e=aF?V.get(aF).type:"",ah,k,ag,ai,D,c,aj,K,J,g,f,u,s,aa,Q,P,aA,n,I,H,aI,o,q,E,a,ac,ak,C,ay,B,ax,p,aE,au,ar,X,l,t,ap,aq,Z;if(ao.fireEvent("beforedraw",ao)===false){return}if(!Y||ao.seriesIsHidden){ao.hide();ao.items=[];if(ao.line){ao.line.hide(true);if(ao.line.shadows){ah=ao.line.shadows;for(P=0,r=ah.length;P<r;P++){k=ah[P];k.hide(true)}}if(ao.fillPath){ao.fillPath.hide(true)}}ao.line=null;ao.fillPath=null;return}au=Ext.apply(aG||{},ao.markerConfig,{fill:ao.seriesStyle.fill||v[ao.themeIdx%v.length]});X=au.type;delete au.type;ar=ae;if(!ar["stroke-width"]){ar["stroke-width"]=0.5}t="opacity" in ar?ar.opacity:1;Z="opacity" in ar?ar.opacity:0.3;ap="lineOpacity" in ar?ar.lineOpacity:t;aq="fillOpacity" in ar?ar.fillOpacity:Z;if(M&&aH&&aH.getCount()){for(Q=0;Q<M;Q++){H=aH.getAt(Q);aH.remove(H);aH.add(H);aI=aH.getAt(aH.getCount()-2);H.setAttributes({x:0,y:0,translate:{x:aI.attr.translation.x,y:aI.attr.translation.y}},true)}}ao.unHighlightItem();ao.cleanHighlights();ao.setBBox();av=ao.bbox;ao.clipRect=[av.x,av.y,av.width,av.height];if(n=V.get(m)){I=n.applyData();C=I.from;ay=I.to}if(n=V.get(aF)){I=n.applyData();B=I.from;ax=I.to}if(ao.xField&&!Ext.isNumber(C)){n=ao.getMinMaxXValues();C=n[0];ay=n[1]}if(ao.yField&&!Ext.isNumber(B)){n=ao.getMinMaxYValues();B=n[0];ax=n[1]}if(isNaN(C)){C=0;ac=av.width/((Y-1)||1)}else{ac=av.width/((ay-C)||(Y-1)||1)}if(isNaN(B)){B=0;ak=av.height/((Y-1)||1)}else{ak=av.height/((ax-B)||(Y-1)||1)}for(Q=0,aA=A.length;Q<aA;Q++){at=A[Q];q=at.get(ao.xField);if(ad=="Time"&&typeof q=="string"){q=Date.parse(q)}if(typeof q=="string"||typeof q=="object"&&!Ext.isDate(q)||m&&V.get(m)&&V.get(m).type=="Category"){if(q in al){q=al[q]}else{q=al[q]=Q}}E=at.get(ao.yField);if(e=="Time"&&typeof E=="string"){E=Date.parse(E)}if(typeof E=="undefined"||(typeof E=="string"&&!E)){if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("[Ext.chart.series.Line]  Skipping a store element with an undefined value at ",at,q,E)}continue}if(typeof E=="string"||typeof E=="object"&&!Ext.isDate(E)||aF&&V.get(aF)&&V.get(aF).type=="Category"){E=Q}T.push(Q);aC.push(q);af.push(E)}aA=aC.length;if(aA>av.width){a=ao.shrink(aC,af,av.width);aC=a.x;af=a.y}ao.items=[];l=0;aA=aC.length;for(Q=0;Q<aA;Q++){q=aC[Q];E=af[Q];if(E===false){if(W.length==1){W=[]}L=true;ao.items.push(false);continue}else{K=(av.x+(q-C)*ac).toFixed(2);J=((av.y+av.height)-(E-B)*ak).toFixed(2);if(L){L=false;W.push("M")}W=W.concat([K,J])}if((typeof s=="undefined")&&(typeof J!="undefined")){s=J;u=K}if(!ao.line||aB.resizing){az=az.concat([K,av.y+av.height/2])}if(aB.animate&&aB.resizing&&ao.line){ao.line.setAttributes({path:az,opacity:ap},true);if(ao.fillPath){ao.fillPath.setAttributes({path:az,opacity:aq},true)}if(ao.line.shadows){ah=ao.line.shadows;for(P=0,r=ah.length;P<r;P++){k=ah[P];k.setAttributes({path:az},true)}}}if(N){H=aH.getAt(l++);if(!H){H=Ext.chart.Shape[X](w,Ext.apply({group:[U,aH],x:0,y:0,translate:{x:+(g||K),y:f||(av.y+av.height/2)},value:'"'+q+", "+E+'"',zIndex:4000},au));H._to={translate:{x:+K,y:+J}}}else{H.setAttributes({value:'"'+q+", "+E+'"',x:0,y:0,hidden:false},true);H._to={translate:{x:+K,y:+J}}}}ao.items.push({series:ao,value:[q,E],point:[K,J],sprite:H,storeItem:aw.getAt(T[Q])});g=K;f=J}if(W.length<=1){return}if(ao.smooth){b=Ext.draw.Draw.smooth(W,O(R)?R:ao.defaultSmoothness)}d=R?b:W;if(aB.markerIndex&&ao.previousPath){ai=ao.previousPath;if(!R){Ext.Array.erase(ai,1,2)}}else{ai=W}if(!ao.line){ao.line=w.add(Ext.apply({type:"path",group:U,path:az,stroke:ar.stroke||ar.fill},ar||{}));ao;ao.line.setAttributes({opacity:ap},true);if(G){ao.line.setAttributes(Ext.apply({},ao.shadowOptions),true)}ao.line.setAttributes({fill:"none",zIndex:3000});if(!ar.stroke&&S){ao.line.setAttributes({stroke:v[ao.themeIdx%S]},true)}if(G){ah=ao.line.shadows=[];for(ag=0;ag<r;ag++){am=ab[ag];am=Ext.apply({},am,{path:az});k=w.add(Ext.apply({},{type:"path",group:F[ag]},am));ah.push(k)}}}if(ao.fill){c=d.concat([["L",K,av.y+av.height],["L",u,av.y+av.height],["L",u,s]]);if(!ao.fillPath){ao.fillPath=w.add({group:U,type:"path",fill:ar.fill||v[ao.themeIdx%S],path:az})}}aa=N&&aH.getCount();if(aB.animate){D=ao.fill;p=ao.line;aj=ao.renderer(p,false,{path:d},Q,aw);Ext.apply(aj,ar||{},{stroke:ar.stroke||ar.fill});delete aj.fill;p.show(true);if(aB.markerIndex&&ao.previousPath){ao.animation=aE=ao.onAnimate(p,{to:aj,from:{path:ai}})}else{ao.animation=aE=ao.onAnimate(p,{to:aj})}if(G){ah=p.shadows;for(P=0;P<r;P++){ah[P].show(true);if(aB.markerIndex&&ao.previousPath){ao.onAnimate(ah[P],{to:{path:d},from:{path:ai}})}else{ao.onAnimate(ah[P],{to:{path:d}})}}}if(D){ao.fillPath.show(true);ao.onAnimate(ao.fillPath,{to:Ext.apply({},{path:c,fill:ar.fill||v[ao.themeIdx%S],"stroke-width":0,opacity:aq},ar||{})})}if(N){l=0;for(Q=0;Q<aA;Q++){if(ao.items[Q]){o=aH.getAt(l++);if(o){aj=ao.renderer(o,aw.getAt(Q),o._to,Q,aw);ao.onAnimate(o,{to:Ext.applyIf(aj,au||{})});o.show(true)}}}for(;l<aa;l++){o=aH.getAt(l);o.hide(true)}}}else{aj=ao.renderer(ao.line,false,{path:d,hidden:false},Q,aw);Ext.apply(aj,ar||{},{stroke:ar.stroke||ar.fill});delete aj.fill;ao.line.setAttributes(aj,true);ao.line.setAttributes({opacity:ap},true);if(G){ah=ao.line.shadows;for(P=0;P<r;P++){ah[P].setAttributes({path:d,hidden:false},true)}}if(ao.fill){ao.fillPath.setAttributes({path:c,hidden:false,opacity:aq},true)}if(N){l=0;for(Q=0;Q<aA;Q++){if(ao.items[Q]){o=aH.getAt(l++);if(o){aj=ao.renderer(o,aw.getAt(Q),o._to,Q,aw);o.setAttributes(Ext.apply(au||{},aj||{}),true);if(!o.attr.hidden){o.show(true)}}}}for(;l<aa;l++){o=aH.getAt(l);o.hide(true)}}}if(aB.markerIndex){if(ao.smooth){Ext.Array.erase(W,1,2)}else{Ext.Array.splice(W,1,0,W[1],W[2])}ao.previousPath=W}ao.renderLabels();ao.renderCallouts();ao.fireEvent("draw",ao)},onCreateLabel:function(d,j,c,e){var f=this,g=f.labelsGroup,a=f.label,h=f.bbox,b=Ext.apply({},a,f.seriesLabelStyle||{});return f.chart.surface.add(Ext.apply({type:"text","text-anchor":"middle",group:g,x:Number(j.point[0]),y:h.y+h.height/2},b||{}))},onPlaceLabel:function(g,k,u,r,p,d,e){var w=this,l=w.chart,t=l.resizing,v=w.label,s=v.renderer,b=v.field,a=w.bbox,j=Number(u.point[0]),h=Number(u.point[1]),c=u.sprite.attr.radius,q,o,n,m,z,f;g.setAttributes({text:s(k.get(b),g,k,u,r,p,d,e),hidden:true},true);o=u.sprite.getBBox();o.width=o.width||(c*2);o.height=o.height||(c*2);q=g.getBBox();n=q.width/2;m=q.height/2;if(p=="rotate"){z=o.width/2+n+m/2;if(j+z+n>a.x+a.width){j-=z}else{j+=z}g.setAttributes({rotation:{x:j,y:h,degrees:-45}},true)}else{if(p=="under"||p=="over"){g.setAttributes({rotation:{degrees:0}},true);if(j<a.x+n){j=a.x+n}else{if(j+n>a.x+a.width){j=a.x+a.width-n}}f=o.height/2+m;h=h+(p=="over"?-f:f);if(h<a.y+m){h+=2*f}else{if(h+m>a.y+a.height){h-=2*f}}}}if(w.chart.animate&&!w.chart.resizing){g.show(true);w.onAnimate(g,{to:{x:j,y:h}})}else{g.setAttributes({x:j,y:h},true);if(t&&w.animation){w.animation.on("afteranimate",function(){g.show(true)})}else{g.show(true)}}},highlightItem:function(){var b=this,a=b.line;b.callParent(arguments);if(a&&!b.highlighted){if(!("__strokeWidth" in a)){a.__strokeWidth=parseFloat(a.attr["stroke-width"])||0}if(a.__anim){a.__anim.paused=true}a.__anim=new Ext.fx.Anim({target:a,to:{"stroke-width":a.__strokeWidth+3}});b.highlighted=true}},unHighlightItem:function(){var c=this,a=c.line,b;c.callParent(arguments);if(a&&c.highlighted){b=a.__strokeWidth||parseFloat(a.attr["stroke-width"])||0;a.__anim=new Ext.fx.Anim({target:a,to:{"stroke-width":b}});c.highlighted=false}},onPlaceCallout:function(l,q,I,F,E,d,j){if(!E){return}var L=this,r=L.chart,C=r.surface,G=r.resizing,K=L.callouts,s=L.items,u=F==0?false:s[F-1].point,w=(F==s.length-1)?false:s[F+1].point,c=[+I.point[0],+I.point[1]],z,f,M,J,n,o,H=K.offsetFromViz||30,B=K.offsetToSide||10,A=K.offsetBox||3,g,e,h,v,t,D=L.clipRect,b={width:K.styles.width||10,height:K.styles.height||10},m,k;if(!u){u=c}if(!w){w=c}J=(w[1]-u[1])/(w[0]-u[0]);n=(c[1]-u[1])/(c[0]-u[0]);o=(w[1]-c[1])/(w[0]-c[0]);f=Math.sqrt(1+J*J);z=[1/f,J/f];M=[-z[1],z[0]];if(n>0&&o<0&&M[1]<0||n<0&&o>0&&M[1]>0){M[0]*=-1;M[1]*=-1}else{if(Math.abs(n)<Math.abs(o)&&M[0]<0||Math.abs(n)>Math.abs(o)&&M[0]>0){M[0]*=-1;M[1]*=-1}}m=c[0]+M[0]*H;k=c[1]+M[1]*H;g=m+(M[0]>0?0:-(b.width+2*A));e=k-b.height/2-A;h=b.width+2*A;v=b.height+2*A;if(g<D[0]||(g+h)>(D[0]+D[2])){M[0]*=-1}if(e<D[1]||(e+v)>(D[1]+D[3])){M[1]*=-1}m=c[0]+M[0]*H;k=c[1]+M[1]*H;g=m+(M[0]>0?0:-(b.width+2*A));e=k-b.height/2-A;h=b.width+2*A;v=b.height+2*A;if(r.animate){L.onAnimate(l.lines,{to:{path:["M",c[0],c[1],"L",m,k,"Z"]}});if(l.panel){l.panel.setPosition(g,e,true)}}else{l.lines.setAttributes({path:["M",c[0],c[1],"L",m,k,"Z"]},true);if(l.panel){l.panel.setPosition(g,e)}}for(t in l){l[t].show(true)}},isItemInPoint:function(h,f,z,p){var B=this,m=B.items,r=B.selectionTolerance,j=null,w,c,o,u,g,v,b,s,a,k,A,e,d,n,t,q,C=Math.sqrt,l=Math.abs;c=m[p];w=p&&m[p-1];if(p>=g){w=m[g-1]}o=w&&w.point;u=c&&c.point;v=w?o[0]:u[0]-r;b=w?o[1]:u[1];s=c?u[0]:o[0]+r;a=c?u[1]:o[1];e=C((h-v)*(h-v)+(f-b)*(f-b));d=C((h-s)*(h-s)+(f-a)*(f-a));n=Math.min(e,d);if(n<=r){return n==e?w:c}return false},toggleAll:function(a){var e=this,b,d,f,c;if(!a){Ext.chart.series.Cartesian.prototype.hideAll.call(e)}else{Ext.chart.series.Cartesian.prototype.showAll.call(e)}if(e.line){e.line.setAttributes({hidden:!a},true);if(e.line.shadows){for(b=0,c=e.line.shadows,d=c.length;b<d;b++){f=c[b];f.setAttributes({hidden:!a},true)}}}if(e.fillPath){e.fillPath.setAttributes({hidden:!a},true)}},hideAll:function(){this.toggleAll(false)},showAll:function(){this.toggleAll(true)}});