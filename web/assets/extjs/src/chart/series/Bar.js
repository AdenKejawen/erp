Ext.define("Ext.chart.series.Bar",{extend:"Ext.chart.series.Cartesian",alternateClassName:["Ext.chart.BarSeries","Ext.chart.BarChart","Ext.chart.StackedBarChart"],requires:["Ext.chart.axis.Axis","Ext.fx.Anim"],type:"bar",alias:"series.bar",column:false,style:{},gutter:38.2,groupGutter:38.2,xPadding:0,yPadding:10,constructor:function(c){this.callParent(arguments);var e=this,a=e.chart.surface,f=e.chart.shadow,d,b;c.highlightCfg=Ext.Object.merge({lineWidth:3,stroke:"#55c",opacity:0.8,color:"#f00"},c.highlightCfg);Ext.apply(e,c,{shadowAttributes:[{"stroke-width":6,"stroke-opacity":0.05,stroke:"rgb(200, 200, 200)",translate:{x:1.2,y:1.2}},{"stroke-width":4,"stroke-opacity":0.1,stroke:"rgb(150, 150, 150)",translate:{x:0.9,y:0.9}},{"stroke-width":2,"stroke-opacity":0.15,stroke:"rgb(100, 100, 100)",translate:{x:0.6,y:0.6}}]});e.group=a.getGroup(e.seriesId+"-bars");if(f){for(d=0,b=e.shadowAttributes.length;d<b;d++){e.shadowGroups.push(a.getGroup(e.seriesId+"-shadows"+d))}}},getPadding:function(){var c=this,b=c.xPadding,a=c.yPadding,d={};if(Ext.isNumber(b)){d.left=b;d.right=b}else{if(Ext.isObject(b)){d.left=b.left;d.right=b.right}else{d.left=0;d.right=0}}d.width=d.left+d.right;if(Ext.isNumber(a)){d.bottom=a;d.top=a}else{if(Ext.isObject(a)){d.bottom=a.bottom;d.top=a.top}else{d.bottom=0;d.top=0}}d.height=d.bottom+d.top;return d},getBarGirth:function(){var d=this,a=d.chart.getChartStore(),b=d.column,c=a.getCount(),g=d.gutter/100,f,e;if(d.style&&d.style.width){return d.style.width}f=d.getPadding();e=(b?"width":"height");return(d.chart.chartBBox[e]-f[e])/(c*(g+1)-g)},getGutters:function(){var c=this,b=c.column,e=c.getPadding(),d=c.getBarGirth()/2,f=Math.ceil((b?e.left:e.bottom)+d),a=Math.ceil((b?e.right:e.top)+d);return{lower:f,upper:a,verticalAxis:!b}},getBounds:function(){var n=this,S=n.chart,b=S.getChartStore(),R=b.data.items,Q,y,E,w=[].concat(n.yField),k,o=w.length,l=o,c=n.groupGutter/100,J=n.column,O=n.getPadding(),M=n.stacked,u=n.getBarGirth(),z=J?"width":"height",v=Math,C=v.min,h=v.max,m=v.abs,H=n.getAxesForXAndYFields(),B=H.yAxis,I,s,L,g,r,P,D,e,p,G,q,t,F,A,a,x,K,N,d,f;n.setBBox(true);p=n.bbox;if(n.__excludes){for(N=0,x=n.__excludes.length;N<x;N++){if(n.__excludes[N]){l--}}}t=S.axes.get(B);if(t){P=t.applyData();G=P.from;q=P.to}if(n.yField&&!Ext.isNumber(G)){F=n.getMinMaxYValues();G=F[0];q=F[1]}if(!Ext.isNumber(G)){G=0}if(!Ext.isNumber(q)){q=0}A=(J?p.height-O.height:p.width-O.width)/(q-G);D=u;e=(u/((M?1:l)*(c+1)-c));if(z in n.style){e=C(e,n.style[z]);D=e*((M?1:l)*(c+1)-c)}a=(J)?p.y+p.height-O.bottom:p.x+O.left;if(M){x=[[],[]];for(Q=0,y=R.length;Q<y;Q++){E=R[Q];x[0][Q]=x[0][Q]||0;x[1][Q]=x[1][Q]||0;for(N=0;N<o;N++){if(n.__excludes&&n.__excludes[N]){continue}K=E.get(w[N]);x[+(K>0)][Q]+=m(K)}}x[+(q>0)].push(m(q));x[+(G>0)].push(m(G));f=h.apply(v,x[0]);d=h.apply(v,x[1]);A=(J?p.height-O.height:p.width-O.width)/(d+f);a=a+f*A*(J?-1:1)}else{if(G/q<0){a=a-G*A*(J?-1:1)}}if(n.boundColumn){t=S.axes.get(H.xAxis);if(t){P=t.applyData();I=P.from;s=P.to}if(n.xField&&!Ext.isNumber(I)){F=n.getMinMaxYValues();I=F[0];s=F[1]}if(!Ext.isNumber(I)){I=0}if(!Ext.isNumber(s)){s=0}r=n.getGutters();L=(p.width-(r.lower+r.upper))/((s-I)||1);g=p.x+r.lower;k=[];for(Q=0,y=R.length;Q<y;Q++){E=R[Q];K=E.get(n.xField);k[Q]=g+(K-I)*L-(e/2)}}return{bars:w,barsLoc:k,bbox:p,shrunkBarWidth:D,barsLen:o,groupBarsLen:l,barWidth:u,groupBarWidth:e,scale:A,zero:a,padding:O,signed:G/q<0,minY:G,maxY:q}},getPaths:function(){var t=this,Y=t.chart,b=Y.getChartStore(),X=b.data.items,V,D,K,F=t.bounds=t.getBounds(),x=t.items=[],O=Ext.isArray(t.yField)?t.yField:[t.yField],l=t.gutter/100,c=t.groupGutter/100,S=Y.animate,M=t.column,v=t.group,m=Y.shadow,Q=t.shadowGroups,P=t.shadowAttributes,p=Q.length,w=F.bbox,z=F.barWidth,J=F.shrunkBarWidth,U=t.getPadding(),R=t.stacked,u=F.barsLen,N=t.colorArrayStyle,h=N&&N.length||0,g=t.themeIdx,A=Math,n=A.max,H=A.min,s=A.abs,T,Z,e,I,C,a,k,r,q,o,f,aa,B,d,E,y,L,G,W;for(V=0,D=X.length;V<D;V++){K=X[V];a=F.zero;k=F.zero;I=0;C=0;aa=B=0;r=false;for(T=0,f=0;T<u;T++){if(t.__excludes&&t.__excludes[T]){continue}Z=K.get(F.bars[T]);if(Z>=0){aa+=Z}else{B+=Z}e=Math.round((Z-n(F.minY,0))*F.scale);W=g+(u>1?T:0);q={fill:N[W%h]};if(M){Ext.apply(q,{height:e,width:n(F.groupBarWidth,0),x:(t.boundColumn?F.barsLoc[V]:(w.x+U.left+(z-J)*0.5+V*z*(1+l)+f*F.groupBarWidth*(1+c)*!R)),y:a-e})}else{L=(D-1)-V;Ext.apply(q,{height:n(F.groupBarWidth,0),width:e+(a==F.zero),x:a+(a!=F.zero),y:(w.y+U.top+(z-J)*0.5+L*z*(1+l)+f*F.groupBarWidth*(1+c)*!R+1)})}if(e<0){if(M){q.y=k;q.height=s(e)}else{q.x=k+e;q.width=s(e)}}if(R){if(e<0){k+=e*(M?-1:1)}else{a+=e*(M?-1:1)}I+=s(e);if(e<0){C+=s(e)}}q.x=Math.floor(q.x)+1;G=Math.floor(q.y);if(Ext.isIE8m&&q.y>G){G--}q.y=G;q.width=Math.floor(q.width);q.height=Math.floor(q.height);x.push({series:t,yField:O[T],storeItem:K,value:[K.get(t.xField),Z],attr:q,point:M?[q.x+q.width/2,Z>=0?q.y:q.y+q.height]:[Z>=0?q.x+q.width:q.x,q.y+q.height/2]});if(S&&Y.resizing){o=M?{x:q.x,y:F.zero,width:q.width,height:0}:{x:F.zero,y:q.y,width:0,height:q.height};if(m&&(R&&!r||!R)){r=true;for(d=0;d<p;d++){E=Q[d].getAt(R?V:(V*u+T));if(E){E.setAttributes(o,true)}}}y=v.getAt(V*u+T);if(y){y.setAttributes(o,true)}}f++}if(R&&x.length){x[V*f].totalDim=I;x[V*f].totalNegDim=C;x[V*f].totalPositiveValues=aa;x[V*f].totalNegativeValues=B}}if(R&&f==0){for(V=0,D=X.length;V<D;V++){for(d=0;d<p;d++){E=Q[d].getAt(V);if(E){E.hide(true)}}}}},renderShadows:function(t,u,x,k){var y=this,o=y.chart,r=o.surface,f=o.animate,w=y.stacked,a=y.shadowGroups,v=y.shadowAttributes,n=a.length,g=o.getChartStore(),d=y.column,q=y.items,b=[],l=k.zero,e,p,h,z,m,s,c;if((w&&(t%k.groupBarsLen===0))||!w){s=t/k.groupBarsLen;for(e=0;e<n;e++){p=Ext.apply({},v[e]);h=a[e].getAt(w?s:t);Ext.copyTo(p,u,"x,y,width,height");if(!h){h=r.add(Ext.apply({type:"rect",group:a[e]},Ext.apply({},x,p)))}if(w){z=q[t].totalDim;m=q[t].totalNegDim;if(d){p.y=l+m-z-1;p.height=z}else{p.x=l-m;p.width=z}}c=y.renderer(h,g.getAt(s),p,t,g);c.hidden=!!u.hidden;if(f){y.onAnimate(h,{to:c})}else{h.setAttributes(c,true)}b.push(h)}}return b},drawSeries:function(){var F=this,r=F.chart,l=r.getChartStore(),w=r.surface,h=r.animate,C=F.stacked,d=F.column,D=r.axes,x=F.getAxesForXAndYFields(),v=x.xAxis,m=x.yAxis,b=r.shadow,a=F.shadowGroups,q=a.length,o=F.group,f=F.seriesStyle,s,p,A,z,E,t,c,e,g,n,k,B,u,y;if(!l||!l.getCount()||F.seriesIsHidden){F.hide();F.items=[];return}k=Ext.apply({},this.style,f);delete k.fill;delete k.x;delete k.y;delete k.width;delete k.height;F.unHighlightItem();F.cleanHighlights();F.boundColumn=(v&&Ext.Array.contains(F.axis,v)&&D.get(v)&&D.get(v).isNumericAxis);F.getPaths();n=F.bounds;s=F.items;E=d?{y:n.zero,height:0}:{x:n.zero,width:0};p=s.length;for(A=0;A<p;A++){t=o.getAt(A);B=s[A].attr;if(b){s[A].shadows=F.renderShadows(A,B,E,n)}if(!t){u=Ext.apply({},E,B);u=Ext.apply(u,k||{});t=w.add(Ext.apply({},{type:"rect",group:o},u))}if(h){c=F.renderer(t,l.getAt(A),B,A,l);t._to=c;y=F.onAnimate(t,{to:Ext.apply(c,k)});if(b&&C&&(A%n.barsLen===0)){z=A/n.barsLen;for(e=0;e<q;e++){y.on("afteranimate",function(){this.show(true)},a[e].getAt(z))}}}else{c=F.renderer(t,l.getAt(A),Ext.apply(B,{hidden:false}),A,l);t.setAttributes(Ext.apply(c,k),true)}s[A].sprite=t}p=o.getCount();for(z=A;z<p;z++){o.getAt(z).hide(true)}if(F.stacked){A=l.getCount()}if(b){for(e=0;e<q;e++){g=a[e];p=g.getCount();for(z=A;z<p;z++){g.getAt(z).hide(true)}}}F.renderLabels()},onCreateLabel:function(e,k,d,f){var g=this,a=g.chart.surface,j=g.labelsGroup,b=g.label,c=Ext.apply({},b,g.seriesLabelStyle||{}),h;return a.add(Ext.apply({type:"text",group:j},c||{}))},onPlaceLabel:function(I,P,s,L,p,K,v){var l=this,m=l.bounds,d=m.groupBarWidth,H=l.column,N=l.chart,u=N.chartBBox,C=N.resizing,o=s.value[0],Q=s.value[1],k=s.attr,A=l.label,J=l.stacked,g=A.stackedDisplay,M=(A.orientation=="vertical"),h=[].concat(A.field),t=A.renderer,r,f,a,c,b=m.zero,q="insideStart",O="insideEnd",j="outside",F="over",n="under",G=4,E=2,e=m.signed,D,B,z;if(p==q||p==O||p==j){if(J&&(p==j)){I.hide(true);return}I.setAttributes({style:undefined});r=(Ext.isNumber(v)?t(P.get(h[v]),I,P,s,L,p,K,v):"");I.setAttributes({text:r});f=l.getLabelSize(r,I.attr.style);a=f.width;c=f.height;if(H){if(!a||!c||(J&&(k.height<c))){I.hide(true);return}D=k.x+(M?d/2:(d-a)/2);if(p==j){var w=(Q>=0?(k.y-u.y):(u.y+u.height-k.y-k.height));if(w<c+E){p=O}}if(!J&&(p!=j)){if(c+E>k.height){p=j}}if(!B){B=k.y;if(Q>=0){switch(p){case q:B+=k.height+(M?-E:-c/2);break;case O:B+=(M?c+G:c/2);break;case j:B+=(M?-E:-c/2);break}}else{switch(p){case q:B+=(M?c+E:c/2);break;case O:B+=(M?k.height-E:k.height-c/2);break;case j:B+=(M?k.height+c+E:k.height+c/2);break}}}}else{if(!a||!c||(J&&!k.width)){I.hide(true);return}B=k.y+(M?(d+c)/2:d/2);if(p==j){var w=(Q>=0?(u.x+u.width-k.x-k.width):(k.x-u.x));if(w<a+G){p=O}}if((p!=j)&&!M){if(a+G>k.width){if(J){if(c>k.width){I.hide(true);return}D=k.x+k.width/2;B=k.y+k.height-(k.height-a)/2;M=true}else{p=j}}}if(!D){D=k.x;if(Q>=0){switch(p){case q:D+=(M?a/2:G);break;case O:D+=k.width+(M?-a/2:-a-G);break;case j:D+=k.width+(M?a/2:G);break}}else{switch(p){case q:D+=k.width+(M?-a/2:-a-G);break;case O:D+=(M?a/2:G);break;case j:D+=(M?-a/2:-a-G);break}}}}}else{if(p==F||p==n){if(J&&g){r=I.attr.text;I.setAttributes({style:Ext.applyIf((I.attr&&I.attr.style)||{},{"font-weight":"bold","font-size":"14px"})});f=l.getLabelSize(r,I.attr.style);a=f.width;c=f.height;switch(p){case F:if(H){D=k.x+(M?d/2:(d-a)/2);B=b-(s.totalDim-s.totalNegDim)-c/2-E}else{D=b+(s.totalDim-s.totalNegDim)+G;B=k.y+(M?(d+c)/2:d/2)}break;case n:if(H){D=k.x+(M?d/2:(d-a)/2);B=b+s.totalNegDim+c/2}else{D=b-s.totalNegDim-a-G;B=k.y+(M?(d+c)/2:d/2)}break}}}}if(D==undefined||B==undefined){I.hide(true);return}I.isOutside=(p==j);I.setAttributes({text:r});z={x:D,y:B};if(M){z.rotate={x:D,y:B,degrees:270}}if(K&&C){if(H){D=k.x+k.width/2;B=b}else{D=b;B=k.y+k.height/2}I.setAttributes({x:D,y:B},true);if(M){I.setAttributes({rotate:{x:D,y:B,degrees:270}},true)}}if(K){l.onAnimate(I,{to:z})}else{I.setAttributes(Ext.apply(z,{hidden:false}),true)}},getLabelSize:function(g,f){var k=this.testerLabel,a=this.label,d=Ext.apply({},a,f,this.seriesLabelStyle||{}),b=a.orientation==="vertical",j,i,e,c;if(!k){k=this.testerLabel=this.chart.surface.add(Ext.apply({type:"text",opacity:0},d))}k.setAttributes({style:f,text:g},true);j=k.getBBox();i=j.width;e=j.height;return{width:b?e:i,height:b?i:e}},onAnimate:function(b,a){b.show();return this.callParent(arguments)},isItemInPoint:function(a,d,b){var c=b.sprite.getBBox();return c.x<=a&&c.y<=d&&(c.x+c.width)>=a&&(c.y+c.height)>=d},hideAll:function(a){var e=this.chart.axes,c=e.items,d=c.length,b=0;a=(isNaN(this._index)?a:this._index)||0;if(!this.__excludes){this.__excludes=[]}this.__excludes[a]=true;this.drawSeries();for(b;b<d;b++){c[b].drawAxis()}},showAll:function(a){var e=this.chart.axes,c=e.items,d=c.length,b=0;a=(isNaN(this._index)?a:this._index)||0;if(!this.__excludes){this.__excludes=[]}this.__excludes[a]=false;this.drawSeries();for(b;b<d;b++){c[b].drawAxis()}},getLegendColor:function(a){var c=this,b=c.colorArrayStyle.length;if(c.style&&c.style.fill){return c.style.fill}else{return c.colorArrayStyle[a%b]}},highlightItem:function(a){this.callParent(arguments);this.renderLabels()},unHighlightItem:function(){this.callParent(arguments);this.renderLabels()},cleanHighlights:function(){this.callParent(arguments);this.renderLabels()}});