Ext.define("Ext.chart.series.Scatter",{extend:"Ext.chart.series.Cartesian",requires:["Ext.chart.axis.Axis","Ext.chart.Shape","Ext.fx.Anim"],type:"scatter",alias:"series.scatter",constructor:function(c){this.callParent(arguments);var e=this,f=e.chart.shadow,a=e.chart.surface,d,b;Ext.apply(e,c,{style:{},markerConfig:{},shadowAttributes:[{"stroke-width":6,"stroke-opacity":0.05,stroke:"rgb(0, 0, 0)"},{"stroke-width":4,"stroke-opacity":0.1,stroke:"rgb(0, 0, 0)"},{"stroke-width":2,"stroke-opacity":0.15,stroke:"rgb(0, 0, 0)"}]});e.group=a.getGroup(e.seriesId);if(f){for(d=0,b=e.shadowAttributes.length;d<b;d++){e.shadowGroups.push(a.getGroup(e.seriesId+"-shadows"+d))}}},getBounds:function(){var r=this,h=r.chart,d=h.getChartStore(),n=h.axes,k=r.getAxesForXAndYFields(),j=k.xAxis,e=k.yAxis,a,s,c,f,q,o,p,m,l,b,g;r.setBBox();a=r.bbox;if(b=n.get(j)){g=b.applyData();q=g.from;p=g.to}if(b=n.get(e)){g=b.applyData();o=g.from;m=g.to}if(r.xField&&!Ext.isNumber(q)){b=r.getMinMaxXValues();q=b[0];p=b[1]}if(r.yField&&!Ext.isNumber(o)){b=r.getMinMaxYValues();o=b[0];m=b[1]}if(isNaN(q)){q=0;p=d.getCount()-1;s=a.width/(d.getCount()-1)}else{s=a.width/(p-q)}if(isNaN(o)){o=0;m=d.getCount()-1;c=a.height/(d.getCount()-1)}else{c=a.height/(m-o)}return{bbox:a,minX:q,minY:o,xScale:s,yScale:c}},getPaths:function(){var w=this,m=w.chart,b=m.shadow,e=m.getChartStore(),A=e.data.items,r,k,d,h=w.group,f=w.bounds=w.getBounds(),a=w.bbox,B=f.xScale,c=f.yScale,u=f.minX,t=f.minY,z=a.x,v=a.y,g=a.height,n=w.items=[],p=[],l,j,q,s,o;for(r=0,k=A.length;r<k;r++){d=A[r];q=d.get(w.xField);s=d.get(w.yField);if(typeof s=="undefined"||(typeof s=="string"&&!s)||q==null||s==null){if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("[Ext.chart.series.Scatter]  Skipping a store element with a value which is either undefined or null  at ",d,q,s)}continue}if(typeof q=="string"||typeof q=="object"&&!Ext.isDate(q)){q=r}if(typeof s=="string"||typeof s=="object"&&!Ext.isDate(s)){s=r}l=z+(q-u)*B;j=v+g-(s-t)*c;p.push({x:l,y:j});w.items.push({series:w,value:[q,s],point:[l,j],storeItem:d});if(m.animate&&m.resizing){o=h.getAt(r);if(o){w.resetPoint(o);if(b){w.resetShadow(o)}}}}return p},resetPoint:function(a){var b=this.bbox;a.setAttributes({translate:{x:(b.x+b.width)/2,y:(b.y+b.height)/2}},true)},resetShadow:function(c){var f=this,e=c.shadows,h=f.shadowAttributes,d=f.shadowGroups.length,g=f.bbox,b,a;for(b=0;b<d;b++){a=Ext.apply({},h[b]);if(a.translate){a.translate.x+=(g.x+g.width)/2;a.translate.y+=(g.y+g.height)/2}else{a.translate={x:(g.x+g.width)/2,y:(g.y+g.height)/2}}e[b].setAttributes(a,true)}},createPoint:function(a,c){var d=this,b=d.chart,e=d.group,f=d.bbox;return Ext.chart.Shape[c](b.surface,Ext.apply({},{x:0,y:0,group:e,translate:{x:(f.x+f.width)/2,y:(f.y+f.height)/2}},a))},createShadow:function(m,f,j){var h=this,g=h.chart,k=h.shadowGroups,d=h.shadowAttributes,a=k.length,n=h.bbox,c,l,b,e;m.shadows=b=[];for(c=0;c<a;c++){e=Ext.apply({},d[c]);if(e.translate){e.translate.x+=(n.x+n.width)/2;e.translate.y+=(n.y+n.height)/2}else{Ext.apply(e,{translate:{x:(n.x+n.width)/2,y:(n.y+n.height)/2}})}Ext.apply(e,f);l=Ext.chart.Shape[j](g.surface,Ext.apply({},{x:0,y:0,group:k[c]},e));b.push(l)}},drawSeries:function(){var t=this,k=t.chart,g=k.getChartStore(),h=t.group,c=k.shadow,a=t.shadowGroups,p=t.shadowAttributes,q=a.length,l,m,n,j,o,s,e,f,b,d,r;s=Ext.apply(t.markerStyle,t.markerConfig);f=s.type||"circle";delete s.type;if(!g||!g.getCount()){t.hide();t.items=[];return}t.unHighlightItem();t.cleanHighlights();m=t.getPaths();j=m.length;for(o=0;o<j;o++){n=m[o];l=h.getAt(o);Ext.apply(n,s);if(!l){l=t.createPoint(n,f);if(c){t.createShadow(l,s,f)}}b=l.shadows;if(k.animate){d=t.renderer(l,g.getAt(o),{translate:n},o,g);l._to=d;t.onAnimate(l,{to:d});for(e=0;e<q;e++){r=Ext.apply({},p[e]);d=t.renderer(b[e],g.getAt(o),Ext.apply({},{hidden:false,translate:{x:n.x+(r.translate?r.translate.x:0),y:n.y+(r.translate?r.translate.y:0)}},r),o,g);t.onAnimate(b[e],{to:d})}}else{d=t.renderer(l,g.getAt(o),{translate:n},o,g);l._to=d;l.setAttributes(d,true);for(e=0;e<q;e++){r=Ext.apply({},p[e]);d=t.renderer(b[e],g.getAt(o),Ext.apply({},{hidden:false,translate:{x:n.x+(r.translate?r.translate.x:0),y:n.y+(r.translate?r.translate.y:0)}},r),o,g);b[e].setAttributes(d,true)}}t.items[o].sprite=l}j=h.getCount();for(o=m.length;o<j;o++){h.getAt(o).hide(true)}t.renderLabels();t.renderCallouts()},onCreateLabel:function(d,j,c,e){var f=this,g=f.labelsGroup,a=f.label,b=Ext.apply({},a,f.seriesLabelStyle),h=f.bbox;return f.chart.surface.add(Ext.apply({type:"text","text-anchor":"middle",group:g,x:Number(j.point[0]),y:h.y+h.height/2},b))},onPlaceLabel:function(g,k,v,s,q,d,e){var z=this,l=z.chart,u=l.resizing,w=z.label,t=w.renderer,b=w.field,a=z.bbox,j=Number(v.point[0]),h=Number(v.point[1]),c=v.sprite.attr.radius,r,o,n,m,A,f,p;g.setAttributes({text:t(k.get(b),g,k,v,s,q,d,e),hidden:true},true);o=v.sprite.getBBox();o.width=o.width||(c*2);o.height=o.height||(c*2);r=g.getBBox();n=r.width/2;m=r.height/2;if(q=="rotate"){A=o.width/2+n+m/2;if(j+A+n>a.x+a.width){j-=A}else{j+=A}g.setAttributes({rotation:{x:j,y:h,degrees:-45}},true)}else{if(q=="under"||q=="over"){g.setAttributes({rotation:{degrees:0}},true);if(j<a.x+n){j=a.x+n}else{if(j+n>a.x+a.width){j=a.x+a.width-n}}f=o.height/2+m;h=h+(q=="over"?-f:f);if(h<a.y+m){h+=2*f}else{if(h+m>a.y+a.height){h-=2*f}}}}if(!l.animate){g.setAttributes({x:j,y:h},true);g.show(true)}else{if(u){p=v.sprite.getActiveAnimation();if(p){p.on("afteranimate",function(){g.setAttributes({x:j,y:h},true);g.show(true)})}else{g.show(true)}}else{z.onAnimate(g,{to:{x:j,y:h}})}}},onPlaceCallout:function(j,l,A,w,v,c,g){var D=this,m=D.chart,t=m.surface,z=m.resizing,C=D.callouts,n=D.items,b=A.point,E,a=j.label.getBBox(),B=30,s=10,r=3,e,d,f,q,o,u=D.bbox,k,h;E=[Math.cos(Math.PI/4),-Math.sin(Math.PI/4)];k=b[0]+E[0]*B;h=b[1]+E[1]*B;e=k+(E[0]>0?0:-(a.width+2*r));d=h-a.height/2-r;f=a.width+2*r;q=a.height+2*r;if(e<u[0]||(e+f)>(u[0]+u[2])){E[0]*=-1}if(d<u[1]||(d+q)>(u[1]+u[3])){E[1]*=-1}k=b[0]+E[0]*B;h=b[1]+E[1]*B;e=k+(E[0]>0?0:-(a.width+2*r));d=h-a.height/2-r;f=a.width+2*r;q=a.height+2*r;if(m.animate){D.onAnimate(j.lines,{to:{path:["M",b[0],b[1],"L",k,h,"Z"]}},true);D.onAnimate(j.box,{to:{x:e,y:d,width:f,height:q}},true);D.onAnimate(j.label,{to:{x:k+(E[0]>0?r:-(a.width+r)),y:h}},true)}else{j.lines.setAttributes({path:["M",b[0],b[1],"L",k,h,"Z"]},true);j.box.setAttributes({x:e,y:d,width:f,height:q},true);j.label.setAttributes({x:k+(E[0]>0?r:-(a.width+r)),y:h},true)}for(o in j){j[o].show(true)}},onAnimate:function(b,a){b.show();return this.callParent(arguments)},isItemInPoint:function(c,g,e){var b,d=10,a=Math.abs;function f(h){var j=a(h[0]-c),i=a(h[1]-g);return Math.sqrt(j*j+i*i)}b=e.point;return(b[0]-d<=c&&b[0]+d>=c&&b[1]-d<=g&&b[1]+d>=g)}});