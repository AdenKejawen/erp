Ext.define("Ext.chart.series.Area",{extend:"Ext.chart.series.Cartesian",alias:"series.area",requires:["Ext.chart.axis.Axis","Ext.draw.Color","Ext.fx.Anim"],type:"area",stacked:true,style:{},constructor:function(c){this.callParent(arguments);var e=this,a=e.chart.surface,d,b;c.highlightCfg=Ext.Object.merge({},{lineWidth:3,stroke:"#55c",opacity:0.8,color:"#f00"},c.highlightCfg);Ext.apply(e,c,{__excludes:[]});if(e.highlight){e.highlightSprite=a.add({type:"path",path:["M",0,0],zIndex:1000,opacity:0.3,lineWidth:5,hidden:true,stroke:"#444"})}e.group=a.getGroup(e.seriesId)},shrink:function(b,m,n){var h=b.length,l=Math.floor(h/n),g,f,d=0,k=this.areas.length,a=[],e=[],c=[];for(f=0;f<k;++f){a[f]=0}for(g=0;g<h;++g){d+=+b[g];for(f=0;f<k;++f){a[f]+=+m[g][f]}if(g%l==0){e.push(d/l);for(f=0;f<k;++f){a[f]/=l}c.push(a);d=0;for(f=0,a=[];f<k;++f){a[f]=0}}}return{x:e,y:c}},getBounds:function(){var h=this,M=h.chart,a=M.getChartStore(),L=a.data.items,I,F,w,u=[].concat(h.yField),z=u.length,y=[],C=[],f=Infinity,B=f,A=f,m=-f,k=-f,r=Math,v=r.min,e=r.max,o=h.getAxesForXAndYFields(),J=o.xAxis,t=o.yAxis,G,q,D,j,g,E,p,N,K,b,s,H,c,d,n,x;h.setBBox();j=h.bbox;if(n=M.axes.get(J)){if(n.type==="Time"){q=true}G=n.applyData();B=G.from;m=G.to}if(n=M.axes.get(t)){G=n.applyData();A=G.from;k=G.to}if(h.xField&&!Ext.isNumber(B)){n=h.getMinMaxXValues();q=true;B=n[0];m=n[1]}if(h.yField&&!Ext.isNumber(A)){n=h.getMinMaxYValues();A=n[0];k=n[1]}if(!Ext.isNumber(A)){A=0}if(!Ext.isNumber(k)){k=0}F=L.length;if(F>0&&q){D=L[0].get(h.xField);if(typeof D!="number"){D=+D;if(isNaN(D)){q=false}}}for(I=0;I<F;I++){w=L[I];p=w.get(h.xField);N=[];if(typeof p!="number"){if(q){p=+p}else{p=I}}y.push(p);b=0;for(K=0;K<z;K++){if(h.__excludes[K]){continue}d=w.get(u[K]);if(typeof d=="number"){N.push(d)}}C.push(N)}g=j.width/((m-B)||1);E=j.height/((k-A)||1);s=y.length;if((s>j.width)&&h.areas){H=h.shrink(y,C,j.width);y=H.x;C=H.y}return{bbox:j,minX:B,minY:A,xValues:y,yValues:C,xScale:g,yScale:E,areasLen:z}},getPaths:function(){var w=this,l=w.chart,c=l.getChartStore(),e=true,f=w.getBounds(),a=f.bbox,m=w.items=[],v=[],b,d=0,o=[],r,h,j,g,p,t,k,z,q,u,n,s;h=f.xValues.length;for(r=0;r<h;r++){p=f.xValues[r];t=f.yValues[r];j=a.x+(p-f.minX)*f.xScale;if(s===undefined){s=j}k=0;d=0;for(z=0;z<f.areasLen;z++){if(w.__excludes[z]){continue}if(!v[z]){v[z]=[]}u=t[d];k+=u;g=a.y+a.height-(k-f.minY)*f.yScale;if(!o[z]){o[z]=["M",j,g];v[z].push(["L",j,g])}else{o[z].push("L",j,g);v[z].push(["L",j,g])}if(!m[z]){m[z]={pointsUp:[],pointsDown:[],series:w}}m[z].pointsUp.push([j,g]);d++}}for(z=0;z<f.areasLen;z++){if(w.__excludes[z]){continue}n=o[z];if(z==0||e){e=false;n.push("L",j,a.y+a.height,"L",s,a.y+a.height,"Z")}else{b=v[q];b.reverse();n.push("L",j,b[0][2]);for(r=0;r<h;r++){n.push(b[r][0],b[r][1],b[r][2]);m[z].pointsDown[h-r-1]=[b[r][1],b[r][2]]}n.push("L",s,n[2],"Z")}q=z}return{paths:o,areasLen:f.areasLen}},drawSeries:function(){var h=this,g=h.chart,j=g.getChartStore(),d=g.surface,c=g.animate,l=h.group,b=Ext.apply(h.seriesStyle,h.style),m=h.colorArrayStyle,p=m&&m.length||0,a=h.themeIdx,e,f,o,n,k,i;h.unHighlightItem();h.cleanHighlights();if(!j||!j.getCount()||h.seriesIsHidden){h.hide();h.items=[];return}o=h.getPaths();if(!h.areas){h.areas=[]}for(e=0;e<o.areasLen;e++){if(h.__excludes[e]){continue}i=a+e;if(!h.areas[e]){h.items[e].sprite=h.areas[e]=d.add(Ext.apply({},{type:"path",group:l,path:o.paths[e],stroke:b.stroke||m[i%p],fill:m[i%p]},b||{}))}f=h.areas[e];n=o.paths[e];if(c){k=h.renderer(f,false,{path:n,fill:m[e%p],stroke:b.stroke||m[e%p]},e,j);h.animation=h.onAnimate(f,{to:k})}else{k=h.renderer(f,false,{path:n,hidden:false,fill:m[i%p],stroke:b.stroke||m[i%p]},e,j);h.areas[e].setAttributes(k,true)}}h.renderLabels();h.renderCallouts()},onAnimate:function(b,a){b.show();return this.callParent(arguments)},onCreateLabel:function(d,j,c,e){return null;var f=this,g=f.labelsGroup,a=f.label,h=f.bbox,b=Ext.apply({},a,f.seriesLabelStyle||{});return f.chart.surface.add(Ext.apply({type:"text","text-anchor":"middle",group:g,x:Number(j.point[0]),y:h.y+h.height/2},b||{}))},onPlaceLabel:function(e,h,r,o,m,c,d){var t=this,j=t.chart,q=j.resizing,s=t.label,p=s.renderer,b=s.field,a=t.bbox,g=Number(r.point[o][0]),f=Number(r.point[o][1]),n,l,k;e.setAttributes({text:p(h.get(b[d]),e,h,r,o,m,c,d),hidden:true},true);n=e.getBBox();l=n.width/2;k=n.height/2;if(g<a.x+l){g=a.x+l}else{if(g+l>a.x+a.width){g=a.x+a.width-l}}f=f-k;if(f<a.y+k){f+=2*k}else{if(f+k>a.y+a.height){f-=2*k}}if(t.chart.animate&&!t.chart.resizing){e.show(true);t.onAnimate(e,{to:{x:g,y:f}})}else{e.setAttributes({x:g,y:f},true);if(q&&t.animation){t.animation.on("afteranimate",function(){e.show(true)})}else{e.show(true)}}},onPlaceCallout:function(l,q,I,F,E,d,j){var L=this,r=L.chart,C=r.surface,G=r.resizing,K=L.callouts,s=L.items,u=(F==0)?false:s[F-1].point,w=(F==s.length-1)?false:s[F+1].point,c=I.point,z,f,M,J,n,o,b=(l&&l.label?l.label.getBBox():{width:0,height:0}),H=30,B=10,A=3,g,e,h,v,t,D=L.clipRect,m,k;if(!b.width||!b.height){return}if(!u){u=c}if(!w){w=c}J=(w[1]-u[1])/(w[0]-u[0]);n=(c[1]-u[1])/(c[0]-u[0]);o=(w[1]-c[1])/(w[0]-c[0]);f=Math.sqrt(1+J*J);z=[1/f,J/f];M=[-z[1],z[0]];if(n>0&&o<0&&M[1]<0||n<0&&o>0&&M[1]>0){M[0]*=-1;M[1]*=-1}else{if(Math.abs(n)<Math.abs(o)&&M[0]<0||Math.abs(n)>Math.abs(o)&&M[0]>0){M[0]*=-1;M[1]*=-1}}m=c[0]+M[0]*H;k=c[1]+M[1]*H;g=m+(M[0]>0?0:-(b.width+2*A));e=k-b.height/2-A;h=b.width+2*A;v=b.height+2*A;if(g<D[0]||(g+h)>(D[0]+D[2])){M[0]*=-1}if(e<D[1]||(e+v)>(D[1]+D[3])){M[1]*=-1}m=c[0]+M[0]*H;k=c[1]+M[1]*H;g=m+(M[0]>0?0:-(b.width+2*A));e=k-b.height/2-A;h=b.width+2*A;v=b.height+2*A;l.lines.setAttributes({path:["M",c[0],c[1],"L",m,k,"Z"]},true);l.box.setAttributes({x:g,y:e,width:h,height:v},true);l.label.setAttributes({x:m+(M[0]>0?A:-(b.width+A)),y:k},true);for(t in l){l[t].show(true)}},isItemInPoint:function(h,g,l,c){var f=this,b=l.pointsUp,d=l.pointsDown,o=Math.abs,n=false,k=false,e=Infinity,a,m,j;for(a=0,m=b.length;a<m;a++){j=[b[a][0],b[a][1]];n=false;k=a==m-1;if(e>o(h-j[0])){e=o(h-j[0]);n=true;if(k){++a}}if(!n||(n&&k)){j=b[a-1];if(g>=j[1]&&(!d.length||g<=(d[a-1][1]))){l.storeIndex=a-1;l.storeField=f.yField[c];l.storeItem=f.chart.getChartStore().getAt(a-1);l._points=d.length?[j,d[a-1]]:[j];return true}else{break}}}return false},highlightSeries:function(){var a,c,b;if(this._index!==undefined){a=this.areas[this._index];if(a.__highlightAnim){a.__highlightAnim.paused=true}a.__highlighted=true;a.__prevOpacity=a.__prevOpacity||a.attr.opacity||1;a.__prevFill=a.__prevFill||a.attr.fill;a.__prevLineWidth=a.__prevLineWidth||a.attr.lineWidth;b=Ext.draw.Color.fromString(a.__prevFill);c={lineWidth:(a.__prevLineWidth||0)+2};if(b){c.fill=b.getLighter(0.2).toString()}else{c.opacity=Math.max(a.__prevOpacity-0.3,0)}if(this.chart.animate){a.__highlightAnim=new Ext.fx.Anim(Ext.apply({target:a,to:c},this.chart.animate))}else{a.setAttributes(c,true)}}},unHighlightSeries:function(){var a;if(this._index!==undefined){a=this.areas[this._index];if(a.__highlightAnim){a.__highlightAnim.paused=true}if(a.__highlighted){a.__highlighted=false;a.__highlightAnim=new Ext.fx.Anim({target:a,to:{fill:a.__prevFill,opacity:a.__prevOpacity,lineWidth:a.__prevLineWidth}})}}},highlightItem:function(c){var b=this,a,d;if(!c){this.highlightSeries();return}a=c._points;d=a.length==2?["M",a[0][0],a[0][1],"L",a[1][0],a[1][1]]:["M",a[0][0],a[0][1],"L",a[0][0],b.bbox.y+b.bbox.height];b.highlightSprite.setAttributes({path:d,hidden:false},true)},unHighlightItem:function(a){if(!a){this.unHighlightSeries()}if(this.highlightSprite){this.highlightSprite.hide(true)}},hideAll:function(a){var b=this;a=(isNaN(b._index)?a:b._index)||0;b.__excludes[a]=true;b.areas[a].hide(true);b.redraw()},showAll:function(a){var b=this;a=(isNaN(b._index)?a:b._index)||0;b.__excludes[a]=false;b.areas[a].show(true);b.redraw()},redraw:function(){var a=this,b;b=a.chart.legend.rebuild;a.chart.legend.rebuild=false;a.chart.redraw();a.chart.legend.rebuild=b},hide:function(){if(this.areas){var g=this,b=g.areas,d,c,a,f,e;if(b&&b.length){for(d=0,f=b.length;d<f;++d){if(b[d]){b[d].hide(true)}}g.hideLabels()}}},getLegendColor:function(a){var b=this;a+=b.themeIdx;return b.colorArrayStyle[a%b.colorArrayStyle.length]}});