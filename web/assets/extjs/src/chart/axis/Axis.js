Ext.define("Ext.chart.axis.Axis",{extend:"Ext.chart.axis.Abstract",alternateClassName:"Ext.chart.Axis",requires:["Ext.draw.Draw"],hidden:false,forceMinMax:false,dashSize:3,position:"bottom",skipFirst:false,length:0,width:0,adjustEnd:true,majorTickSteps:false,nullGutters:{lower:0,upper:0,verticalAxis:undefined},applyData:Ext.emptyFn,getRange:function(){var B=this,o=B.chart,h=o.getChartStore(),D=h.data.items,n=o.series.items,C=B.position,x,a=Ext.chart.series,t=[],s=Infinity,w=-Infinity,c=B.position==="left"||B.position==="right"||B.position==="radial",y,m,d,v,u,l=D.length,f,A={},r={},z=true,p,g,e,b,q;p=B.fields;for(v=0,m=p.length;v<m;v++){r[p[v]]=true}for(y=0,m=n.length;y<m;y++){if(n[y].seriesIsHidden){continue}if(!n[y].getAxesForXAndYFields){continue}x=n[y].getAxesForXAndYFields();if(x.xAxis&&x.xAxis!==C&&x.yAxis&&x.yAxis!==C){continue}if(a.Bar&&n[y] instanceof a.Bar&&!n[y].column){p=c?Ext.Array.from(n[y].xField):Ext.Array.from(n[y].yField)}else{p=c?Ext.Array.from(n[y].yField):Ext.Array.from(n[y].xField)}if(B.fields.length){for(v=0,d=p.length;v<d;v++){if(r[p[v]]){break}}if(v==d){continue}}if(f=n[y].stacked){if(a.Bar&&n[y] instanceof a.Bar){if(n[y].column!=c){f=false;z=false}}else{if(!c){f=false;z=false}}}if(f){g={};for(v=0;v<p.length;v++){if(z&&n[y].__excludes&&n[y].__excludes[v]){continue}if(!r[p[v]]){Ext.Logger.warn("Field `"+p[v]+"` is not included in the "+C+" axis config.")}r[p[v]]=g[p[v]]=true}t.push({fields:g,positiveValue:0,negativeValue:0})}else{if(!p||p.length==0){p=B.fields}for(v=0;v<p.length;v++){if(z&&n[y].__excludes&&n[y].__excludes[v]){continue}r[p[v]]=A[p[v]]=true}}}for(y=0;y<l;y++){e=D[y];for(u=0;u<t.length;u++){t[u].positiveValue=0;t[u].negativeValue=0}for(b in r){q=e.get(b);if(B.type=="Time"&&typeof q=="string"){q=Date.parse(q)}if(isNaN(q)){continue}if(q===undefined){q=0}else{q=Number(q)}if(A[b]){if(s>q){s=q}if(w<q){w=q}}for(u=0;u<t.length;u++){if(t[u].fields[b]){if(q>=0){t[u].positiveValue+=q;if(w<t[u].positiveValue){w=t[u].positiveValue}if(s>0){s=0}}else{t[u].negativeValue+=q;if(s>t[u].negativeValue){s=t[u].negativeValue}if(w<0){w=0}}}}}}if(!isFinite(w)){w=B.prevMax||0}if(!isFinite(s)){s=B.prevMin||0}if(typeof s==="number"){s=Ext.Number.correctFloat(s)}if(typeof w==="number"){w=Ext.Number.correctFloat(w)}if(s!=w&&(w!=Math.floor(w)||s!=Math.floor(s))){s=Math.floor(s);w=Math.floor(w)+1}if(!isNaN(B.minimum)){s=B.minimum}if(!isNaN(B.maximum)){w=B.maximum}if(s>=w){s=Math.floor(s);w=s+1}return{min:s,max:w}},calcEnds:function(){var g=this,d=g.getRange(),f=d.min,a=d.max,c,h,e,b;c=(Ext.isNumber(g.majorTickSteps)?g.majorTickSteps+1:g.steps);h=!(Ext.isNumber(g.maximum)&&Ext.isNumber(g.minimum)&&Ext.isNumber(g.majorTickSteps)&&g.majorTickSteps>0);e=Ext.draw.Draw.snapEnds(f,a,c,h);if(Ext.isNumber(g.maximum)){e.to=g.maximum;b=true}if(Ext.isNumber(g.minimum)){e.from=g.minimum;b=true}if(g.adjustMaximumByMajorUnit){e.to=Math.ceil(e.to/e.step)*e.step;b=true}if(g.adjustMinimumByMajorUnit){e.from=Math.floor(e.from/e.step)*e.step;b=true}if(b){e.steps=Math.ceil((e.to-e.from)/e.step)}g.prevMin=(f==a?0:f);g.prevMax=a;return e},drawAxis:function(M){var l=this,O,G=l.x,F=l.y,S=l.dashSize,o=l.length,H=l.position,b=(H=="left"||H=="right"),j=[],h=(l.isNumericAxis),s=l.applyData(),w=s.step,C=s.steps,E=Ext.isArray(C),g=s.from,R=s.to,f=(R-g)||1,P,v,u,K,A=l.minorTickSteps||0,z=l.minorTickSteps||0,n=Math.max(A+1,0),m=Math.max(z+1,0),I=(H=="left"||H=="top"?-1:1),d=S*I,c=l.chart.series.items,L=c[0],p=L?L.nullGutters:l.nullGutters,N,Q,q,D=0,B=0,a,J,t,r,e,k;l.from=g;l.to=R;if(l.hidden||(g>R)){return}if((E&&(C.length==0))||(!E&&isNaN(w))){return}if(E){C=Ext.Array.filter(C,function(x,i,y){return(+x>+l.from&&+x<+l.to)},this);C=Ext.Array.union([l.from],C,[l.to])}else{C=new Array;for(r=+l.from;r<+l.to;r+=w){C.push(r)}C.push(+l.to)}B=C.length;for(O=0,t=c.length;O<t;O++){if(c[O].seriesIsHidden){continue}if(!c[O].getAxesForXAndYFields){continue}J=c[O].getAxesForXAndYFields();if(!J.xAxis||!J.yAxis||(J.xAxis===H)||(J.yAxis===H)){p=c[O].getGutters();if((p.verticalAxis!==undefined)&&(p.verticalAxis!=b)){N=c[O].getPadding();if(b){p={lower:N.bottom,upper:N.top,verticalAxis:true}}else{p={lower:N.left,upper:N.right,verticalAxis:false}}}break}}if(h){l.labels=[]}if(p){if(b){v=Math.floor(G);K=["M",v+0.5,F,"l",0,-o];P=o-(p.lower+p.upper);for(a=0;a<B;a++){u=F-p.lower-(C[a]-C[0])*P/f;K.push("M",v,Math.floor(u)+0.5,"l",d*2,0);j.push([v,Math.floor(u)]);if(h){l.labels.push(C[a])}}}else{u=Math.floor(F);K=["M",G,u+0.5,"l",o,0];P=o-(p.lower+p.upper);for(a=0;a<B;a++){v=G+p.lower+(C[a]-C[0])*P/f;K.push("M",Math.floor(v)+0.5,u,"l",0,d*2+1);j.push([Math.floor(v),u]);if(h){l.labels.push(C[a])}}}}Q=(b?z:A);if(Ext.isArray(Q)){if(Q.length==2){q=+Ext.Date.add(new Date(),Q[0],Q[1])-Date.now()}else{q=Q[0]}}else{if(Ext.isNumber(Q)&&Q>0){q=w/(Q+1)}}if(p&&q){for(a=0;a<B-1;a++){e=+C[a];k=+C[a+1];if(b){for(value=e+q;value<k;value+=q){u=F-p.lower-(value-C[0])*P/f;K.push("M",v,Math.floor(u)+0.5,"l",d,0)}}else{for(value=e+q;value<k;value+=q){v=G+p.upper+(value-C[0])*P/f;K.push("M",Math.floor(v)+0.5,u,"l",0,d+1)}}}}if(!l.axis){l.axis=l.chart.surface.add(Ext.apply({type:"path",path:K},l.axisStyle))}l.axis.setAttributes({path:K},true);l.inflections=j;if(!M&&l.grid){l.drawGrid()}l.axisBBox=l.axis.getBBox();l.drawLabel()},drawGrid:function(){var s=this,n=s.chart.surface,b=s.grid,d=b.odd,e=b.even,g=s.inflections,h=g.length-((d||e)?0:1),t=s.position,c=s.chart.maxGutters,m=s.width-2,o,p,q=1,l=[],f,a,j,k=[],r=[];if(((c.bottom!==0||c.top!==0)&&(t=="left"||t=="right"))||((c.left!==0||c.right!==0)&&(t=="top"||t=="bottom"))){q=0;h++}for(;q<h;q++){o=g[q];p=g[q-1];if(d||e){l=(q%2)?k:r;f=((q%2)?d:e)||{};a=(f.lineWidth||f["stroke-width"]||0)/2;j=2*a;if(t=="left"){l.push("M",p[0]+1+a,p[1]+0.5-a,"L",p[0]+1+m-a,p[1]+0.5-a,"L",o[0]+1+m-a,o[1]+0.5+a,"L",o[0]+1+a,o[1]+0.5+a,"Z")}else{if(t=="right"){l.push("M",p[0]-a,p[1]+0.5-a,"L",p[0]-m+a,p[1]+0.5-a,"L",o[0]-m+a,o[1]+0.5+a,"L",o[0]-a,o[1]+0.5+a,"Z")}else{if(t=="top"){l.push("M",p[0]+0.5+a,p[1]+1+a,"L",p[0]+0.5+a,p[1]+1+m-a,"L",o[0]+0.5-a,o[1]+1+m-a,"L",o[0]+0.5-a,o[1]+1+a,"Z")}else{l.push("M",p[0]+0.5+a,p[1]-a,"L",p[0]+0.5+a,p[1]-m+a,"L",o[0]+0.5-a,o[1]-m+a,"L",o[0]+0.5-a,o[1]-a,"Z")}}}}else{if(t=="left"){l=l.concat(["M",o[0]+0.5,o[1]+0.5,"l",m,0])}else{if(t=="right"){l=l.concat(["M",o[0]-0.5,o[1]+0.5,"l",-m,0])}else{if(t=="top"){l=l.concat(["M",o[0]+0.5,o[1]+0.5,"l",0,m])}else{l=l.concat(["M",o[0]+0.5,o[1]-0.5,"l",0,-m])}}}}}if(d||e){if(k.length){if(!s.gridOdd&&k.length){s.gridOdd=n.add({type:"path",path:k})}s.gridOdd.setAttributes(Ext.apply({path:k,hidden:false},d||{}),true)}if(r.length){if(!s.gridEven){s.gridEven=n.add({type:"path",path:r})}s.gridEven.setAttributes(Ext.apply({path:r,hidden:false},e||{}),true)}}else{if(l.length){if(!s.gridLines){s.gridLines=s.chart.surface.add({type:"path",path:l,"stroke-width":s.lineWidth||1,stroke:s.gridColor||"#ccc"})}s.gridLines.setAttributes({hidden:false,path:l},true)}else{if(s.gridLines){s.gridLines.hide(true)}}}},getOrCreateLabel:function(c,f){var d=this,b=d.labelGroup,e=b.getAt(c),a=d.chart.surface;if(e){if(f!=e.attr.text){e.setAttributes(Ext.apply({text:f},d.label),true);e._bbox=e.getBBox()}}else{e=a.add(Ext.apply({group:b,type:"text",x:0,y:0,text:f},d.label));a.renderItem(e);e._bbox=e.getBBox()}if(d.label.rotation){e.setAttributes({rotation:{degrees:0}},true);e._ubbox=e.getBBox();e.setAttributes(d.label,true)}else{e._ubbox=e._bbox}return e},rect2pointArray:function(k){var b=this.chart.surface,f=b.getBBox(k,true),l=[f.x,f.y],d=l.slice(),j=[f.x+f.width,f.y],a=j.slice(),i=[f.x+f.width,f.y+f.height],e=i.slice(),h=[f.x,f.y+f.height],c=h.slice(),g=k.matrix;l[0]=g.x.apply(g,d);l[1]=g.y.apply(g,d);j[0]=g.x.apply(g,a);j[1]=g.y.apply(g,a);i[0]=g.x.apply(g,e);i[1]=g.y.apply(g,e);h[0]=g.x.apply(g,c);h[1]=g.y.apply(g,c);return[l,j,i,h]},intersect:function(c,a){var d=this.rect2pointArray(c),b=this.rect2pointArray(a);return !!Ext.draw.Draw.intersect(d,b).length},drawHorizontalLabels:function(){var C=this,e=C.label,w=Math.floor,u=Math.max,v=C.chart.axes,g=C.chart.insetPadding,f=C.chart.maxGutters,D=C.position,j=C.inflections,n=j.length,B=C.labels,r=0,h,c,s,o,b,A=C.adjustEnd,a=v.findIndex("position","left")!=-1,m=v.findIndex("position","right")!=-1,z,q,l,p,k,t,d;l=n-1;s=j[0];d=C.getOrCreateLabel(0,C.label.renderer(B[0]));h=Math.floor(Math.abs(Math.sin(e.rotate&&(e.rotate.degrees*Math.PI/180)||0)));for(t=0;t<n;t++){s=j[t];q=C.label.renderer(B[t]);z=C.getOrCreateLabel(t,q);c=z._bbox;r=u(r,c.height+C.dashSize+C.label.padding);p=w(s[0]-(h?c.height:c.width)/2);if(A&&f.left==0&&f.right==0){if(t==0&&!a){p=s[0]}else{if(t==l&&!m){p=Math.min(p,s[0]-c.width+g)}}}if(D=="top"){k=s[1]-(C.dashSize*2)-C.label.padding-(c.height/2)}else{k=s[1]+(C.dashSize*2)+C.label.padding+(c.height/2)}z.setAttributes({hidden:false,x:p,y:k},true);if(t!=0&&(C.intersect(z,o)||C.intersect(z,d))){if(t===l&&b!==0){o.hide(true)}else{z.hide(true);continue}}o=z;b=t}return r},drawVerticalLabels:function(){var B=this,f=B.inflections,C=B.position,j=f.length,o=B.chart,e=o.insetPadding,A=B.labels,u=0,r=Math.max,t=Math.floor,c=Math.ceil,s=B.chart.axes,d=B.chart.maxGutters,b,p,k,a,n=s.findIndex("position","top")!=-1,v=s.findIndex("position","bottom")!=-1,z=B.adjustEnd,w,m,h=j-1,l,g,q;for(q=0;q<j;q++){p=f[q];m=B.label.renderer(A[q]);w=B.getOrCreateLabel(q,m);b=w._bbox;u=r(u,b.width+B.dashSize+B.label.padding);g=p[1];if(z&&(d.bottom+d.top)<b.height/2){if(q==h&&!n){g=Math.max(g,B.y-B.length+c(b.height/2)-e)}else{if(q==0&&!v){g=B.y+d.bottom-t(b.height/2)}}}if(C=="left"){l=p[0]-b.width-B.dashSize-B.label.padding-2}else{l=p[0]+B.dashSize+B.label.padding+2}w.setAttributes(Ext.apply({hidden:false,x:l,y:g},B.label),true);if(q!=0&&B.intersect(w,k)){if(q===h&&a!==0){k.hide(true)}else{w.hide(true);continue}}k=w;a=q}return u},drawLabel:function(){var g=this,a=g.position,b=g.labelGroup,h=g.inflections,f=0,e=0,d,c;if(a=="left"||a=="right"){f=g.drawVerticalLabels()}else{e=g.drawHorizontalLabels()}d=b.getCount();c=h.length;for(;c<d;c++){b.getAt(c).hide(true)}g.bbox={};Ext.apply(g.bbox,g.axisBBox);g.bbox.height=e;g.bbox.width=f;if(Ext.isString(g.title)){g.drawTitle(f,e)}},setTitle:function(a){this.title=a;this.drawLabel()},drawTitle:function(k,l){var g=this,f=g.position,b=g.chart.surface,c=g.displaySprite,j=g.title,e=(f=="left"||f=="right"),i=g.x,h=g.y,a,m,d;if(c){c.setAttributes({text:j},true)}else{a={type:"text",x:0,y:0,text:j};c=g.displaySprite=b.add(Ext.apply(a,g.axisTitleStyle,g.labelTitle));b.renderItem(c)}m=c.getBBox();d=g.dashSize+g.label.padding;if(e){h-=((g.length/2)-(m.height/2));if(f=="left"){i-=(k+d+(m.width/2))}else{i+=(k+d+m.width-(m.width/2))}g.bbox.width+=m.width+10}else{i+=(g.length/2)-(m.width*0.5);if(f=="top"){h-=(l+d+(m.height*0.3))}else{h+=(l+d+(m.height*0.8))}g.bbox.height+=m.height+10}c.setAttributes({translate:{x:i,y:h}},true)}});