Ext.define("Ext.chart.Label",{requires:["Ext.draw.Color"],colorStringRe:/url\s*\(\s*#([^\/)]+)\s*\)/,constructor:function(a){var b=this;b.label=Ext.applyIf(b.label||{},{display:"none",stackedDisplay:"none",color:"#000",field:"name",minMargin:50,font:"11px Helvetica, sans-serif",orientation:"horizontal",renderer:Ext.identityFn});if(b.label.display!=="none"){b.labelsGroup=b.chart.surface.getGroup(b.seriesId+"-labels")}},renderLabels:function(){var p=this,Q=p.chart,z=Q.gradients,s=p.items,L=Q.animate,D=p.label,v=D.display,d=D.stackedDisplay,y=D.renderer,w=D.color,e=[].concat(D.field),r=p.labelsGroup,l=(r||0)&&r.length,b=p.chart.getChartStore(),q=b.getCount(),h=(s||0)&&s.length,G=h/q,C=(z||0)&&z.length,m=Ext.draw.Color,P=[],o,O,I,c,B,N,K,f,g,u,x,J,R,t,T,F,E,a,A,S,H,n,M;if(v=="none"||!r){return}if(h==0){while(l--){P.push(l)}}else{for(O=0,I=0,c=0;O<q;O++){B=0;for(N=0;N<G;N++){x=s[I];J=r.getAt(c);R=b.getAt(O);while(this.__excludes&&this.__excludes[B]){B++}if(!x&&J){J.hide(true);c++}if(x&&e[N]){if(!J){J=p.onCreateLabel(R,x,O,v);if(!J){break}}J.setAttributes({fill:String(w)},true);p.onPlaceLabel(J,R,x,O,v,L,B);c++;if(D.contrast&&x.sprite){t=x.sprite;if(L&&t._endStyle){a=t._endStyle.fill}else{if(L&&t._to){a=t._to.fill}else{a=t.attr.fill}}a=a||t.attr.fill;T=m.fromString(a);if(a&&!T){a=a.match(p.colorStringRe)[1];for(K=0;K<C;K++){o=z[K];if(o.id==a){u=0;f=0;for(g in o.stops){u++;f+=m.fromString(o.stops[g].color).getGrayscale()}F=(f/u)/255;break}}}else{F=T.getGrayscale()/255}if(J.isOutside){F=1}E=m.fromString(J.attr.fill||J.attr.color).getHSL();E[2]=F>0.5?0.2:0.8;J.setAttributes({fill:String(m.fromHSL.apply({},E))},true)}if(p.stacked&&d&&(x.totalPositiveValues||x.totalNegativeValues)){S=(x.totalPositiveValues||0);H=(x.totalNegativeValues||0);A=S+H;if(d=="total"){n=y(A)}else{if(d=="balances"){if(S==0&&H==0){n=y(0)}else{n=y(S);M=y(H)}}}if(n){J=r.getAt(c);if(!J){J=p.onCreateLabel(R,x,O,"over")}E=m.fromString(J.attr.color||J.attr.fill).getHSL();J.setAttributes({text:n,style:D.font,fill:String(m.fromHSL.apply({},E))},true);p.onPlaceLabel(J,R,x,O,"over",L,B);c++}if(M){J=r.getAt(c);if(!J){J=p.onCreateLabel(R,x,O,"under")}E=m.fromString(J.attr.color||J.attr.fill).getHSL();J.setAttributes({text:M,style:D.font,fill:String(m.fromHSL.apply({},E))},true);p.onPlaceLabel(J,R,x,O,"under",L,B);c++}}}I++;B++}}l=r.length;while(l>c){P.push(c);c++}}p.hideLabels(P)},hideLabels:function(b){var a=this.labelsGroup,c=!!b&&b.length;if(!a){return}if(c===false){c=a.getCount();while(c--){a.getAt(c).hide(true)}}else{while(c--){a.getAt(b[c]).hide(true)}}}});