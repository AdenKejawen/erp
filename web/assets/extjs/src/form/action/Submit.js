Ext.define("Ext.form.action.Submit",{extend:"Ext.form.action.Action",alternateClassName:"Ext.form.Action.Submit",alias:"formaction.submit",type:"submit",run:function(){var b=this,a=b.form;if(b.clientValidation===false||a.isValid()){b.doSubmit()}else{b.failureType=Ext.form.action.Action.CLIENT_INVALID;a.afterAction(b,false)}},doSubmit:function(){var e=this,b=Ext.apply(e.createCallback(),{url:e.getUrl(),method:e.getMethod(),headers:e.headers}),d=e.form,f=e.jsonSubmit||d.jsonSubmit,a=f?"jsonData":"params",c,g;if(d.hasUpload()){g=e.buildForm();b.form=g.formEl;b.isUpload=true}else{b[a]=e.getParams(f)}Ext.Ajax.request(b);if(g){e.cleanup(g)}},cleanup:function(g){var e=g.formEl,d=g.uploadEls,b=g.uploadFields,a=b.length,c,f;for(c=0;c<a;++c){f=b[c];if(!f.clearOnSubmit){f.restoreInput(d[c])}}if(e){Ext.removeNode(e)}},getParams:function(d){var c=false,b=this.callParent(),a=this.form.getValues(c,c,this.submitEmptyText!==c,d);return Ext.apply({},a,b)},buildForm:function(){var j=this,m=[],k,r,g=j.form,d=j.getParams(),c=[],a=[],f=g.getFields().items,e,h=f.length,l,q,o,p,n,b;for(e=0;e<h;++e){l=f[e];if(l.rendered&&l.isFileUpload()){c.push(l)}}for(q in d){if(d.hasOwnProperty(q)){o=d[q];if(Ext.isArray(o)){n=o.length;for(p=0;p<n;p++){m.push(j.getFieldConfig(q,o[p]))}}else{m.push(j.getFieldConfig(q,o))}}}k={tag:"form",action:j.getUrl(),method:j.getMethod(),target:j.target||"_self",style:"display:none",cn:m};if(c.length){k.encoding=k.enctype="multipart/form-data"}r=Ext.DomHelper.append(Ext.getBody(),k);h=c.length;for(e=0;e<h;++e){b=c[e].extractFileInput();r.appendChild(b);a.push(b)}return{formEl:r,uploadFields:c,uploadEls:a}},getFieldConfig:function(a,b){return{tag:"input",type:"hidden",name:a,value:Ext.String.htmlEncode(b)}},onSuccess:function(b){var c=this.form,d=true,a=this.processResponse(b);if(a!==true&&!a.success){if(a.errors){c.markInvalid(a.errors)}this.failureType=Ext.form.action.Action.SERVER_INVALID;d=false}c.afterAction(this,d)},handleResponse:function(d){var a=this.form,c=a.errorReader,f,k,g,h,b,l;if(c){f=c.read(d);b=f.records;k=[];if(b){for(g=0,h=b.length;g<h;g++){k[g]=b[g].data}}if(k.length<1){k=null}l={success:f.success,errors:k}}else{try{l=Ext.decode(d.responseText)}catch(j){l={success:false,errors:[]}}}return l}});