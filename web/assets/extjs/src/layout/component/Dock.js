Ext.define("Ext.layout.component.Dock",{extend:"Ext.layout.component.Component",alias:"layout.dock",alternateClassName:"Ext.layout.component.AbstractDock",type:"dock",initializedBorders:-1,horizontalCollapsePolicy:{width:true,x:true},verticalCollapsePolicy:{height:true,y:true},finishRender:function(){var b=this,c,a;b.callParent();c=b.getRenderTarget();a=b.getDockedItems();b.finishRenderItems(c,a)},isItemBoxParent:function(a){return true},isItemShrinkWrap:function(a){return true},dockOpposites:{top:"bottom",right:"left",bottom:"top",left:"right"},handleItemBorders:function(){var l=this,a=l.owner,k,o,e=l.borders,g=l.dockOpposites,b=a.dockedItems.generation,f,j,n,m,h,c,d=l.collapsed;if(l.initializedBorders==b||(a.border&&!a.manageBodyBorders)){return}l.initializedBorders=b;l.collapsed=false;o=l.getLayoutItems();l.collapsed=d;k={top:[],right:[],bottom:[],left:[]};for(f=0,j=o.length;f<j;f++){n=o[f];m=n.dock;if(n.ignoreBorderManagement){continue}if(!k[m].satisfied){k[m].push(n);k[m].satisfied=true}if(!k.top.satisfied&&g[m]!=="top"){k.top.push(n)}if(!k.right.satisfied&&g[m]!=="right"){k.right.push(n)}if(!k.bottom.satisfied&&g[m]!=="bottom"){k.bottom.push(n)}if(!k.left.satisfied&&g[m]!=="left"){k.left.push(n)}}if(e){for(h in e){if(e.hasOwnProperty(h)){j=e[h].length;if(!a.manageBodyBorders){for(f=0;f<j;f++){c=e[h][f];if(!c.isDestroyed){c.removeCls(Ext.baseCSSPrefix+"docked-noborder-"+h)}}if(!e[h].satisfied&&!a.bodyBorder){a.removeBodyCls(Ext.baseCSSPrefix+"docked-noborder-"+h)}}else{if(e[h].satisfied){a.setBodyStyle("border-"+h+"-width","")}}}}}for(h in k){if(k.hasOwnProperty(h)){j=k[h].length;if(!a.manageBodyBorders){for(f=0;f<j;f++){k[h][f].addCls(Ext.baseCSSPrefix+"docked-noborder-"+h)}if((!k[h].satisfied&&!a.bodyBorder)||a.bodyBorder===false){a.addBodyCls(Ext.baseCSSPrefix+"docked-noborder-"+h)}}else{if(k[h].satisfied){a.setBodyStyle("border-"+h+"-width","1px")}}}}l.borders=k},beforeLayoutCycle:function(e){var c=this,b=c.owner,f=c.sizeModels.shrinkWrap,d,a;if(b.collapsed){if(b.collapsedVertical()){a=true;e.measureDimensions=1}else{d=true;e.measureDimensions=2}}e.collapsedVert=a;e.collapsedHorz=d;if(a){e.heightModel=f}else{if(d){e.widthModel=f}}},beginLayout:function(d){var j=this,c=j.owner,m=j.getLayoutItems(),b=d.context,f=m.length,k,h,l,a,e,g;j.callParent(arguments);j.handleItemBorders();g=c.getCollapsed();if(g!==j.lastCollapsedState&&Ext.isDefined(j.lastCollapsedState)){if(j.owner.collapsed){d.isCollapsingOrExpanding=1;c.addClsWithUI(c.collapsedCls)}else{d.isCollapsingOrExpanding=2;c.removeClsWithUI(c.collapsedCls);d.lastCollapsedState=j.lastCollapsedState}}j.lastCollapsedState=g;d.dockedItems=k=[];for(h=0;h<f;h++){l=m[h];if(l.rendered){a=b.getCmp(l);a.dockedAt={x:0,y:0};a.offsets=e=Ext.Element.parseBox(l.offsets||0);e.width=e.left+e.right;e.height=e.top+e.bottom;k.push(a)}}d.bodyContext=d.getEl("body")},beginLayoutCycle:function(b){var e=this,k=b.dockedItems,d=k.length,a=e.owner,f=a.frameBody,j=e.lastHeightModel,c,h,g;e.callParent(arguments);if(j&&j.shrinkWrap&&!b.heightModel.shrinkWrap&&!e.owner.manageHeight){a.body.dom.style.marginBottom=""}if(b.widthModel.auto){if(b.widthModel.shrinkWrap){a.el.setWidth(null)}a.body.setWidth(null);if(f){f.setWidth(null)}}if(b.heightModel.auto){a.body.setHeight(null);if(f){f.setHeight(null)}}if(b.collapsedVert){b.setContentHeight(0)}else{if(b.collapsedHorz){b.setContentWidth(0)}}for(c=0;c<d;c++){h=k[c].target;g=h.dock;if(g=="right"){h.setLocalX(0)}else{if(g!="left"){continue}}}},calculate:function(d){var j=this,c=j.measureAutoDimensions(d,d.measureDimensions),b=d.state,i=b.horzDone,e=b.vertDone,f=d.bodyContext,a,h,g,k;d.borderInfo||d.getBorderInfo();d.paddingInfo||d.getPaddingInfo();d.framingInfo||d.getFraming();f.borderInfo||f.getBorderInfo();f.paddingInfo||f.getPaddingInfo();a=!i&&j.createAxis(d,c.contentWidth,d.widthModel,"left","right","x","width","Width",d.collapsedHorz);h=!e&&j.createAxis(d,c.contentHeight,d.heightModel,"top","bottom","y","height","Height",d.collapsedVert);for(g=0,k=d.dockedItems.length;k--;++g){if(a){j.dockChild(d,a,k,g)}if(h){j.dockChild(d,h,k,g)}}if(a&&j.finishAxis(d,a)){b.horzDone=i=a}if(h&&j.finishAxis(d,h)){b.vertDone=e=h}if(i&&e&&j.finishConstraints(d,i,e)){j.finishPositions(d,i,e)}else{j.done=false}},createAxis:function(n,i,e,m,h,r,l,j,d){var t=0,b=this.owner,f=b["max"+j],c=b["min"+j]||0,k=f!=null,s="set"+j,p,a,q,o,g;if(e.shrinkWrap){if(d){g=0}else{a=n.bodyContext;g=i+a.borderInfo[l]}}else{p=n.borderInfo;q=n.framingInfo;o=n.paddingInfo;g=n.getProp(l);g-=p[h]+o[h]+q[h];t=p[m]+o[m]+q[m]}return{shrinkWrap:e.shrinkWrap,sizeModel:e,begin:t,end:g,collapsed:d,horizontal:r=="x",ignoreFrameBegin:false,ignoreFrameEnd:false,initialSize:g-t,hasMinMaxConstraints:(c||k)&&e.shrinkWrap,minSize:c,maxSize:k?f:1000000000,bodyPosProp:this.owner.manageHeight?r:("margin-"+m),dockBegin:m,dockEnd:h,posProp:r,sizeProp:l,sizePropCap:j,setSize:s,dockedPixelsEnd:0}},dockChild:function(b,c,i,d){var e=this,a=b.dockedItems[c.shrinkWrap?i:d],g=a.target,h=g.dock,f;if(g.ignoreParentFrame&&b.isCollapsingOrExpanding){a.clearMarginCache()}if(h==c.dockBegin){if(c.shrinkWrap){f=e.dockOutwardBegin(b,a,g,c)}else{f=e.dockInwardBegin(b,a,g,c)}}else{if(h==c.dockEnd){if(c.shrinkWrap){f=e.dockOutwardEnd(b,a,g,c)}else{f=e.dockInwardEnd(b,a,g,c)}}else{f=e.dockStretch(b,a,g,c)}}a.dockedAt[c.posProp]=f},dockInwardBegin:function(f,e,d,b){var h=b.begin,g=b.sizeProp,a,c;if(d.ignoreParentFrame){c=d.dock;h-=f.borderInfo[c]+f.paddingInfo[c]+f.framingInfo[c]}if(!d.overlay){a=e.getProp(g)+e.getMarginInfo()[g];b.begin+=a}return h},dockInwardEnd:function(e,d,c,b){var g=b.sizeProp,a=d.getProp(g)+d.getMarginInfo()[g],f=b.end-a;if(!c.overlay){b.end=f}if(c.ignoreParentFrame){f+=e.borderInfo[c.dock]+e.paddingInfo[c.dock]+e.framingInfo[c.dock]}return f},dockOutwardBegin:function(f,e,d,b){var h=b.begin,g=b.sizeProp,c,a;if(b.collapsed){b.ignoreFrameBegin=b.ignoreFrameEnd=true}else{if(d.ignoreParentFrame){c=d.dock;h-=f.borderInfo[c]+f.paddingInfo[c]+f.framingInfo[c];b.ignoreFrameBegin=true}}if(!d.overlay){a=e.getProp(g)+e.getMarginInfo()[g];h-=a;b.begin=h}return h},dockOutwardEnd:function(f,e,d,b){var h=b.end,g=b.sizeProp,c,a;a=e.getProp(g)+e.getMarginInfo()[g];if(b.collapsed){b.ignoreFrameBegin=b.ignoreFrameEnd=true}else{if(d.ignoreParentFrame){c=d.dock;h+=f.borderInfo[c]+f.paddingInfo[c]+f.framingInfo[c];b.ignoreFrameEnd=true}}if(!d.overlay){b.end=h+a;b.dockedPixelsEnd+=a}return h},dockStretch:function(c,b,m,d){var n=m.dock,i=d.sizeProp,a=n=="top"||n=="bottom",e=b.offsets,h=c.borderInfo,l=c.paddingInfo,g=a?"right":"bottom",p=a?"left":"top",k=d.begin+e[p],f,o,j;if(m.stretch!==false){o=d.end-k-e[g];if(m.ignoreParentFrame){j=c.framingInfo;k-=h[p]+l[p]+j[p];o+=h[i]+l[i]+j[i]}f=b.getMarginInfo();o-=f[i];b[d.setSize](o)}return k},finishAxis:function(c,e){var n=e.end-e.begin,k=e.setSize,d=e.dockBegin,h=e.dockEnd,i=c.borderInfo,l=c.paddingInfo,j=c.framingInfo,g=l[d]+i[d]+j[d],f=c.bodyContext,m,a,b;if(e.shrinkWrap){e.delta=-e.begin;a=e.initialSize;if(e.ignoreFrameBegin){e.delta-=i[d];m=-e.begin-g}else{n+=g;e.delta+=l[d]+j[d];m=-e.begin}if(!e.ignoreFrameEnd){n+=l[h]+i[h]+j[h]}e.size=n;if(!e.horizontal&&!this.owner.manageHeight){b=false}}else{e.delta=-i[e.dockBegin];a=n;m=e.begin-g}f[k](a,b);f.setProp(e.bodyPosProp,m);return !isNaN(n)},finishConstraints:function(e,a,g){var i=this.sizeModels,k=a.shrinkWrap,b=g.shrinkWrap,c,j,d,f,h,l;if(k){l=a.size;if(l<a.minSize){h=i.constrainedMin;d=a.minSize}else{if(l>a.maxSize){h=i.constrainedMax;d=a.maxSize}else{d=l}}}if(b){l=g.size;if(l<g.minSize){f=i.constrainedMin;j=g.minSize}else{if(l>g.maxSize){f=i.constrainedMax;j=g.maxSize}else{if(!e.collapsedVert&&!this.owner.manageHeight){c=false;e.bodyContext.setProp("margin-bottom",g.dockedPixelsEnd)}j=l}}}if(h||f){if(h&&f&&h.constrainedMax&&f.constrainedMin){e.invalidate({widthModel:h});return false}if(!e.widthModel.calculatedFromShrinkWrap&&!e.heightModel.calculatedFromShrinkWrap){e.invalidate({widthModel:h,heightModel:f});return false}}if(k){e.setWidth(d);if(h){e.widthModel=h}}if(b){e.setHeight(j,c);if(f){e.heightModel=f}}return true},finishPositions:function(d,a,g){var i=d.dockedItems,c=i.length,f=a.delta,e=g.delta,h,b;for(h=0;h<c;++h){b=i[h];b.setProp("x",f+b.dockedAt.x);b.setProp("y",e+b.dockedAt.y)}},finishedLayout:function(b){var a=this,c=b.target;a.callParent(arguments);if(!b.animatePolicy){if(b.isCollapsingOrExpanding===1){c.afterCollapse(false)}else{if(b.isCollapsingOrExpanding===2){c.afterExpand(false)}}}},getAnimatePolicy:function(c){var b=this,a,d;if(c.isCollapsingOrExpanding==1){a=b.lastCollapsedState}else{if(c.isCollapsingOrExpanding==2){a=c.lastCollapsedState}}if(a=="left"||a=="right"){d=b.horizontalCollapsePolicy}else{if(a=="top"||a=="bottom"){d=b.verticalCollapsePolicy}}return d},getDockedItems:function(c,m){var h=this,e=(c==="visual"),j=e?Ext.ComponentQuery.query("[rendered]",h.owner.dockedItems.items):h.owner.dockedItems.items,g=j&&j.length&&c!==false,b,l,k,f,d,a;if(m==null){k=g&&!e?j.slice():j}else{k=[];for(f=0,a=j.length;f<a;++f){l=j[f].dock;d=(l=="top"||l=="left");if(m?d:!d){k.push(j[f])}}g=g&&k.length}if(g){b=(c=c||"render")=="render";Ext.Array.sort(k,function(n,i){var o,p;if(b&&((o=h.owner.dockOrder[n.dock])!==(p=h.owner.dockOrder[i.dock]))){if(!(o+p)){return o-p}}o=h.getItemWeight(n,c);p=h.getItemWeight(i,c);if((o!==undefined)&&(p!==undefined)){return o-p}return 0})}return k||[]},getItemWeight:function(b,a){var c=b.weight||this.owner.defaultDockWeights[b.dock];return c[a]||c},getLayoutItems:function(){var e=this,b,f,d,c,a;if(e.owner.collapsed){a=e.owner.getCollapsedDockedItems()}else{b=e.getDockedItems("visual");f=b.length;a=[];for(c=0;c<f;c++){d=b[c];if(!d.hidden){a.push(d)}}}return a},measureContentWidth:function(a){var b=a.bodyContext;return b.el.getWidth()-b.getBorderInfo().width},measureContentHeight:function(a){var b=a.bodyContext;return b.el.getHeight()-b.getBorderInfo().height},redoLayout:function(c){var b=this,a=b.owner;if(c.isCollapsingOrExpanding==1){if(a.reExpander){a.reExpander.el.show()}a.addClsWithUI(a.collapsedCls);c.redo(true)}else{if(c.isCollapsingOrExpanding==2){a.removeClsWithUI(a.collapsedCls);c.bodyContext.redo()}}},renderChildren:function(){var b=this,a=b.getDockedItems(),c=b.getRenderTarget();b.renderItems(a,c)},renderItems:function(h,g){var k=this,c=h.length,a=0,b=0,o=0,l=k.getRenderTarget().dom.childNodes,m=l.length,f,d,e,n;for(f=0,d=0;f<m;f++){e=l[f];if(Ext.fly(e).hasCls("x-resizable-handle")){break}for(d=0;d<c;d++){n=h[d];if(n.rendered&&n.el.dom===e){break}}if(d===c){o++}}for(;a<c;a++,b++){n=h[a];if(a===b&&(n.dock==="right"||n.dock==="bottom")){b+=o}if(n&&!n.rendered){k.renderItem(n,g,b)}else{if(!k.isValidParent(n,g,b)){k.moveItem(n,g,b)}}}},undoLayout:function(c){var b=this,a=b.owner;if(c.isCollapsingOrExpanding==1){if(a.reExpander){a.reExpander.el.hide()}a.removeClsWithUI(a.collapsedCls);c.undo(true)}else{if(c.isCollapsingOrExpanding==2){a.addClsWithUI(a.collapsedCls);c.bodyContext.undo()}}},sizePolicy:{nostretch:{setsWidth:0,setsHeight:0},stretchH:{setsWidth:1,setsHeight:0},stretchV:{setsWidth:0,setsHeight:1},autoStretchH:{readsWidth:1,setsWidth:1,setsHeight:0},autoStretchV:{readsHeight:1,setsWidth:0,setsHeight:1}},getItemSizePolicy:function(c){var d=this.sizePolicy,b,a;if(c.stretch===false){return d.nostretch}b=c.dock;a=(b=="left"||b=="right");if(a){return d.stretchV}return d.stretchH},configureItem:function(a,b){this.callParent(arguments);a.addCls(Ext.baseCSSPrefix+"docked");a.addClsWithUI(this.getDockCls(a.dock))},getDockCls:function(a){return"docked-"+a},afterRemove:function(a){this.callParent(arguments);if(this.itemCls){a.el.removeCls(this.itemCls+"-"+a.dock)}var b=a.el.dom;if(!a.destroying&&b){b.parentNode.removeChild(b)}this.childrenChanged=true}});