Ext.define("Ext.layout.container.boxOverflow.Menu",{extend:"Ext.layout.container.boxOverflow.None",requires:["Ext.toolbar.Separator","Ext.button.Button"],alternateClassName:"Ext.layout.boxOverflow.Menu",noItemsMenuText:'<div class="'+Ext.baseCSSPrefix+'toolbar-no-items">(None)</div>',constructor:function(b){var a=this;a.callParent(arguments);a.triggerButtonCls=a.triggerButtonCls||Ext.baseCSSPrefix+"box-menu-"+b.names.afterX;a.menuItems=[]},beginLayout:function(a){this.callParent(arguments);this.clearOverflow(a)},beginLayoutCycle:function(b,a){this.callParent(arguments);if(!a){this.clearOverflow(b);this.layout.cacheChildItems(b)}},onRemove:function(a){Ext.Array.remove(this.menuItems,a)},getSuffixConfig:function(){var c=this,b=c.layout,a=b.owner.id;c.menu=new Ext.menu.Menu({listeners:{scope:c,beforeshow:c.beforeMenuShow}});c.menuTrigger=new Ext.button.Button({id:a+"-menu-trigger",cls:Ext.layout.container.Box.prototype.innerCls+" "+c.triggerButtonCls+" "+Ext.baseCSSPrefix+"toolbar-item",hidden:true,ownerCt:b.owner,ownerLayout:b,iconCls:Ext.baseCSSPrefix+c.getOwnerType(b.owner)+"-more-icon",ui:b.owner instanceof Ext.toolbar.Toolbar?"default-toolbar":"default",menu:c.menu,showEmptyMenu:true,getSplitCls:function(){return""}});return c.menuTrigger.getRenderTree()},getOverflowCls:function(){return Ext.baseCSSPrefix+this.layout.direction+"-box-overflow-body"},handleOverflow:function(d){var c=this,b=c.layout,f=b.names,e=d.state.boxPlan,a=[null,null];c.showTrigger(d);a[f.heightIndex]=(e.maxSize-c.menuTrigger[f.getHeight]())/2;c.menuTrigger.setPosition.apply(c.menuTrigger,a);return{reservedSpace:c.menuTrigger[f.getWidth]()+c.menuTrigger.el.getMargin(f.parallelMargins)}},captureChildElements:function(){var a=this.menuTrigger;if(a.rendering){a.finishRender()}},_asLayoutRoot:{isRoot:true},clearOverflow:function(g){var f=this,b=f.menuItems,e,c=0,d=b.length,a=f.layout.owner,h=f._asLayoutRoot;a.suspendLayouts();f.captureChildElements();f.hideTrigger();a.resumeLayouts();for(;c<d;c++){e=b[c];e.suspendLayouts();e.show();e.resumeLayouts(h)}b.length=0},showTrigger:function(c){var n=this,j=n.layout,a=j.owner,m=j.names,q=m.x,e=m.width,o=c.state.boxPlan,b=o.targetSize[e],g=c.childItems,k=g.length,f=n.menuTrigger,p,h,d,l;f.suspendLayouts();f.show();f.resumeLayouts(n._asLayoutRoot);b-=n.menuTrigger.getWidth();a.suspendLayouts();n.menuItems.length=0;for(d=0;d<k;d++){p=g[d];l=p.props;if(l[q]+l[e]>b){h=p.target;n.menuItems.push(h);h.hide()}}a.resumeLayouts()},hideTrigger:function(){var a=this.menuTrigger;if(a){a.hide()}},beforeMenuShow:function(h){var g=this,b=g.menuItems,d=0,a=b.length,f,e,c=function(j,i){return j.isXType("buttongroup")&&!(i instanceof Ext.toolbar.Separator)};h.suspendLayouts();g.clearMenu();h.removeAll();for(;d<a;d++){f=b[d];if(!d&&(f instanceof Ext.toolbar.Separator)){continue}if(e&&(c(f,e)||c(e,f))){h.add("-")}g.addComponentToMenu(h,f);e=f}if(h.items.length<1){h.add(g.noItemsMenuText)}h.resumeLayouts()},createMenuConfig:function(c,a){var b=Ext.apply({},c.initialConfig),d=c.toggleGroup,e;Ext.copyTo(b,c,["iconCls","icon","itemId","disabled","handler","scope","menu"]);Ext.apply(b,{text:c.overflowText||c.text,hideOnClick:a,destroyMenu:false,listeners:{}});if(c.isFormField){b.value=c.getValue();b.listeners.change=function(h,g,f){c.setValue(g)}}else{if(d||c.enableToggle){Ext.apply(b,{hideOnClick:false,group:d,checked:c.pressed,listeners:{checkchange:function(g,f){c.toggle(f)}}})}}if(c.isButton&&!c.changeListenersAdded){c.on({textchange:this.onButtonAttrChange,iconchange:this.onButtonAttrChange});c.changeListenersAdded=true}delete b.ownerCt;delete b.xtype;delete b.id;return b},onButtonAttrChange:function(a){var b=a.overflowClone;b.suspendLayouts();b.setText(a.text);b.setIcon(a.icon);b.setIconCls(a.iconCls);b.resumeLayouts(true)},addComponentToMenu:function(f,c){var e=this,d,b,a;if(c instanceof Ext.toolbar.Separator){f.add("-")}else{if(c.isComponent){if(c.isXType("splitbutton")){c.overflowClone=f.add(e.createMenuConfig(c,true))}else{if(c.isXType("button")){c.overflowClone=f.add(e.createMenuConfig(c,!c.menu))}else{if(c.isXType("buttongroup")){b=c.items.items;a=b.length;for(d=0;d<a;d++){e.addComponentToMenu(f,b[d])}}else{c.overflowClone=f.add(Ext.create(Ext.getClassName(c),e.createMenuConfig(c)))}}}}}},clearMenu:function(){var e=this.menu,b,c,a,d;if(e&&e.items){b=e.items.items;a=b.length;for(c=0;c<a;c++){d=b[c];if(d.setMenu){d.setMenu(null)}}}},destroy:function(){var a=this.menuTrigger;if(a&&!this.layout.owner.items.contains(a)){delete a.ownerCt}Ext.destroy(this.menu,a)}});