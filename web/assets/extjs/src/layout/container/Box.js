Ext.define("Ext.layout.container.Box",{alias:["layout.box"],extend:"Ext.layout.container.Container",alternateClassName:"Ext.layout.BoxLayout",requires:["Ext.layout.container.boxOverflow.None","Ext.layout.container.boxOverflow.Menu","Ext.layout.container.boxOverflow.Scroller","Ext.util.Format","Ext.dd.DragDropManager"],defaultMargins:{top:0,right:0,bottom:0,left:0},padding:0,pack:"start",flex:undefined,stretchMaxPartner:undefined,alignRoundingMethod:"round",type:"box",scrollOffset:0,itemCls:Ext.baseCSSPrefix+"box-item",targetCls:Ext.baseCSSPrefix+"box-layout-ct",targetElCls:Ext.baseCSSPrefix+"box-target",innerCls:Ext.baseCSSPrefix+"box-inner",availableSpaceOffset:0,reserveOffset:true,manageMargins:true,createsInnerCt:true,childEls:["innerCt","targetEl"],renderTpl:["{%var oc,l=values.$comp.layout,oh=l.overflowHandler;","if (oh.getPrefixConfig!==Ext.emptyFn) {","if(oc=oh.getPrefixConfig())dh.generateMarkup(oc, out)","}%}",'<div id="{ownerId}-innerCt" class="{[l.innerCls]} {[oh.getOverflowCls()]}" role="presentation">','<div id="{ownerId}-targetEl" class="{targetElCls}">',"{%this.renderBody(out, values)%}","</div>","</div>","{%if (oh.getSuffixConfig!==Ext.emptyFn) {","if(oc=oh.getSuffixConfig())dh.generateMarkup(oc, out)","}%}",{disableFormats:true,definitions:"var dh=Ext.DomHelper;"}],constructor:function(a){var c=this,b;c.callParent(arguments);c.flexSortFn=Ext.Function.bind(c.flexSort,c);c.initOverflowHandler();b=typeof c.padding;if(b=="string"||b=="number"){c.padding=Ext.util.Format.parseBox(c.padding);c.padding.height=c.padding.top+c.padding.bottom;c.padding.width=c.padding.left+c.padding.right}},_percentageRe:/^\s*(\d+(?:\.\d*)?)\s*[%]\s*$/,getItemSizePolicy:function(n,o){var j=this,h=j.sizePolicy,g=j.align,f=n.flex,l=g,i=j.names,b=n[i.width],m=n[i.height],d=j._percentageRe,c=d.test(b),e=(g=="stretch"),a=(g=="stretchmax"),k=j.constrainAlign;if(!o&&(e||f||c||(k&&!a))){o=j.owner.getSizeModel()}if(e){if(!d.test(m)&&o[i.height].shrinkWrap){l="stretchmax"}}else{if(!a){if(d.test(m)){l="stretch"}else{if(k&&!o[i.height].shrinkWrap){l="stretchmax"}else{l=""}}}}if(f||c){if(!o[i.width].shrinkWrap){h=h.flex}}return h[l]},flexSort:function(l,k){var i=this.names.maxWidth,e=this.names.minWidth,j=Infinity,h=l.target,o=k.target,p=0,c,m,g,d,n,f;g=h[i]||j;d=o[i]||j;c=h[e]||0;m=o[e]||0;n=isFinite(c)||isFinite(m);f=isFinite(g)||isFinite(d);if(n||f){if(f){p=g-d}if(p===0&&n){p=m-c}}return p},isItemBoxParent:function(a){return true},isItemShrinkWrap:function(a){return true},roundFlex:function(a){return Math.ceil(a)},beginCollapse:function(b){var a=this;if(a.direction==="vertical"&&b.collapsedVertical()){b.collapseMemento.capture(["flex"]);delete b.flex}else{if(a.direction==="horizontal"&&b.collapsedHorizontal()){b.collapseMemento.capture(["flex"]);delete b.flex}}},beginExpand:function(a){a.collapseMemento.restore(["flex"])},beginLayout:function(d){var c=this,a=c.owner,f=a.stretchMaxPartner,b=c.innerCt.dom.style,e=c.names;d.boxNames=e;c.overflowHandler.beginLayout(d);if(typeof f==="string"){f=Ext.getCmp(f)||a.query(f)[0]}d.stretchMaxPartner=f&&d.context.getCmp(f);c.callParent(arguments);d.innerCtContext=d.getEl("innerCt",c);c.scrollParallel=a.scrollFlags[e.x];c.scrollPerpendicular=a.scrollFlags[e.y];if(c.scrollParallel){c.scrollPos=a.getTargetEl().dom[e.scrollLeft]}b.width="";b.height=""},beginLayoutCycle:function(e,a){var d=this,g=d.align,f=e.boxNames,b=d.pack,c=f.heightModel;d.overflowHandler.beginLayoutCycle(e,a);d.callParent(arguments);e.parallelSizeModel=e[f.widthModel];e.perpendicularSizeModel=e[c];e.boxOptions={align:g={stretch:g=="stretch",stretchmax:g=="stretchmax",center:g==f.center,bottom:g==f.afterY},pack:b={center:b=="center",end:b=="end"}};if(g.stretch&&e.perpendicularSizeModel.shrinkWrap){g.stretchmax=true;g.stretch=false}g.nostretch=!(g.stretch||g.stretchmax);if(e.parallelSizeModel.shrinkWrap){b.center=b.end=false}d.cacheFlexes(e);d.targetEl.setWidth(20000)},cacheFlexes:function(j){var t=this,k=j.boxNames,a=k.widthModel,d=k.heightModel,c=j.boxOptions.align.nostretch,n=0,b=j.childItems,p=b.length,r=[],l=0,h=k.minWidth,f=t._percentageRe,q=0,s=0,e,m,o,g;while(p--){m=b[p];e=m.target;if(m[a].calculated){m.flex=o=e.flex;if(o){n+=o;r.push(m);l+=e[h]||0}else{g=f.exec(e[k.width]);m.percentageParallel=parseFloat(g[1])/100;++q}}if(c&&m[d].calculated){g=f.exec(e[k.height]);m.percentagePerpendicular=parseFloat(g[1])/100;++s}}j.flexedItems=r;j.flexedMinSize=l;j.totalFlex=n;j.percentageWidths=q;j.percentageHeights=s;Ext.Array.sort(r,t.flexSortFn)},calculate:function(e){var c=this,b=c.getContainerSize(e),g=e.boxNames,d=e.state,f=d.boxPlan||(d.boxPlan={}),a=e.targetContext;f.targetSize=b;if(!e.parallelSizeModel.shrinkWrap&&!b[g.gotWidth]){c.done=false;return}if(!d.parallelDone){d.parallelDone=c.calculateParallel(e,g,f)}if(!d.perpendicularDone){d.perpendicularDone=c.calculatePerpendicular(e,g,f)}if(d.parallelDone&&d.perpendicularDone){if(c.owner.dock&&(Ext.isIE7m||Ext.isIEQuirks)&&!c.owner.width&&!c.horizontal){f.isIEVerticalDock=true;f.calculatedWidth=f.maxSize+e.getPaddingInfo().width+e.getFrameInfo().width;if(a!==e){f.calculatedWidth+=a.getPaddingInfo().width}}c.publishInnerCtSize(e,c.reserveOffset?c.availableSpaceOffset:0);if(c.done&&(e.childItems.length>1||e.stretchMaxPartner)&&e.boxOptions.align.stretchmax&&!d.stretchMaxDone){c.calculateStretchMax(e,g,f);d.stretchMaxDone=true}c.overflowHandler.calculate(e)}else{c.done=false}},calculateParallel:function(j,m,b){var E=this,y=m.width,a=j.childItems,r=m.beforeX,d=m.afterX,p=m.setWidth,z=a.length,w=j.flexedItems,q=w.length,u=j.boxOptions.pack,l=E.padding,g=b.targetSize[y],A=0,e=l[r],D=e+l[d]+E.scrollOffset+(E.reserveOffset?E.availableSpaceOffset:0),v=Ext.getScrollbarSize()[m.width],t,k,f,x,n,s,C,o,B,c,h;if(v&&E.scrollPerpendicular&&j.parallelSizeModel.shrinkWrap&&!j.boxOptions.align.stretch&&!j.perpendicularSizeModel.shrinkWrap){if(!j.state.perpendicularDone){return false}B=true}for(t=0;t<z;++t){n=a[t];k=n.marginInfo||n.getMarginInfo();A+=k[y];if(!n[m.widthModel].calculated){c=n.getProp(y);D+=c;if(isNaN(D)){return false}}}D+=A;if(j.percentageWidths){h=g-A;if(isNaN(h)){return false}for(t=0;t<z;++t){n=a[t];if(n.percentageParallel){c=Math.ceil(h*n.percentageParallel);c=n.setWidth(c);D+=c}}}if(j.parallelSizeModel.shrinkWrap){b.availableSpace=0;b.tooNarrow=false}else{b.availableSpace=g-D;b.tooNarrow=b.availableSpace<j.flexedMinSize;if(b.tooNarrow&&Ext.getScrollbarSize()[m.height]&&E.scrollParallel&&j.state.perpendicularDone){j.state.perpendicularDone=false;for(t=0;t<z;++t){a[t].invalidate()}}}o=D;f=b.availableSpace;x=j.totalFlex;for(t=0;t<q;t++){n=w[t];s=n.flex;C=E.roundFlex((s/x)*f);C=n[p](C);o+=C;f=Math.max(0,f-C);x-=s}if(u.center){e+=f/2;if(e<0){e=0}}else{if(u.end){e+=f}}for(t=0;t<z;++t){n=a[t];k=n.marginInfo;e+=k[r];n.setProp(m.x,e);e+=k[d]+n.props[y]}o+=j.targetContext.getPaddingInfo()[y];j.state.contentWidth=o;if(B&&(j.peek(m.contentHeight)>b.targetSize[m.height])){o+=v;j[m.hasOverflowY]=true;j.target.componentLayout[m.setWidthInDom]=true;j[m.invalidateScrollY]=Ext.isStrict&&Ext.isIE8}j[m.setContentWidth](o);return true},calculatePerpendicular:function(t,J,y){var s=this,d=t.perpendicularSizeModel.shrinkWrap,b=y.targetSize,h=t.childItems,x=h.length,l=Math.max,k=J.height,m=J.setHeight,g=J.beforeY,r=J.y,G=s.padding,j=G[g],n=b[k]-j-G[J.afterY],D=t.boxOptions.align,o=D.stretch,p=D.stretchmax,M=D.center,L=D.bottom,F=s.constrainAlign,E=0,A=0,C=s.onBeforeConstrainInvalidateChild,z=s.onAfterConstrainInvalidateChild,a=Ext.getScrollbarSize().height,w,H,B,u,v,c,q,e,K,I,f;if(o||((M||L)&&!d)){if(isNaN(n)){return false}}if(s.scrollParallel&&y.tooNarrow){if(d){I=true}else{n-=a;y.targetSize[k]-=a}}if(o){c=n}else{for(H=0;H<x;H++){q=h[H];u=(q.marginInfo||q.getMarginInfo())[k];if(!(f=q.percentagePerpendicular)){B=q.getProp(k)}else{++A;if(d){continue}else{B=f*n-u;B=q[J.setHeight](B)}}if(!d&&F&&q[J.heightModel].shrinkWrap&&B>n){q.invalidate({before:C,after:z,layout:s,childHeight:n,names:J});t.state.parallelDone=false}if(isNaN(E=l(E,B+u,q.target[J.minHeight]||0))){return false}}if(I){E+=a;t[J.hasOverflowX]=true;t.target.componentLayout[J.setHeightInDom]=true;t[J.invalidateScrollX]=Ext.isStrict&&Ext.isIE8}e=t.stretchMaxPartner;if(e){t.setProp("maxChildHeight",E);K=e.childItems;if(K&&K.length){E=l(E,e.getProp("maxChildHeight"));if(isNaN(E)){return false}}}t[J.setContentHeight](E+s.padding[k]+t.targetContext.getPaddingInfo()[k]);if(I){E-=a}y.maxSize=E;if(p){c=E}else{if(M||L||A){if(F){c=d?E:n}else{c=d?E:l(n,E)}c-=t.innerCtContext.getBorderInfo()[k]}}}for(H=0;H<x;H++){q=h[H];u=q.marginInfo||q.getMarginInfo();w=j+u[g];if(o){q[m](c-u[k])}else{f=q.percentagePerpendicular;if(d&&f){u=q.marginInfo||q.getMarginInfo();B=f*c-u[k];B=q.setHeight(B)}if(M){v=c-q.props[k];if(v>0){w=j+Math[s.alignRoundingMethod](v/2)}}else{if(L){w=l(0,c-w-q.props[k])}}}q.setProp(r,w)}return true},onBeforeConstrainInvalidateChild:function(b,a){var c=a.names.heightModel;if(!b[c].constrainedMin){b[c]=Ext.layout.SizeModel.calculated}},onAfterConstrainInvalidateChild:function(b,a){var c=a.names;b.setProp(c.beforeY,0);if(b[c.heightModel].calculated){b[c.setHeight](a.childHeight)}},calculateStretchMax:function(c,j,l){var k=this,g=j.height,m=j.width,f=c.childItems,a=f.length,o=l.maxSize,n=k.onBeforeStretchMaxInvalidateChild,e=k.onAfterStretchMaxInvalidateChild,p,h,d,b;for(d=0;d<a;++d){p=f[d];h=p.props;b=o-p.getMarginInfo()[g];if(b!=h[g]||p[j.heightModel].constrained){p.invalidate({before:n,after:e,layout:k,childWidth:h[m],childHeight:b,childX:h.x,childY:h.y,names:j})}}},onBeforeStretchMaxInvalidateChild:function(b,a){var c=a.names.heightModel;if(!b[c].constrainedMax){b[c]=Ext.layout.SizeModel.calculated}},onAfterStretchMaxInvalidateChild:function(d,c){var e=c.names,a=c.childHeight,b=c.childWidth;d.setProp("x",c.childX);d.setProp("y",c.childY);if(d[e.heightModel].calculated){d[e.setHeight](a)}if(d[e.widthModel].calculated){d[e.setWidth](b)}},completeLayout:function(b){var i=this,h=b.boxNames,g=b.invalidateScrollX,f=b.invalidateScrollY,d,a,e,c,j;i.overflowHandler.completeLayout(b);if(g||f){a=i.getTarget();d=a.dom;j=d.style;if(g){e=a.getStyle("overflowX");if(e=="auto"){e=j.overflowX;j.overflowX="scroll"}else{g=false}}if(f){c=a.getStyle("overflowY");if(c=="auto"){c=j.overflowY;j.overflowY="scroll"}else{f=false}}if(g||f){d.scrollWidth;if(g){j.overflowX=e}if(f){j.overflowY=c}}}if(i.scrollParallel){i.owner.getTargetEl().dom[h.scrollLeft]=i.scrollPos}},finishedLayout:function(a){this.overflowHandler.finishedLayout(a);this.callParent(arguments);this.targetEl.setWidth(a.innerCtContext.props.width)},publishInnerCtSize:function(a,d){var h=this,g=a.boxNames,f=g.height,j=g.width,e=a.boxOptions.align,n=h.owner.dock,k=h.padding,i=a.state.boxPlan,c=i.targetSize,m=c[f],o=a.innerCtContext,b=(a.parallelSizeModel.shrinkWrap||(i.tooNarrow&&h.scrollParallel)?a.state.contentWidth-a.targetContext.getPaddingInfo()[j]:c[j])-(d||0),l;if(e.stretch){l=m}else{l=i.maxSize+k[g.beforeY]+k[g.afterY]+o.getBorderInfo()[f];if(!a.perpendicularSizeModel.shrinkWrap&&(e.center||e.bottom)){l=Math.max(m,l)}}o[g.setWidth](b);o[g.setHeight](l);if(isNaN(b+l)){h.done=false}if(i.calculatedWidth&&(n=="left"||n=="right")){a.setWidth(i.calculatedWidth,true,true)}},onRemove:function(a){var b=this;b.callParent(arguments);if(b.overflowHandler){b.overflowHandler.onRemove(a)}if(a.layoutMarginCap==b.id){delete a.layoutMarginCap}},initOverflowHandler:function(){var d=this,c=d.overflowHandler,b,a;if(typeof c=="string"){c={type:c}}b="None";if(c&&c.type!==undefined){b=c.type}a=Ext.layout.container.boxOverflow[b];if(a[d.type]){a=a[d.type]}d.overflowHandler=Ext.create("Ext.layout.container.boxOverflow."+b,d,c)},getRenderTarget:function(){return this.targetEl},getElementTarget:function(){return this.innerCt},calculateChildBox:Ext.deprecated(),calculateChildBoxes:Ext.deprecated(),updateChildBoxes:Ext.deprecated(),destroy:function(){Ext.destroy(this.innerCt,this.overflowHandler);this.callParent(arguments)},getRenderData:function(){var a=this.callParent();a.targetElCls=this.targetElCls;return a}});