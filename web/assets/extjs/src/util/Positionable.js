Ext.define("Ext.util.Positionable",{_positionTopLeft:["position","top","left"],_alignRe:/^([a-z]+)-([a-z]+)(\?)?$/,afterSetPosition:Ext.emptyFn,getAnchorToXY:function(){Ext.Error.raise("getAnchorToXY is not implemented in "+this.$className)},getBorderPadding:function(){Ext.Error.raise("getBorderPadding is not implemented in "+this.$className)},getLocalX:function(){Ext.Error.raise("getLocalX is not implemented in "+this.$className)},getLocalXY:function(){Ext.Error.raise("getLocalXY is not implemented in "+this.$className)},getLocalY:function(){Ext.Error.raise("getLocalY is not implemented in "+this.$className)},getX:function(){Ext.Error.raise("getX is not implemented in "+this.$className)},getXY:function(){Ext.Error.raise("getXY is not implemented in "+this.$className)},getY:function(){Ext.Error.raise("getY is not implemented in "+this.$className)},setLocalX:function(){Ext.Error.raise("setLocalX is not implemented in "+this.$className)},setLocalXY:function(){Ext.Error.raise("setLocalXY is not implemented in "+this.$className)},setLocalY:function(){Ext.Error.raise("setLocalY is not implemented in "+this.$className)},setX:function(){Ext.Error.raise("setX is not implemented in "+this.$className)},setXY:function(){Ext.Error.raise("setXY is not implemented in "+this.$className)},setY:function(){Ext.Error.raise("setY is not implemented in "+this.$className)},adjustForConstraints:function(c,b){var a=this.getConstrainVector(b,c);if(a){c[0]+=a[0];c[1]+=a[1]}return c},alignTo:function(c,a,f,b){var e=this,d=e.el;return e.setXY(e.getAlignToXY(c,a,f),d.anim&&!!b?d.anim(b):false)},anchorTo:function(g,e,b,a,i,j){var f=this,h=!Ext.isEmpty(i),c=function(){f.alignTo(g,e,b,a);Ext.callback(j,f)},d=f.getAnchor();f.removeAnchor();Ext.apply(d,{fn:c,scroll:h});Ext.EventManager.onWindowResize(c,null);if(h){Ext.EventManager.on(window,"scroll",c,null,{buffer:!isNaN(i)?i:50})}c();return f},calculateAnchorXY:function(f,h,g,d){var i=this,c=i.el,j=document,e=c.dom==j.body||c.dom==j,k=Math.round,l,b,a;f=(f||"tl").toLowerCase();d=d||{};b=d.width||e?Ext.Element.getViewWidth():i.getWidth();a=d.height||e?Ext.Element.getViewHeight():i.getHeight();switch(f){case"tl":l=[0,0];break;case"bl":l=[0,a];break;case"tr":l=[b,0];break;case"c":l=[k(b*0.5),k(a*0.5)];break;case"t":l=[k(b*0.5),0];break;case"l":l=[0,k(a*0.5)];break;case"r":l=[b,k(a*0.5)];break;case"b":l=[k(b*0.5),a];break;case"tc":l=[k(b*0.5),0];break;case"bc":l=[k(b*0.5),a];break;case"br":l=[b,a]}return[l[0]+h,l[1]+g]},convertPositionSpec:Ext.identityFn,getAlignToXY:function(i,B,e){var C=this,z=Ext.Element.getViewWidth()-10,d=Ext.Element.getViewHeight()-10,D=document,A=D.documentElement,n=D.body,w=(A.scrollLeft||n.scrollLeft||0),u=(A.scrollTop||n.scrollTop||0),a,g,r,f,s,t,p,q,v,o,m,b,c,h,k,l,j;i=Ext.get(i.el||i);if(!i||!i.dom){Ext.Error.raise({sourceClass:"Ext.util.Positionable",sourceMethod:"getAlignToXY",msg:"Attempted to align an element that doesn't exist"})}e=e||[0,0];B=(!B||B=="?"?"tl-bl?":(!(/-/).test(B)&&B!==""?"tl-"+B:B||"tl-bl")).toLowerCase();B=C.convertPositionSpec(B);a=B.match(C._alignRe);if(!a){Ext.Error.raise({sourceClass:"Ext.util.Positionable",sourceMethod:"getAlignToXY",el:i,position:B,offset:e,msg:'Attemmpted to align an element with an invalid position: "'+B+'"'})}o=a[1];m=a[2];v=!!a[3];g=C.getAnchorXY(o,true);r=C.getAnchorToXY(i,m,false);l=r[0]-g[0]+e[0];j=r[1]-g[1]+e[1];if(v){f=C.getWidth();s=C.getHeight();t=i.getRegion();b=o.charAt(0);c=o.charAt(o.length-1);h=m.charAt(0);k=m.charAt(m.length-1);p=((b=="t"&&h=="b")||(b=="b"&&h=="t"));q=((c=="r"&&k=="l")||(c=="l"&&k=="r"));if(l+f>z+w){l=q?t.left-f:z+w-f}if(l<w){l=q?t.right:w}if(j+s>d+u){j=p?t.top-s:d+u-s}if(j<u){j=p?t.bottom:u}}return[l,j]},getAnchor:function(){var b=this.el,c=(b.$cache||b.getCache()).data,a;if(!b.dom){return}a=c._anchor;if(!a){a=c._anchor={}}return a},getAnchorXY:function(d,h,b){var g=this,i=g.getXY(),a=g.el,k=document,c=a.dom==k.body||a.dom==k,j=a.getScroll(),f=c?j.left:h?0:i[0],e=c?j.top:h?0:i[1];return g.calculateAnchorXY(d,f,e,b)},getBox:function(d,g){var e=this,l=g?e.getLocalXY():e.getXY(),i=l[0],f=l[1],j=e.getWidth(),b=e.getHeight(),c,a,k;if(d){c=e.getBorderPadding();a=c.beforeX;k=c.beforeY;i+=a;f+=k;j-=(a+c.afterX);b-=(k+c.afterY)}return{x:i,left:i,0:i,y:f,top:f,1:f,width:j,height:b,right:i+j,bottom:f+b}},calculateConstrainedPosition:function(g,b,k,d){var j=this,c,h=j.floatParent,e=h?h.getTargetEl():null,a,f,i,l=false;if(k&&h){a=e.getXY();f=e.getBorderPadding();a[0]+=f.beforeX;a[1]+=f.beforeY;if(b){i=[b[0]+a[0],b[1]+a[1]]}}else{i=b}g=g||j.constrainTo||e||j.container||j.el.parent();c=(j.constrainHeader?j.header:j).getConstrainVector(g,i,d);if(c){l=b||j.getPosition(k);l[0]+=c[0];l[1]+=c[1]}return l},getConstrainVector:function(e,c,a){var h=this.getRegion(),b=[0,0],f=(this.shadow&&this.constrainShadow&&!this.shadowDisabled)?this.shadow.getShadowSize():undefined,d=false,g=this.constraintInsets;if(!(e instanceof Ext.util.Region)){e=Ext.get(e.el||e).getViewRegion()}if(g){g=Ext.isObject(g)?g:Ext.Element.parseBox(g);e.adjust(g.top,g.right,g.bottom,g.length)}if(c){h.translateBy(c[0]-h.x,c[1]-h.y)}if(a){h.right=h.left+a[0];h.bottom=h.top+a[1]}if(f){e.adjust(f[0],-f[1],-f[2],f[3])}if(h.right>e.right){d=true;b[0]=(e.right-h.right)}if(h.left+b[0]<e.left){d=true;b[0]=(e.left-h.left)}if(h.bottom>e.bottom){d=true;b[1]=(e.bottom-h.bottom)}if(h.top+b[1]<e.top){d=true;b[1]=(e.top-h.top)}return d?b:false},getOffsetsTo:function(a){var c=this.getXY(),b=Ext.fly(a.el||a,"_internal").getXY();return[c[0]-b[0],c[1]-b[1]]},getRegion:function(){var a=this.getBox();return new Ext.util.Region(a.top,a.right,a.bottom,a.left)},getViewRegion:function(){var f=this,c=f.el,a=c.dom.nodeName==="BODY",e,i,g,h,d,b,j;if(a){i=c.getScroll();d=i.left;h=i.top;b=Ext.dom.AbstractElement.getViewportWidth();j=Ext.dom.AbstractElement.getViewportHeight()}else{e=f.getBorderPadding();g=f.getXY();d=g[0]+e.beforeX;h=g[1]+e.beforeY;b=f.getWidth(true);j=f.getHeight(true)}return new Ext.util.Region(h,d+b,h+j,d)},move:function(i,b,c){var f=this,l=f.getXY(),j=l[0],h=l[1],d=[j-b,h],k=[j+b,h],g=[j,h-b],a=[j,h+b],e={l:d,left:d,r:k,right:k,t:g,top:g,up:g,b:a,bottom:a,down:a};i=i.toLowerCase();f.setXY([e[i][0],e[i][1]],c)},removeAnchor:function(){var a=this.getAnchor();if(a&&a.fn){Ext.EventManager.removeResizeListener(a.fn);if(a.scroll){Ext.EventManager.un(window,"scroll",a.fn)}delete a.fn}return this},setBox:function(e,a){var f=this,b=f.el,i=e.x,g=e.y,l=[i,g],j=e.width,d=e.height,c=(f.constrain||f.constrainHeader),k=c&&f.calculateConstrainedPosition(null,[i,g],false,[j,d]);if(k){i=k[0];g=k[1]}if(!a||!b.anim){f.setSize(j,d);f.setXY([i,g]);f.afterSetPosition(i,g)}else{f.animate(Ext.applyIf({to:{x:i,y:g,width:b.adjustWidth(j),height:b.adjustHeight(d)},listeners:{afteranimate:Ext.Function.bind(f.afterSetPosition,f,[i,g])}},a))}return f},setRegion:function(b,a){return this.setBox({x:b.left,y:b.top,width:b.right-b.left,height:b.bottom-b.top},a)},translatePoints:function(a,c){var b=this.translateXY(a,c);return{left:b.x,top:b.y}},translateXY:function(g,e){var d=this,b=d.el,h=b.getStyle(d._positionTopLeft),a=h.position=="relative",c=parseFloat(h.left),f=parseFloat(h.top),i=d.getXY();if(Ext.isArray(g)){e=g[1];g=g[0]}if(isNaN(c)){c=a?0:b.dom.offsetLeft}if(isNaN(f)){f=a?0:b.dom.offsetTop}c=(typeof g=="number")?g-i[0]+c:undefined;f=(typeof e=="number")?e-i[1]+f:undefined;return{x:c,y:f}}});