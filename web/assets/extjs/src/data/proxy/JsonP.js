Ext.define("Ext.data.proxy.JsonP",{extend:"Ext.data.proxy.Server",alternateClassName:"Ext.data.ScriptTagProxy",alias:["proxy.jsonp","proxy.scripttag"],requires:["Ext.data.JsonP"],defaultWriterType:"base",callbackKey:"callback",recordParam:"records",autoAppendParams:true,constructor:function(){this.addEvents("exception");this.callParent(arguments)},doRequest:function(a,f,b){var d=this,c=d.buildRequest(a),e=c.params;Ext.apply(c,{callbackKey:d.callbackKey,timeout:d.timeout,scope:d,disableCaching:false,callback:d.createRequestCallback(c,a,f,b)});if(d.autoAppendParams){c.params={}}c.jsonp=Ext.data.JsonP.request(c);c.params=e;a.setStarted();d.lastRequest=c;return c},createRequestCallback:function(d,a,e,b){var c=this;return function(h,f,g){delete c.lastRequest;c.processResponse(h,a,d,f,e,b)}},setException:function(b,a){b.setException(b.request.jsonp.errorType)},buildUrl:function(g){var j=this,a=j.callParent(arguments),d=g.records,e=j.getWriter(),f,c,b,h;if(e&&g.operation.allowWrite()){g=e.write(g)}f=g.params;c=f.filters,delete f.filters;if(c&&c.length){for(h=0;h<c.length;h++){b=c[h];if(b.value){f[b.property]=b.value}}}if((!e||!e.encode)&&Ext.isArray(d)&&d.length>0){f[j.recordParam]=j.encodeRecords(d)}if(j.autoAppendParams){a=Ext.urlAppend(a,Ext.Object.toQueryString(f))}return a},abort:function(){var a=this.lastRequest;if(a){Ext.data.JsonP.abort(a.jsonp)}},encodeRecords:function(b){var d=[],c=0,a=b.length;for(;c<a;c++){d.push(Ext.encode(b[c].getData()))}return d}});