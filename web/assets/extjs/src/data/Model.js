Ext.define("Ext.data.Model",{alternateClassName:"Ext.data.Record",mixins:{observable:"Ext.util.Observable"},requires:["Ext.ModelManager","Ext.data.IdGenerator","Ext.data.Field","Ext.data.Errors","Ext.data.Operation","Ext.data.validations","Ext.util.MixedCollection"],compareConvertFields:function(a,d){var c=a.convert&&a.type&&a.convert!==a.type.convert,b=d.convert&&d.type&&d.convert!==d.type.convert;if(c&&!b){return 1}if(!c&&b){return -1}return 0},itemNameFn:function(a){return a.name},onClassExtended:function(b,c,a){var d=a.onBeforeCreated;a.onBeforeCreated=function(f,C){var B=this,D=Ext.getClassName(f),q=f.prototype,w=f.prototype.superclass,h=C.validations||[],s=C.fields||[],g,l=C.associations||[],e=function(F,H){var G=0,E,I;if(F){F=Ext.Array.from(F);for(E=F.length;G<E;++G){I=F[G];if(!Ext.isObject(I)){I={model:I}}I.type=H;l.push(I)}}},t=C.idgen,z=new Ext.util.MixedCollection(false,q.itemNameFn),x=new Ext.util.MixedCollection(false,q.itemNameFn),p=w.validations,A=w.fields,k=w.associations,y,v,n,o=[],m=C.idProperty||f.prototype.idProperty,u=function(F,E,i){var G,H;if(z.events.add.firing){H=F;G=E}else{G=i;H=E.originalIndex}G.originalIndex=H;if(G.mapping===m||(G.mapping==null&&G.name===m)){G.defaultValue=undefined}},r=C.proxy||f.prototype.proxy||f.prototype.defaultProxyType,j=function(){z.sortBy(q.compareConvertFields)};f.modelName=D;q.modelName=D;if(p){h=p.concat(h)}C.validations=h;if(A){s=A.items.concat(s)}z.on({add:u,replace:u});for(v=0,n=s.length;v<n;++v){g=s[v];z.add(g.isField?g:new Ext.data.Field(g))}if(!z.get(m)){z.add(new Ext.data.Field(m))}j();z.on({add:j,replace:j});C.fields=z;if(t){C.idgen=Ext.data.IdGenerator.get(t)}e(C.belongsTo,"belongsTo");delete C.belongsTo;e(C.hasMany,"hasMany");delete C.hasMany;e(C.hasOne,"hasOne");delete C.hasOne;if(k){l=k.items.concat(l)}for(v=0,n=l.length;v<n;++v){o.push("association."+l[v].type.toLowerCase())}if(r&&!r.isProxy){if(typeof r!=="string"&&!r.type){Ext.log.warn(D+": proxy type is "+r.type)}o.push("proxy."+(typeof r==="string"?r:r.type))}Ext.require(o,function(){Ext.ModelManager.registerType(D,f);for(v=0,n=l.length;v<n;++v){y=l[v];if(y.isAssociation){y=Ext.applyIf({ownerModel:D,associatedModel:y.model},y.initialConfig)}else{Ext.apply(y,{ownerModel:D,associatedModel:y.model})}if(Ext.ModelManager.getModel(y.model)===undefined){Ext.ModelManager.registerDeferredAssociation(y)}else{x.add(Ext.data.association.Association.create(y))}}C.associations=x;d.call(B,f,C,a);f.setProxy(r);Ext.ModelManager.onModelDefined(f)})}},inheritableStatics:{setProxy:function(a){if(!a.isProxy){if(typeof a=="string"){a={type:a}}a=Ext.createByAlias("proxy."+a.type,a)}a.setModel(this);this.proxy=this.prototype.proxy=a;return a},getProxy:function(){return this.proxy},setFields:function(c,d,b){var h=this,g=h.prototype,f=g.fields,a=c?c.length:0,e=0;if(d){g.idProperty=d}if(b){g.clientIdProperty=b}if(f){f.clear()}else{f=h.prototype.fields=new Ext.util.MixedCollection(false,function(i){return i.name})}for(;e<a;e++){f.add(new Ext.data.Field(c[e]))}if(!f.get(g.idProperty)){f.add(new Ext.data.Field(g.idProperty))}h.fields=f;return f},getFields:function(){return this.prototype.fields.items},load:function(f,c){c=Ext.apply({},c);c=Ext.applyIf(c,{action:"read",id:f});var b=new Ext.data.Operation(c),d=c.scope||this,a=null,e;e=function(g){if(g.wasSuccessful()){a=g.getRecords()[0];if(!a.hasId()){a.setId(f)}Ext.callback(c.success,d,[a,g])}else{Ext.callback(c.failure,d,[a,g])}Ext.callback(c.callback,d,[a,g])};this.proxy.read(b,e,this)}},statics:{PREFIX:"ext-record",AUTO_ID:1,EDIT:"edit",REJECT:"reject",COMMIT:"commit",id:function(a){var b=[this.PREFIX,"-",this.AUTO_ID++].join("");a.phantom=true;a.internalId=b;return b}},idgen:{isGenerator:true,type:"default",generate:function(){return null},getRecId:function(a){return a.modelName+"-"+a.internalId}},editing:false,dirty:false,persistenceProperty:"data",evented:false,isModel:true,phantom:false,idProperty:"id",clientIdProperty:null,defaultProxyType:"ajax",constructor:function(h,d,n,b){h=h||{};if(d===undefined){d=h[this.idProperty]}var k=this,o=(d||d===0),j,e,l,a,m,f,c,g;k.internalId=o?d:Ext.data.Model.id(k);k.raw=n||h;if(!k.data){k.data={}}k.modified={};if(k.persistanceProperty){Ext.log.warn("Ext.data.Model: persistanceProperty has been deprecated. Use persistenceProperty instead.");k.persistenceProperty=k.persistanceProperty}c=k[k.persistenceProperty]=b||{};k.mixins.observable.constructor.call(k);if(!b){j=k.fields.items;e=j.length;g=0;if(Ext.isArray(h)){for(;g<e;g++){l=j[g];a=l.name;m=h[l.originalIndex];if(m===undefined){m=l.defaultValue}if(l.convert){m=l.convert(m,k)}if(m!==undefined){c[a]=m}}}else{for(;g<e;g++){l=j[g];a=l.name;m=h[a];if(m===undefined){m=l.defaultValue}if(l.convert){m=l.convert(m,k)}if(m!==undefined){c[a]=m}}}}k.stores=[];if(o){c[k.idProperty]=d}else{f=k.idgen.generate();if(f!=null){k.setId(f);k.phantom=true}}k.dirty=false;k.modified={};if(typeof k.init=="function"){k.init()}k.id=k.idgen.getRecId(k)},get:function(a){return this[this.persistenceProperty][a]},_singleProp:{},set:function(q,b){var i=this,g=i[i.persistenceProperty],h=i.fields,p=i.modified,n=(typeof q=="string"),o,j,f,m,e,a,c,d,k,l;if(n){l=i._singleProp;l[q]=b}else{l=q}for(a in l){if(l.hasOwnProperty(a)){k=l[a];if(h&&(j=h.get(a))&&j.convert){k=j.convert(k,i)}o=g[a];if(i.isEqual(o,k)){continue}g[a]=k;(e||(e=[])).push(a);if(j&&j.persist){if(p.hasOwnProperty(a)){if(i.isEqual(p[a],k)){delete p[a];i.dirty=false;for(m in p){if(p.hasOwnProperty(m)){i.dirty=true;break}}}}else{i.dirty=true;p[a]=o}}if(a==i.idProperty){f=true;c=o;d=k}}}if(n){delete l[q]}if(f){i.fireEvent("idchanged",i,c,d)}if(!i.editing&&e){i.afterEdit(e)}return e||null},copyFrom:function(g){if(g){var f=this,d=f.fields.items,k=d.length,h,b=0,e=f[f.persistenceProperty],c=g[g.persistenceProperty],l=f.idProperty,a,j;for(;b<k;b++){h=d[b];a=h.name;if(a!=l){j=c[a];if(j!==undefined){e[a]=j}}}if(f.phantom&&!g.phantom){f.beginEdit();f.setId(g.getId());f.endEdit(true);f.commit(true)}}},isEqual:function(d,c){if(Ext.isDate(d)&&Ext.isDate(c)){return Ext.Date.isEqual(d,c)}return d===c},beginEdit:function(){var b=this,a,c,d;if(!b.editing){b.editing=true;b.dirtySave=b.dirty;d=b[b.persistenceProperty];c=b.dataSave={};for(a in d){if(d.hasOwnProperty(a)){c[a]=d[a]}}d=b.modified;c=b.modifiedSave={};for(a in d){if(d.hasOwnProperty(a)){c[a]=d[a]}}}},cancelEdit:function(){var a=this;if(a.editing){a.editing=false;a.modified=a.modifiedSave;a[a.persistenceProperty]=a.dataSave;a.dirty=a.dirtySave;delete a.modifiedSave;delete a.dataSave;delete a.dirtySave}},endEdit:function(a,d){var c=this,b,e;a=a===true;if(c.editing){c.editing=false;b=c.dataSave;delete c.modifiedSave;delete c.dataSave;delete c.dirtySave;if(!a){if(!d){d=c.getModifiedFieldNames(b)}e=c.dirty||d.length>0;if(e){c.afterEdit(d)}}}},getModifiedFieldNames:function(d){var c=this,e=c[c.persistenceProperty],a=[],b;d=d||c.dataSave;for(b in e){if(e.hasOwnProperty(b)){if(!c.isEqual(e[b],d[b])){a.push(b)}}}return a},getChanges:function(){var a=this.modified,b={},c;for(c in a){if(a.hasOwnProperty(c)){b[c]=this.get(c)}}return b},isModified:function(a){return this.modified.hasOwnProperty(a)},setDirty:function(){var c=this,a=c.fields.items,g=a.length,e,b,d;c.dirty=true;for(d=0;d<g;d++){e=a[d];if(e.persist){b=e.name;c.modified[b]=c.get(b)}}},markDirty:function(){Ext.log.warn("Ext.data.Model: markDirty has been deprecated. Use setDirty instead.");return this.setDirty.apply(this,arguments)},reject:function(a){var c=this,b=c.modified,d;for(d in b){if(b.hasOwnProperty(d)){if(typeof b[d]!="function"){c[c.persistenceProperty][d]=b[d]}}}c.dirty=false;c.editing=false;c.modified={};if(a!==true){c.afterReject()}},commit:function(a){var b=this;b.phantom=b.dirty=b.editing=false;b.modified={};if(a!==true){b.afterCommit()}},copy:function(a){var b=this;return new b.self(b.raw,a,null,Ext.apply({},b[b.persistenceProperty]))},setProxy:function(a){if(!a.isProxy){if(typeof a==="string"){a={type:a}}a=Ext.createByAlias("proxy."+a.type,a)}a.setModel(this.self);this.proxy=a;return a},getProxy:function(){return this.proxy},validate:function(){var j=new Ext.data.Errors(),c=this.validations,e=Ext.data.validations,b,d,h,a,g,f;if(c){b=c.length;for(f=0;f<b;f++){d=c[f];h=d.field||d.name;g=d.type;a=e[g](d,this.get(h));if(!a){j.add({field:h,message:d.message||e[g+"Message"]})}}}return j},isValid:function(){return this.validate().isValid()},save:function(l){l=Ext.apply({},l);var f=this,b=f.phantom?"create":"update",k=l.scope||f,h=f.stores,c=0,e,g,d,a,j;Ext.apply(l,{records:[f],action:b});a=new Ext.data.Operation(l);j=function(i){d=[f,i];if(i.wasSuccessful()){for(e=h.length;c<e;c++){g=h[c];g.fireEvent("write",g,i);g.fireEvent("datachanged",g)}Ext.callback(l.success,k,d)}else{Ext.callback(l.failure,k,d)}Ext.callback(l.callback,k,d)};f.getProxy()[b](a,j,f);return f},destroy:function(l){l=Ext.apply({records:[this],action:"destroy"},l);var f=this,a=f.phantom!==true,k=l.scope||f,h=f.stores,c=0,e,g,d,b,j;b=new Ext.data.Operation(l);j=function(i){d=[f,i];if(i.wasSuccessful()){for(e=h.length;c<e;c++){g=h[c];g.remove(f,true);if(a){g.fireEvent("write",g,i)}}f.clearListeners();Ext.callback(l.success,k,d)}else{Ext.callback(l.failure,k,d)}Ext.callback(l.callback,k,d)};if(a){f.getProxy().destroy(b,j,f)}else{b.complete=b.success=true;b.resultSet=f.getProxy().reader.nullResultSet;j(b)}return f},getId:function(){return this.get(this.idProperty)},getObservableId:function(){return this.id},setId:function(b){var a=this;a.set(a.idProperty,b);a.phantom=!a.hasId(b)},hasId:function(a){if(arguments.length===0){a=this.getId()}return(a||a===0)},join:function(a){Ext.Array.include(this.stores,a);this.store=this.stores[0]},unjoin:function(a){Ext.Array.remove(this.stores,a);this.store=this.stores[0]||null},afterEdit:function(a){this.callStore("afterEdit",a)},afterReject:function(){this.callStore("afterReject")},afterCommit:function(){this.callStore("afterCommit")},callStore:function(f){var d=Ext.Array.clone(arguments),b=this.stores,e=0,a=b.length,c,g;d[0]=this;for(;e<a;++e){c=b[e];if(c&&typeof c[f]=="function"){c[f].apply(c,d)}g=c.treeStore;if(g&&typeof g[f]=="function"){g[f].apply(g,d)}}},getData:function(c){var d=this,a=d.fields.items,h=a.length,g={},b,e;for(e=0;e<h;e++){b=a[e].name;g[b]=d.get(b)}if(c===true){Ext.apply(g,d.getAssociatedData())}return g},getAssociatedData:function(){return this.prepareAssociatedData({},1)},prepareAssociatedData:function(v,y){var x=this,s=x.associations.items,e=s.length,w={},p=[],u=[],l=[],n,b,a,m,f,k,h,t,g,c,r,q,d,z;for(r=0;r<e;r++){c=s[r];t=c.associationId;h=v[t];if(h&&h!==y){continue}v[t]=y;d=c.type;z=c.name;if(d=="hasMany"){n=x[c.storeName];w[z]=[];if(n&&n.getCount()>0){b=n.data.items;g=b.length;for(q=0;q<g;q++){a=b[q];w[z][q]=a.getData();p.push(a);u.push(z);l.push(q)}}}else{if(d=="belongsTo"||d=="hasOne"){a=x[c.instanceName];if(a!==undefined){w[z]=a.getData();p.push(a);u.push(z);l.push(-1)}}}}for(r=0,g=p.length;r<g;++r){a=p[r];m=w[u[r]];f=l[r];k=a.prepareAssociatedData(v,y+1);if(f===-1){Ext.apply(m,k)}else{Ext.apply(m[f],k)}}return w}});