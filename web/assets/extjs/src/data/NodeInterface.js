Ext.define("Ext.data.NodeInterface",{requires:["Ext.data.Field","Ext.data.writer.Json"],statics:{decorate:function(b){var a,c,d;if(typeof b=="string"){b=Ext.ModelManager.getModel(b)}else{if(b.isModel){b=Ext.ModelManager.getModel(b.modelName)}}if(b.prototype.isNode){return}a=b.prototype.idProperty;c=b.prototype.fields.get(a);d=b.prototype.fields.get(a).type.type;b.override(this.getPrototypeBody());this.applyFields(b,[{name:"parentId",type:d,defaultValue:null,useNull:c.useNull},{name:"index",type:"int",defaultValue:0,persist:false,convert:null},{name:"depth",type:"int",defaultValue:0,persist:false,convert:null},{name:"expanded",type:"bool",defaultValue:false,persist:false,convert:null},{name:"expandable",type:"bool",defaultValue:true,persist:false,convert:null},{name:"checked",type:"auto",defaultValue:null,persist:false,convert:null},{name:"leaf",type:"bool",defaultValue:false},{name:"cls",type:"string",defaultValue:"",persist:false,convert:null},{name:"iconCls",type:"string",defaultValue:"",persist:false,convert:null},{name:"icon",type:"string",defaultValue:"",persist:false,convert:null},{name:"root",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"isLast",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"isFirst",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"allowDrop",type:"boolean",defaultValue:true,persist:false,convert:null},{name:"allowDrag",type:"boolean",defaultValue:true,persist:false,convert:null},{name:"loaded",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"loading",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"href",type:"string",defaultValue:"",persist:false,convert:null},{name:"hrefTarget",type:"string",defaultValue:"",persist:false,convert:null},{name:"qtip",type:"string",defaultValue:"",persist:false,convert:null},{name:"qtitle",type:"string",defaultValue:"",persist:false,convert:null},{name:"qshowDelay",type:"int",defaultValue:0,persist:false,convert:null},{name:"children",type:"auto",defaultValue:null,persist:false,convert:null}])},applyFields:function(c,b){var g=c.prototype,a=g.fields,f=a.keys,e=b.length,h,d;for(d=0;d<e;d++){h=b[d];if(!Ext.Array.contains(f,h.name)){a.add(new Ext.data.Field(h))}}},getPrototypeBody:function(){var a={idchanged:true,append:true,remove:true,move:true,insert:true,beforeappend:true,beforeremove:true,beforemove:true,beforeinsert:true,expand:true,collapse:true,beforeexpand:true,beforecollapse:true,sort:true,rootchange:true};return{isNode:true,constructor:function(){var b=this;b.callParent(arguments);b.firstChild=b.lastChild=b.parentNode=b.previousSibling=b.nextSibling=null;b.childNodes=[];return b},createNode:function(b){if(!b.isModel){b=Ext.ModelManager.create(b,this.modelName)}if(!b.childNodes){b.firstChild=b.lastChild=b.parentNode=b.previousSibling=b.nextSibling=null;b.childNodes=[]}return b},isLeaf:function(){return this.get("leaf")===true},setFirstChild:function(b){this.firstChild=b},setLastChild:function(b){this.lastChild=b},updateInfo:function(h,d){var m=this,l=m.data.depth,o={},c=m.childNodes,g=c.length,j,f=m.phantom,e=m[m.persistenceProperty],k,b,n;if(!d){Ext.Error.raise("NodeInterface expects update info to be passed")}for(k in d){n=m.fields.get(k);b=d[k];if(n&&n.persist){m.dirty=m.dirty||!m.isEqual(e[k],b)}e[k]=b}if(h){m.commit();m.phantom=f}if(m.data.depth!==l){o={depth:m.data.depth+1};for(j=0;j<g;j++){c[j].updateInfo(h,o)}}},isLast:function(){return this.get("isLast")},isFirst:function(){return this.get("isFirst")},hasChildNodes:function(){return !this.isLeaf()&&this.childNodes.length>0},isExpandable:function(){var b=this;if(b.get("expandable")){return !(b.isLeaf()||(b.isLoaded()&&!b.hasChildNodes()))}return false},triggerUIUpdate:function(){this.afterEdit([])},appendChild:function(c,k,d){var h=this,e,g,f,j,b,l={isLast:true,parentId:h.getId(),depth:(h.data.depth||0)+1};if(Ext.isArray(c)){h.callStore("suspendAutoSync");for(e=0,g=c.length-1;e<g;e++){h.appendChild(c[e],k,d)}h.callStore("resumeAutoSync");h.appendChild(c[g],k,d)}else{c=h.createNode(c);if(k!==true&&h.fireEventArgs("beforeappend",[h,c])===false){return false}f=h.childNodes.length;j=c.parentNode;if(j){if(k!==true&&c.fireEventArgs("beforemove",[c,j,h,f])===false){return false}j.removeChild(c,false,false,true)}Ext.suspendLayouts();f=h.childNodes.length;if(f===0){h.setFirstChild(c)}h.childNodes[f]=c;c.parentNode=h;c.nextSibling=null;h.setLastChild(c);b=h.childNodes[f-1];if(b){c.previousSibling=b;b.nextSibling=c;b.updateInfo(d,{isLast:false});b.triggerUIUpdate()}else{c.previousSibling=null}l.isFirst=f===0;l.index=f;c.updateInfo(d,l);if(!h.isLoaded()){h.set("loaded",true)}else{if(h.childNodes.length===1){h.triggerUIUpdate()}}if(f&&h.childNodes[f-1].isExpanded()){h.childNodes[f-1].cascadeBy(h.triggerUIUpdate)}if(!c.isLeaf()&&c.phantom){c.set("loaded",true)}Ext.resumeLayouts(true);if(k!==true){h.fireEventArgs("append",[h,c,f]);if(j){c.fireEventArgs("move",[c,j,h,f])}}return c}},getOwnerTree:function(){var c=this,b;while(c.parentNode){c=c.parentNode}b=c.store;if(b){if(b.treeStore){b=b.treeStore}if(b.tree){return b.ownerTree}}return undefined},removeChild:function(c,h,k,j){var g=this,f=g.indexOf(c),e,d,b;if(f===-1||(k!==true&&g.fireEventArgs("beforeremove",[g,c,!!j])===false)){return false}Ext.suspendLayouts();Ext.Array.erase(g.childNodes,f,1);if(g.firstChild===c){g.setFirstChild(c.nextSibling)}if(g.lastChild===c){g.setLastChild(c.previousSibling)}if(b=c.previousSibling){c.previousSibling.nextSibling=c.nextSibling}if(c.nextSibling){c.nextSibling.previousSibling=c.previousSibling;if(f===0){c.nextSibling.updateInfo(false,{isFirst:true})}for(e=f,d=g.childNodes.length;e<d;e++){g.childNodes[e].updateInfo(false,{index:e})}}else{if(b){b.updateInfo(false,{isLast:true});if(b.isExpanded()){b.cascadeBy(g.triggerUIUpdate)}else{b.triggerUIUpdate()}}}if(!g.childNodes.length){g.triggerUIUpdate()}Ext.resumeLayouts(true);if(k!==true){c.removeContext={parentNode:c.parentNode,previousSibling:c.previousSibling,nextSibling:c.nextSibling};c.previousSibling=c.nextSibling=c.parentNode=null;g.fireEventArgs("remove",[g,c,!!j]);c.removeContext=null}if(h){c.destroy(true)}else{c.clear()}return c},copy:function(e,d){var g=this,c=g.callParent(arguments),b=g.childNodes?g.childNodes.length:0,f;if(d){for(f=0;f<b;f++){c.appendChild(g.childNodes[f].copy(undefined,true))}}return c},clear:function(b){var c=this;c.parentNode=c.previousSibling=c.nextSibling=null;if(b){c.firstChild=c.lastChild=null}},destroy:function(c){var e=this,d=e.destroyOptions,b=e.childNodes,f=b.length,g;if(c===true){e.clear(true);for(g=0;g<f;g++){b[g].destroy(true)}e.childNodes=null;delete e.destroyOptions;e.callParent([d])}else{e.destroyOptions=c;e.remove(true)}},insertBefore:function(c,g,l){var h=this,f=h.indexOf(g),j=c.parentNode,k=f,d,b,e;if(!g){return h.appendChild(c)}if(c===g){return false}c=h.createNode(c);if(l!==true&&h.fireEventArgs("beforeinsert",[h,c,g])===false){return false}if(j===h&&h.indexOf(c)<f){k--}if(j){if(l!==true&&c.fireEventArgs("beforemove",[c,j,h,f,g])===false){return false}j.removeChild(c,false,false,true)}if(k===0){h.setFirstChild(c)}Ext.Array.splice(h.childNodes,k,0,c);c.parentNode=h;c.nextSibling=g;g.previousSibling=c;b=h.childNodes[k-1];if(b){c.previousSibling=b;b.nextSibling=c}else{c.previousSibling=null}c.updateInfo(false,{parentId:h.getId(),index:k,isFirst:k===0,isLast:false,depth:(h.data.depth||0)+1});for(e=k+1,d=h.childNodes.length;e<d;e++){h.childNodes[e].updateInfo(false,{index:e})}if(!h.isLoaded()){h.set("loaded",true)}else{if(h.childNodes.length===1){h.triggerUIUpdate()}}if(!c.isLeaf()&&c.phantom){c.set("loaded",true)}if(l!==true){h.fireEventArgs("insert",[h,c,g]);if(j){c.fireEventArgs("move",[c,j,h,k,g])}}return c},insertChild:function(b,d){var c=this.childNodes[b];if(c){return this.insertBefore(d,c)}else{return this.appendChild(d)}},remove:function(c,d){var e=this,b=e.parentNode;if(b){b.removeChild(e,c,d)}else{if(c){e.destroy(true)}}return e},removeAll:function(d,e,j){var g=this,h=g.childNodes,c=0,b=h.length,f;if(!b){return}g.fireEventArgs("bulkremove",[g,h,false]);for(;c<b;++c){f=h[c];f.removeContext={parentNode:f.parentNode,previousSibling:f.previousSibling,nextSibling:f.nextSibling};f.previousSibling=f.nextSibling=f.parentNode=null;g.fireEventArgs("remove",[g,f,false]);f.removeContext=null;if(d){f.destroy(true)}else{f.removeAll(false,e,true)}}g.firstChild=g.lastChild=null;if(j){g.childNodes=null}else{g.childNodes.length=0;g.triggerUIUpdate()}return g},getChildAt:function(b){return this.childNodes[b]},replaceChild:function(b,e,d){var c=e?e.nextSibling:null;this.removeChild(e,false,d);this.insertBefore(b,c,d);return e},indexOf:function(b){return Ext.Array.indexOf(this.childNodes,b)},indexOfId:function(e){var d=this.childNodes,b=d.length,c=0;for(;c<b;++c){if(d[c].getId()===e){return c}}return -1},getPath:function(e,d){e=e||this.idProperty;d=d||"/";var c=[this.get(e)],b=this.parentNode;while(b){c.unshift(b.get(e));b=b.parentNode}return d+c.join(d)},getDepth:function(){return this.get("depth")},bubble:function(d,c,b){var e=this;while(e){if(d.apply(c||e,b||[e])===false){break}e=e.parentNode}},cascade:function(){if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("Ext.data.Node: cascade has been deprecated. Please use cascadeBy instead.")}return this.cascadeBy.apply(this,arguments)},cascadeBy:function(e,d,b){if(e.apply(d||this,b||[this])!==false){var g=this.childNodes,f=g.length,c;for(c=0;c<f;c++){g[c].cascadeBy(e,d,b)}}},eachChild:function(e,d,b){var g=this.childNodes,f=g.length,c;for(c=0;c<f;c++){if(e.apply(d||this,b||[g[c]])===false){break}}},findChild:function(c,d,b){return this.findChildBy(function(){return this.get(c)==d},null,b)},findChildBy:function(h,g,c){var f=this.childNodes,b=f.length,e=0,j,d;for(;e<b;e++){j=f[e];if(h.call(g||j,j)===true){return j}else{if(c){d=j.findChildBy(h,g,c);if(d!==null){return d}}}}return null},contains:function(b){return b.isAncestor(this)},isAncestor:function(b){var c=this.parentNode;while(c){if(c===b){return true}c=c.parentNode}return false},sort:function(g,c,b){var e=this.childNodes,f=e.length,d,j,h={isFirst:true};if(f>0){Ext.Array.sort(e,g);this.setFirstChild(e[0]);this.setLastChild(e[f-1]);for(d=0;d<f;d++){j=e[d];j.previousSibling=e[d-1];j.nextSibling=e[d+1];h.isLast=(d===f-1);h.index=d;j.updateInfo(false,h);h.isFirst=false;if(c&&!j.isLeaf()){j.sort(g,true,true)}}if(b!==true){this.fireEventArgs("sort",[this,e])}}},isExpanded:function(){return this.get("expanded")},isLoaded:function(){return this.get("loaded")},isLoading:function(){return this.get("loading")},isRoot:function(){return !this.parentNode},isVisible:function(){var b=this.parentNode;while(b){if(!b.isExpanded()){return false}b=b.parentNode}return true},expand:function(c,f,d){var e=this,b;if(!e.isLeaf()){if(e.isLoading()){e.on("expand",function(){e.expand(c,f,d)},e,{single:true})}else{if(!e.isExpanded()){e.fireEventArgs("beforeexpand",[e,e.onChildNodesAvailable,e,[c,f,d]])}else{if(c){b=e.getOwnerTree();e.expandChildren(true,b?b.singleExpand:false,f,d)}else{Ext.callback(f,d||e,[e.childNodes])}}}}else{Ext.callback(f,d||e)}},onChildNodesAvailable:function(c,d,g,e){var f=this,b;Ext.suspendLayouts();f.set("expanded",true);f.fireEventArgs("expand",[f,f.childNodes,false]);if(d){b=f.getOwnerTree();f.expandChildren(true,b?b.singleExpand:false,g,e)}else{Ext.callback(g,e||f,[f.childNodes])}Ext.resumeLayouts(true)},expandChildren:function(e,f,k,l){var j=this,g,c=j.childNodes,b=[],h=f?Math.min(c.length,1):c.length,d;for(g=0;g<h;++g){d=c[g];if(!d.isLeaf()){b[b.length]=d}}h=b.length;for(g=0;g<h;++g){b[g].expand(e)}if(k){Ext.callback(k,l||j,[j.childNodes])}},collapse:function(d,j,f){var g=this,c=g.isExpanded(),b=g.childNodes.length,e,h;if(!g.isLeaf()&&((!c&&d)||g.fireEventArgs("beforecollapse",[g])!==false)){Ext.suspendLayouts();if(g.isExpanded()){if(d){h=function(){for(e=0;e<b;e++){g.childNodes[e].setCollapsed(true)}};if(j){j=Ext.Function.createSequence(h,j)}else{j=h}}g.set("expanded",false);g.fireEventArgs("collapse",[g,g.childNodes,false,j?Ext.Function.bind(j,f,[g.childNodes]):null,null]);j=null}else{if(d){for(e=0;e<b;e++){g.childNodes[e].setCollapsed(true)}}}Ext.resumeLayouts(true)}Ext.callback(j,f||g,[g.childNodes])},setCollapsed:function(c){var e=this,b=e.childNodes.length,d;if(!e.isLeaf()&&e.fireEventArgs("beforecollapse",[e,Ext.emptyFn])!==false){e.data.expanded=false;e.fireEventArgs("collapse",[e,e.childNodes,false,null,null]);if(c){for(d=0;d<b;d++){e.childNodes[d].setCollapsed(true)}}}},collapseChildren:function(d,j,k){var h=this,f,b=h.childNodes,g=b.length,e=[],c;for(f=0;f<g;++f){c=b[f];if(!c.isLeaf()&&c.isLoaded()&&c.isExpanded()){e.push(c)}}g=e.length;for(f=0;f<g;++f){c=e[f];if(f===g-1){c.collapse(d,j,k)}else{c.collapse(d)}}},fireEventArgs:function(e,f){var i=Ext.data.Model.prototype.fireEventArgs,c,h,b,g,d;if(a[e]){for(h=this;c!==false&&h;h=(d=h).parentNode){if(h.hasListeners[e]){c=i.call(h,e,f)}}b=d.rootOf;if(c!==false&&b){g=b.treeStore;if(g&&g.hasListeners[e]){c=g.fireEventArgs.call(g,e,f)}if(c!==false&&b.hasListeners[e]){c=b.fireEventArgs.call(b,e,f)}}return c}else{return i.apply(this,arguments)}},serialize:function(){var c=Ext.data.writer.Json.prototype.getRecordData(this),f=this.childNodes,b=f.length,e,d;if(b>0){e=[];for(d=0;d<b;d++){e.push(f[d].serialize())}c.children=e}return c}}}}});