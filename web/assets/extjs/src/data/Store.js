Ext.define("Ext.data.Store",{extend:"Ext.data.AbstractStore",alias:"store.store",requires:["Ext.data.StoreManager","Ext.data.Model","Ext.data.proxy.Ajax","Ext.data.proxy.Memory","Ext.data.reader.Json","Ext.data.writer.Json","Ext.util.LruCache","Ext.data.Group"],uses:["Ext.ModelManager","Ext.util.Grouper"],remoteSort:false,remoteFilter:false,remoteGroup:false,groupField:undefined,groupDir:"ASC",trailingBufferZone:25,leadingBufferZone:200,pageSize:undefined,currentPage:1,clearOnPageLoad:true,loading:false,sortOnFilter:true,buffered:false,purgePageCount:5,clearRemovedOnLoad:true,defaultPageSize:25,defaultViewSize:100,addRecordsOptions:{addRecords:true},statics:{recordIdFn:function(a){return a.internalId},recordIndexFn:function(a){return a.index},grouperIdFn:function(a){return a.id||a.property},groupIdFn:function(a){return a.key}},constructor:function(b){b=Ext.apply({},b);var d=this,f=b.groupers||d.groupers,a=b.groupField||d.groupField,c,e;e=b.data||d.data;if(e){d.inlineData=e;delete b.data}if(!f&&a){f=[{property:a,direction:b.groupDir||d.groupDir}]}delete b.groupers;d.groupers=new Ext.util.MixedCollection(false,Ext.data.Store.grouperIdFn);d.groupers.addAll(d.decodeGroupers(f));d.groups=new Ext.util.MixedCollection(false,Ext.data.Store.groupIdFn);d.callParent([b]);if(d.buffered){d.data=new d.PageMap({store:d,pageSize:d.pageSize,maxSize:d.purgePageCount,listeners:{clear:d.onPageMapClear,scope:d}});d.pageRequests={};d.sortOnLoad=false;d.filterOnLoad=false}else{d.data=new Ext.util.MixedCollection(false,Ext.data.Store.recordIdFn);d.data.pageSize=d.pageSize}if(d.remoteGroup){d.remoteSort=true}c=d.proxy;e=d.inlineData;if(!d.buffered&&!d.pageSize){d.pageSize=d.defaultPageSize}if(e){if(c instanceof Ext.data.proxy.Memory){c.data=e;d.read()}else{d.add.apply(d,[e])}if(!d.remoteSort){d.sort()}delete d.inlineData}else{if(d.autoLoad){Ext.defer(d.load,10,d,[typeof d.autoLoad==="object"?d.autoLoad:undefined])}}if(d.groupers.items.length&&!d.remoteGroup){d.group(null,null,true)}},destroyStore:function(){this.callParent(arguments);if(this.buffered){this.data.clear()}},onBeforeSort:function(){var a=this.groupers;if(a.getCount()>0){this.sort(a.items,"prepend",false)}},decodeGroupers:function(e){if(!Ext.isArray(e)){if(e===undefined){e=[]}else{e=[e]}}var d=e.length,f=Ext.util.Grouper,b,c,a=[];for(c=0;c<d;c++){b=e[c];if(!(b instanceof f)){if(Ext.isString(b)){b={property:b}}b=Ext.apply({root:"data",direction:"ASC"},b);if(b.fn){b.sorterFn=b.fn}if(typeof b=="function"){b={sorterFn:b}}a.push(new f(b))}else{a.push(b)}}return a},group:function(c,h,j){var e=this,a,b,f=e.groupers.getRange(),d,g=f.length;for(d=0;d<g;d++){e.sorters.remove(f[d])}if(Ext.isArray(c)){b=c}else{if(Ext.isObject(c)){b=[c]}else{if(Ext.isString(c)){a=e.groupers.get(c);if(!a){a={property:c,direction:h||"ASC"};b=[a]}else{if(h===undefined){a.toggle()}else{a.setDirection(h)}}}}}if(b&&b.length){e.groupers.clear();e.groupers.addAll(e.decodeGroupers(b))}e.sorters.insert(0,e.groupers.getRange());if(e.remoteGroup){if(e.buffered){e.data.clear();e.loadPage(1,{groupChange:true})}else{e.load({scope:e,callback:j?null:e.fireGroupChange})}}else{e.doSort(e.generateComparator());e.constructGroups();if(!j){e.fireGroupChange()}}},getGroupField:function(){var b=this.groupers.first(),a;if(b){a=b.property}return a},constructGroups:function(){var e=this,f=this.data.items,c=f.length,b=e.groups,a,d,g,h;b.clear();for(d=0;d<c;++d){h=f[d];a=e.getGroupString(h);g=b.get(a);if(!g){g=new Ext.data.Group({key:a,store:e});b.add(a,g)}g.add(h)}},clearGrouping:function(){var c=this,d=c.groupers.items,b=d.length,a;for(a=0;a<b;a++){c.sorters.remove(d[a])}c.groupers.clear();if(c.remoteGroup){if(c.buffered){c.data.clear();c.loadPage(1,{groupChange:true})}else{c.load({scope:c,callback:c.fireGroupChange})}}else{c.groups.clear();c.sort();c.fireGroupChange()}},isGrouped:function(){return this.groupers.getCount()>0},fireGroupChange:function(){this.fireEvent("groupchange",this,this.groupers)},getGroups:function(b){var d=this.data.items,a=d.length,c=[],j={},f,g,h,e;for(e=0;e<a;e++){f=d[e];g=this.getGroupString(f);h=j[g];if(h===undefined){h={name:g,children:[]};c.push(h);j[g]=h}h.children.push(f)}return b?j[b]:c},getGroupsForGrouper:function(f,b){var d=f.length,e=[],a,c,h,j,g;for(g=0;g<d;g++){h=f[g];c=b.getGroupString(h);if(c!==a){j={name:c,grouper:b,records:[]};e.push(j)}j.records.push(h);a=c}return e},getGroupsForGrouperIndex:function(c,h){var f=this,g=f.groupers,b=g.getAt(h),a=f.getGroupsForGrouper(c,b),e=a.length,d;if(h+1<g.length){for(d=0;d<e;d++){a[d].children=f.getGroupsForGrouperIndex(a[d].records,h+1)}}for(d=0;d<e;d++){a[d].depth=h}return a},getGroupData:function(a){var b=this;if(a!==false){b.sort()}return b.getGroupsForGrouperIndex(b.data.items,0)},getGroupString:function(a){var b=this.groupers.first();if(b){return b.getGroupString(a)}return""},insert:function(d,c){var g=this,f=false,e,a,b;if(!Ext.isArray(c)){c=[c]}a=c.length;if(a){for(e=0;e<a;e++){b=g.createModel(c[e]);b.set(g.modelDefaults);c[e]=b;b.join(g);f=f||b.phantom===true}g.data.insert(d,c);if(g.snapshot){g.snapshot.addAll(c)}if(g.requireSort){g.suspendEvents();g.sort();g.resumeEvents()}if(g.isGrouped()){g.updateGroupsOnAdd(c)}g.fireEvent("add",g,c,d);g.fireEvent("datachanged",g);if(g.autoSync&&f&&!g.autoSyncSuspended){g.sync()}}return c},updateGroupsOnAdd:function(c){var g=this,b=g.groups,a=g.getGroupField(),f=c.length,e,j,h,d;for(e=0;e<f;++e){d=c[e];j=d.get(a);h=b.getByKey(j);if(!h){h=b.add(new Ext.data.Group({key:j,store:g}))}h.add(d)}},updateGroupsOnRemove:function(c){var g=this,b=g.groups,a=g.getGroupField(),f=c.length,e,j,h,d;for(e=0;e<f;++e){d=c[e];j=d.get(a);h=b.getByKey(j);if(h){h.remove(record);if(h.records.length===0){b.remove(h)}}}},updateGroupsOnUpdate:function(e,c){var h=this,a=h.getGroupField(),k=e.get(a),b=h.groups,f,d,g,j;if(c&&Ext.Array.indexOf(c,a)){g=b.items;for(d=0,f=g.length;d<f;++d){j=g[d];if(j.contains(e)){j.remove(e);break}}b.getByKey(k);if(!j){j=b.add(new Ext.data.Group({key:k,store:h}))}j.add(e)}else{b.getByKey(k).setDirty()}},add:function(b){if(this.buffered){Ext.Error.raise({msg:"add method may not be called on a buffered store"})}if(!Ext.isArray(b)){b=Array.prototype.slice.apply(arguments)}else{b=b.slice(0)}var e=this,c=0,d=b.length,a,f=!e.remoteSort&&e.sorters&&e.sorters.items.length;if(f&&d===1){return[e.addSorted(e.createModel(b[0]))]}for(;c<d;c++){a=e.createModel(b[c]);b[c]=a}if(f){e.requireSort=true}b=e.insert(e.data.length,b);delete e.requireSort;return b},addSorted:function(a){var c=this,b=c.data.findInsertionIndex(a,c.generateComparator());c.insert(b,a);return a},createModel:function(a){if(!a.isModel){a=Ext.ModelManager.create(a,this.model)}return a},onUpdate:function(a,b,c){if(this.isGrouped()){this.updateGroupsOnUpdate(a,c)}},each:function(e,c){var f=this.data.items,b=f.length,a,g;for(g=0;g<b;g++){a=f[g];if(e.call(c||a,a,g,b)===false){break}}},remove:function(f,o){if(!Ext.isArray(f)){f=[f]}o=o===true;var m=this,n=false,a=m.snapshot,g=m.data,h=0,c=f.length,e=[],b=[],k=[],p,d,l,j;for(;h<c;++h){j=f[h];if(a){a.remove(j)}if(typeof j=="number"){l=j;j=g.getAt(l)}else{l=g.indexOf(j)}if(l>-1){e.push({record:j,index:l})}}e=Ext.Array.sort(e,function(q,i){var s=q.index,r=i.index;return s===i.index2?0:(s<r?-1:1)});for(h=0,c=e.length;h<c;h++){p=e[h];j=p.record;l=p.index;b.push(j);k.push(l);d=j.phantom!==true;if(!o&&d){j.removedFrom=l;m.removed.push(j)}j.unjoin(m);l=g.indexOf(j);g.remove(j);n=n||d;m.fireEvent("remove",m,j,l)}m.fireEvent("bulkremove",m,b,k);m.fireEvent("datachanged",m);if(!o&&m.autoSync&&n&&!m.autoSyncSuspended){m.sync()}},removeAt:function(b,d){var c=this,a;if(b<=c.getCount()){if(arguments.length==1){a=c.getAt(b);if(a){c.remove([a])}}else{c.remove(c.data.getRange(b,b+d-1))}}},load:function(a){var b=this;a=a||{};if(typeof a=="function"){a={callback:a}}a.groupers=a.groupers||b.groupers.items;a.page=a.page||b.currentPage;a.start=(a.start!==undefined)?a.start:(a.page-1)*b.pageSize;a.limit=a.limit||b.pageSize;a.addRecords=a.addRecords||false;if(b.buffered){a.limit=b.viewSize||b.defaultViewSize;return b.loadToPrefetch(a)}return b.callParent([a])},reload:function(l){var g=this,h,b,f,k,d,a,j,c,e=g.getCount();if(!l){l={}}if(g.buffered){delete g.totalCount;a=function(){if(g.rangeCached(h,b)){g.loading=false;g.data.un("pageAdded",a);c=g.data.getRange(h,b);g.fireEvent("load",g,c,true)}};j=Math.ceil((g.leadingBufferZone+g.trailingBufferZone)/2);h=l.start||(e?g.getAt(0).index:0);b=h+(l.count||(e?e:g.pageSize))-1;f=g.getPageFromRecordIndex(Math.max(h-j,0));k=g.getPageFromRecordIndex(b+j);g.data.clear(true);if(g.fireEvent("beforeload",g,l)!==false){g.loading=true;g.data.on("pageAdded",a);for(d=f;d<=k;d++){g.prefetchPage(d,l)}}}else{return g.callParent(arguments)}},onProxyLoad:function(b){var d=this,c=b.getResultSet(),a=b.getRecords(),e=b.wasSuccessful();if(c){d.totalCount=c.total}if(e){d.loadRecords(a,b)}d.loading=false;if(d.hasListeners.load){d.fireEvent("load",d,a,e)}if(d.hasListeners.read){d.fireEvent("read",d,a,e)}Ext.callback(b.callback,b.scope||d,[a,b,e])},getNewRecords:function(){return this.data.filterBy(this.filterNew).items},getUpdatedRecords:function(){return this.data.filterBy(this.filterUpdated).items},filter:function(e,f){if(Ext.isString(e)){e={property:e,value:f}}var d=this,a=d.decodeFilters(e),b=0,g=d.sorters.length&&d.sortOnFilter&&!d.remoteSort,c=a.length;for(;b<c;b++){d.filters.replace(a[b])}if(d.remoteFilter){delete d.totalCount;if(d.buffered){d.data.clear();d.loadPage(1)}else{d.currentPage=1;d.load()}}else{if(d.filters.getCount()){d.snapshot=d.snapshot||d.data.clone();d.data=d.data.filter(d.filters.items);if(g){d.sort()}else{d.fireEvent("datachanged",d);d.fireEvent("refresh",d)}}}},clearFilter:function(a){var b=this;b.filters.clear();if(b.remoteFilter){if(a){return}delete b.totalCount;if(b.buffered){b.data.clear();b.loadPage(1)}else{b.currentPage=1;b.load()}}else{if(b.isFiltered()){b.data=b.snapshot.clone();delete b.snapshot;if(a!==true){b.fireEvent("datachanged",b);b.fireEvent("refresh",b)}}}},isFiltered:function(){var a=this.snapshot;return !!a&&a!==this.data},filterBy:function(b,a){var c=this;c.snapshot=c.snapshot||c.data.clone();c.data=c.queryBy(b,a||c);c.fireEvent("datachanged",c);c.fireEvent("refresh",c)},queryBy:function(b,a){var c=this,d=c.snapshot||c.data;return d.filterBy(b,a||c)},query:function(g,f,h,a,e){var d=this,b=d.createFilterFn(g,f,h,a,e),c=d.queryBy(b);if(!c){c=new Ext.util.MixedCollection()}return c},loadData:function(e,a){var d=e.length,c=[],b;for(b=0;b<d;b++){c.push(this.createModel(e[b]))}this.loadRecords(c,a?this.addRecordsOptions:undefined)},loadRawData:function(e,b){var d=this,a=d.proxy.reader.read(e),c=a.records;if(a.success){d.totalCount=a.total;d.loadRecords(c,b?d.addRecordsOptions:undefined);d.fireEvent("load",d,c,true)}},loadRecords:function(b,c){var g=this,d=0,f=b.length,h,e,a=g.snapshot;if(c){h=c.start;e=c.addRecords}if(!e){delete g.snapshot;g.clearData(true)}else{if(a){a.addAll(b)}}g.data.addAll(b);if(h!==undefined){for(;d<f;d++){b[d].index=h+d;b[d].join(g)}}else{for(;d<f;d++){b[d].join(g)}}g.suspendEvents();if(g.filterOnLoad&&!g.remoteFilter){g.filter()}if(g.sortOnLoad&&!g.remoteSort){g.sort(undefined,undefined,undefined,true)}g.resumeEvents();if(g.isGrouped()){g.constructGroups()}g.fireEvent("datachanged",g);g.fireEvent("refresh",g)},loadPage:function(c,a){var b=this;b.currentPage=c;a=Ext.apply({page:c,start:(c-1)*b.pageSize,limit:b.pageSize,addRecords:!b.clearOnPageLoad},a);if(b.buffered){a.limit=b.viewSize||b.defaultViewSize;return b.loadToPrefetch(a)}b.read(a)},nextPage:function(a){this.loadPage(this.currentPage+1,a)},previousPage:function(a){this.loadPage(this.currentPage-1,a)},clearData:function(d){var c=this,a,b;if(!c.buffered){a=c.data.items;b=a.length;while(b--){a[b].unjoin(c)}}c.data.clear();if(d!==true||c.clearRemovedOnLoad){c.removed.length=0}},loadToPrefetch:function(m){var h=this,e,b,k,c=m,j=m.start,a=m.start+m.limit-1,f=Math.min(a,m.start+(h.viewSize||m.limit)-1),g=h.getPageFromRecordIndex(Math.max(j-h.trailingBufferZone,0)),l=h.getPageFromRecordIndex(a+h.leadingBufferZone),d=function(){if(h.rangeCached(j,f)){h.loading=false;b=h.data.getRange(j,f);h.data.un("pageAdded",d);if(h.hasListeners.guaranteedrange){h.guaranteeRange(j,f,m.callback,m.scope)}if(m.callback){m.callback.call(m.scope||h,b,j,a,m)}h.fireEvent("datachanged",h);h.fireEvent("refresh",h);h.fireEvent("load",h,b,true);if(m.groupChange){h.fireGroupChange()}}};if(h.fireEvent("beforeload",h,m)!==false){delete h.totalCount;h.loading=true;if(m.callback){c=Ext.apply({},m);delete m.callback}h.on("prefetch",function(n,o,i){if(o){if(k=h.getTotalCount()){h.data.on("pageAdded",d);f=Math.min(f,k-1);l=h.getPageFromRecordIndex(f);for(e=g+1;e<=l;++e){h.prefetchPage(e,c)}}else{h.fireEvent("datachanged",h);h.fireEvent("refresh",h);h.fireEvent("load",h,n,true)}}else{h.fireEvent("load",h,n,false)}},null,{single:true});h.prefetchPage(g,c)}},prefetch:function(c){var e=this,a=e.pageSize,d,b;if(a){if(e.lastPageSize&&a!=e.lastPageSize){Ext.Error.raise("pageSize cannot be dynamically altered")}if(!e.data.pageSize){e.data.pageSize=a}}else{e.pageSize=e.data.pageSize=a=c.limit}e.lastPageSize=a;if(!c.page){c.page=e.getPageFromRecordIndex(c.start);c.start=(c.page-1)*a;c.limit=Math.ceil(c.limit/a)*a}if(!e.pageRequests[c.page]){c=Ext.apply({action:"read",filters:e.filters.items,sorters:e.sorters.items,groupers:e.groupers.items,generation:e.data.generation},c);b=new Ext.data.Operation(c);if(e.fireEvent("beforeprefetch",e,b)!==false){d=e.proxy;e.pageRequests[c.page]=d.read(b,e.onProxyPrefetch,e);if(d.isSynchronous){delete e.pageRequests[c.page]}}}return e},onPageMapClear:function(){var d=this,c=d.wasLoading,a=d.pageRequests,b,e;if(d.data.events.pageadded){d.data.events.pageadded.clearListeners()}d.loading=true;d.totalCount=0;for(e in a){if(a.hasOwnProperty(e)){b=a[e];delete a[e];delete b.callback}}d.fireEvent("clear",d);d.loading=c},prefetchPage:function(e,b){var d=this,a=d.pageSize||d.defaultPageSize,f=(e-1)*d.pageSize,c=d.totalCount;if(c!==undefined&&d.getCount()===c){return}d.prefetch(Ext.applyIf({page:e,start:f,limit:a},b))},onProxyPrefetch:function(b){var d=this,c=b.getResultSet(),a=b.getRecords(),f=b.wasSuccessful(),e=b.page;if(b.generation===d.data.generation){if(c){d.totalCount=c.total;d.fireEvent("totalcountchange",d.totalCount)}if(e!==undefined){delete d.pageRequests[e]}d.loading=false;d.fireEvent("prefetch",d,a,f,b);if(f){d.cachePage(a,b.page)}Ext.callback(b.callback,b.scope||d,[a,b,f])}},cachePage:function(b,e){var d=this,a=b.length,c;if(!Ext.isDefined(d.totalCount)){d.totalCount=b.length;d.fireEvent("totalcountchange",d.totalCount)}for(c=0;c<a;c++){b[c].join(d)}d.data.addPage(e,b)},rangeCached:function(b,a){return this.data&&this.data.hasRange(b,a)},pageCached:function(a){return this.data&&this.data.hasPage(a)},rangeSatisfied:function(b,a){return this.rangeCached(b,a)},getPageFromRecordIndex:function(a){return Math.floor(a/this.pageSize)+1},onGuaranteedRange:function(d){var e=this,b=e.getTotalCount(),f=d.prefetchStart,a=(d.prefetchEnd>b-1)?b-1:d.prefetchEnd,c;a=Math.max(0,a);if(f>a){Ext.log({level:"warn",msg:"Start ("+f+") was greater than end ("+a+") for the range of records requested ("+f+"-"+d.prefetchEnd+")"+(this.storeId?' from store "'+this.storeId+'"':"")})}c=e.data.getRange(f,a);if(d.fireEvent!==false){e.fireEvent("guaranteedrange",c,f,a,d)}if(d.callback){d.callback.call(d.scope||e,c,f,a,d)}},guaranteeRange:function(e,a,d,c,b){b=Ext.apply({callback:d,scope:c},b);this.getRange(e,a,b)},prefetchRange:function(f,b){var d=this,c,a,e;if(!d.rangeCached(f,b)){c=d.getPageFromRecordIndex(f);a=d.getPageFromRecordIndex(b);d.data.maxSize=d.purgePageCount?(a-c+1)+d.purgePageCount:0;for(e=c;e<=a;e++){if(!d.pageCached(e)){d.prefetchPage(e)}}}},primeCache:function(d,a,c){var b=this;if(c===-1){d=Math.max(d-b.leadingBufferZone,0);a=Math.min(a+b.trailingBufferZone,b.totalCount-1)}else{if(c===1){d=Math.max(Math.min(d-b.trailingBufferZone,b.totalCount-b.pageSize),0);a=Math.min(a+b.leadingBufferZone,b.totalCount-1)}else{d=Math.min(Math.max(Math.floor(d-((b.leadingBufferZone+b.trailingBufferZone)/2)),0),b.totalCount-b.pageSize);a=Math.min(Math.max(Math.ceil(a+((b.leadingBufferZone+b.trailingBufferZone)/2)),0),b.totalCount-1)}}b.prefetchRange(d,a)},sort:function(){var a=this;if(a.buffered&&a.remoteSort){a.data.clear()}return a.callParent(arguments)},doSort:function(b){var e=this,a,d,c;if(e.remoteSort){if(e.buffered){e.data.clear();e.loadPage(1)}else{e.load()}}else{if(e.buffered){Ext.Error.raise({msg:"Local sorting may not be used on a buffered store"})}e.data.sortBy(b);if(!e.buffered){a=e.getRange();d=a.length;for(c=0;c<d;c++){a[c].index=c}}e.fireEvent("datachanged",e);e.fireEvent("refresh",e)}},find:function(e,d,g,f,a,c){var b=this.createFilterFn(e,d,f,a,c);return b?this.data.findIndexBy(b,null,g):-1},findRecord:function(){var b=this,a=b.find.apply(b,arguments);return a!==-1?b.getAt(a):null},createFilterFn:function(d,c,e,a,b){if(Ext.isEmpty(c)){return false}c=this.data.createValueMatcher(c,e,a,b);return function(f){return c.test(f.data[d])}},findExact:function(b,a,c){return this.data.findIndexBy(function(d){return d.isEqual(d.get(b),a)},this,c)},findBy:function(b,a,c){return this.data.findIndexBy(b,a,c)},collect:function(b,a,c){var d=this,e=(c===true&&d.snapshot)?d.snapshot:d.data;return e.collect(b,"data",a)},getCount:function(){return this.data.getCount()},getTotalCount:function(){return this.totalCount||0},getAt:function(a){return this.data.getAt(a)},getRange:function(c,f,j){if(j&&j.cb){j.callback=j.cb;Ext.Error.raise({msg:"guaranteeRange options.cb is deprecated, use options.callback"})}var g=this,h,b,d=g.totalCount-1,e=g.lastRequestStart,a,i;j=Ext.apply({prefetchStart:c,prefetchEnd:f},j);if(g.buffered){f=(f>=g.totalCount)?d:f;h=c===0?0:c-1;b=f===d?f:f+1;g.lastRequestStart=c;if(g.rangeCached(h,b)){g.onGuaranteedRange(j);i=g.data.getRange(c,f)}else{g.fireEvent("cachemiss",g,c,f);a=function(l,k){if(g.rangeCached(h,b)){g.fireEvent("cachefilled",g,c,f);g.data.un("pageAdded",a);g.onGuaranteedRange(j)}};g.data.on("pageAdded",a);g.prefetchRange(c,f)}g.primeCache(c,f,c<e?-1:1)}else{i=g.data.getRange(c,f);if(j.callback){j.callback.call(j.scope||g,i,c,f,j)}}return i},getById:function(a){return(this.snapshot||this.data).findBy(function(b){return b.getId()===a})},indexOf:function(a){return this.data.indexOf(a)},indexOfTotal:function(a){var b=a.index;if(b||b===0){return b}return this.indexOf(a)},indexOfId:function(a){return this.indexOf(this.getById(a))},removeAll:function(a){var b=this;b.clearData();if(b.snapshot){b.snapshot.clear()}if(b.data){b.data.clear()}if(a!==true){b.fireEvent("clear",b)}},first:function(a){var b=this;if(a&&b.isGrouped()){return b.aggregate(function(c){return c.length?c[0]:undefined},b,true)}else{return b.data.first()}},last:function(a){var b=this;if(a&&b.isGrouped()){return b.aggregate(function(d){var c=d.length;return c?d[c-1]:undefined},b,true)}else{return b.data.last()}},sum:function(c,a){var b=this;if(a&&b.isGrouped()){return b.aggregate(b.getSum,b,true,[c])}else{return b.getSum(b.data.items,c)}},getSum:function(b,e){var d=0,c=0,a=b.length;for(;c<a;++c){d+=b[c].get(e)}return d},count:function(a){var b=this;if(a&&b.isGrouped()){return b.aggregate(function(c){return c.length},b,true)}else{return b.getCount()}},min:function(c,a){var b=this;if(a&&b.isGrouped()){return b.aggregate(b.getMin,b,true,[c])}else{return b.getMin(b.data.items,c)}},getMin:function(b,f){var d=1,a=b.length,e,c;if(a>0){c=b[0].get(f)}for(;d<a;++d){e=b[d].get(f);if(e<c){c=e}}return c},max:function(c,a){var b=this;if(a&&b.isGrouped()){return b.aggregate(b.getMax,b,true,[c])}else{return b.getMax(b.data.items,c)}},getMax:function(c,f){var d=1,b=c.length,e,a;if(b>0){a=c[0].get(f)}for(;d<b;++d){e=c[d].get(f);if(e>a){a=e}}return a},average:function(c,a){var b=this;if(a&&b.isGrouped()){return b.aggregate(b.getAverage,b,true,[c])}else{return b.getAverage(b.data.items,c)}},getAverage:function(b,e){var c=0,a=b.length,d=0;if(b.length>0){for(;c<a;++c){d+=b[c].get(e)}return d/a}return 0},aggregate:function(g,j,e,f){f=f||[];if(e&&this.isGrouped()){var a=this.getGroups(),d=a.length,b={},h,c;for(c=0;c<d;++c){h=a[c];b[h.name]=this.getAggregate(g,j||this,h.children,f)}return b}else{return this.getAggregate(g,j,this.data.items,f)}},getAggregate:function(d,c,a,b){b=b||[];return d.apply(c||this,[a].concat(b))},commitChanges:function(){var c=this,d=c.getModifiedRecords(),a=d.length,b=0;for(;b<a;b++){d[b].commit()}c.removed.length=0},filterNewOnly:function(a){return a.phantom===true},getRejectRecords:function(){return Ext.Array.push(this.data.filterBy(this.filterNewOnly).items,this.getUpdatedRecords())},rejectChanges:function(){var c=this,d=c.getRejectRecords(),a=d.length,b=0,e;for(;b<a;b++){e=d[b];e.reject();if(e.phantom){c.remove(e)}}d=c.removed;a=d.length;for(b=0;b<a;b++){e=d[b];c.insert(e.removedFrom||0,e);e.reject()}c.removed.length=0}},function(){Ext.regStore("ext-empty-store",{fields:[],proxy:"memory"});this.prototype.PageMap=new Ext.Class({extend:"Ext.util.LruCache",clear:function(a){var b=this;b.generation=(b.generation||0)+1;b.callParent(arguments)},forEach:function(f,e){var g=this,c=g.superclass.getCount.call(g),d,b,h,a;for(d=0;d<c;d++){h=g.getPage(d+1);a=h.length;for(b=0;b<a;b++){if(f.call(e||g,h[b,b])===-1){return}}}},getPageFromRecordIndex:this.prototype.getPageFromRecordIndex,addAll:function(a){if(this.getCount()){Ext.Error.raise("Cannot addAll to a non-empty PageMap")}this.addPage(1,a)},addPage:function(a,b){var d=this,f=a+Math.floor((b.length-1)/d.pageSize),c,e;for(c=0;a<=f;a++,c+=d.pageSize){e=Ext.Array.slice(b,c,c+d.pageSize);d.add(a,e);d.fireEvent("pageAdded",a,e)}},getCount:function(){var a=this.callParent();if(a){a=(a-1)*this.pageSize+this.last.value.length}return a},indexOf:function(a){return a?a.index:-1},insert:function(){Ext.Error.raise("insert operation not suppported into buffered Store")},remove:function(){Ext.Error.raise("remove operation not suppported from buffered Store")},getPage:function(a){return this.get(a)},hasRange:function(d,b){var a=this.getPageFromRecordIndex(d),c=this.getPageFromRecordIndex(b);for(;a<=c;a++){if(!this.hasPage(a)){return false}}return true},hasPage:function(a){return !!this.get(a)},getAt:function(a){return this.getRange(a,a)[0]},getRange:function(a,b){if(!this.hasRange(a,b)){Ext.Error.raise("PageMap asked for range which it does not have")}var h=this,l=h.getPageFromRecordIndex(a),e=h.getPageFromRecordIndex(b),c=(l-1)*h.pageSize,n=(e*h.pageSize)-1,j=l,o=[],m,g,k,d=0,f;for(;j<=e;j++){if(j==l){m=a-c;k=true}else{m=0;k=false}if(j==e){g=h.pageSize-(n-b);k=true}if(k){Ext.Array.push(o,Ext.Array.slice(h.getPage(j),m,g))}else{Ext.Array.push(o,h.getPage(j))}}for(f=o.length;d<f;d++){o[d].index=a++}return o}})});