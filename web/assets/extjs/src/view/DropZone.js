Ext.define("Ext.view.DropZone",{extend:"Ext.dd.DropZone",indicatorHtml:'<div class="'+Ext.baseCSSPrefix+'grid-drop-indicator-left"></div><div class="'+Ext.baseCSSPrefix+'grid-drop-indicator-right"></div>',indicatorCls:Ext.baseCSSPrefix+"grid-drop-indicator",constructor:function(a){var b=this;Ext.apply(b,a);if(!b.ddGroup){b.ddGroup="view-dd-zone-"+b.view.id}b.callParent([b.view.el])},fireViewEvent:function(){var b=this,a;b.lock();a=b.view.fireEvent.apply(b.view,arguments);b.unlock();return a},getTargetFromEvent:function(j){var h=j.getTarget(this.view.getItemSelector()),d,c,b,f,a,g;if(!h){d=j.getPageY();for(f=0,c=this.view.getNodes(),a=c.length;f<a;f++){b=c[f];g=Ext.fly(b).getBox();if(d<=g.bottom){return b}}}return h},getIndicator:function(){var a=this;if(!a.indicator){a.indicator=new Ext.Component({html:a.indicatorHtml,cls:a.indicatorCls,ownerCt:a.view,floating:true,shadow:false})}return a.indicator},getPosition:function(c,a){var f=c.getXY()[1],b=Ext.fly(a).getRegion(),d;if((b.bottom-f)>=(b.bottom-b.top)/2){d="before"}else{d="after"}return d},containsRecordAtOffset:function(d,b,f){if(!b){return false}var a=this.view,c=a.indexOf(b),e=a.getNode(c+f,true),g=e?a.getRecord(e):null;return g&&Ext.Array.contains(d,g)},positionIndicator:function(b,c,d){var f=this,h=f.view,g=f.getPosition(d,b),j=h.getRecord(b),a=c.records,i;if(!Ext.Array.contains(a,j)&&(g=="before"&&!f.containsRecordAtOffset(a,j,-1)||g=="after"&&!f.containsRecordAtOffset(a,j,1))){f.valid=true;if(f.overRecord!=j||f.currentPosition!=g){i=Ext.fly(b).getY()-h.el.getY()-1;if(g=="after"){i+=Ext.fly(b).getHeight()}f.getIndicator().setWidth(Ext.fly(h.el).getWidth()).showAt(0,i);f.overRecord=j;f.currentPosition=g}}else{f.invalidateDrop()}},invalidateDrop:function(){if(this.valid){this.valid=false;this.getIndicator().hide()}},onNodeOver:function(c,a,f,d){var b=this;if(!Ext.Array.contains(d.records,b.view.getRecord(c))){b.positionIndicator(c,d,f)}return b.valid?b.dropAllowed:b.dropNotAllowed},notifyOut:function(c,a,f,d){var b=this;b.callParent(arguments);b.overRecord=b.currentPosition=null;b.valid=false;if(b.indicator){b.indicator.hide()}},onContainerOver:function(a,g,f){var d=this,b=d.view,c=b.dataSource.getCount();if(c){d.positionIndicator(b.all.last(),f,g)}else{d.overRecord=d.currentPosition=null;d.getIndicator().setWidth(Ext.fly(b.el).getWidth()).showAt(0,0);d.valid=true}return d.dropAllowed},onContainerDrop:function(a,c,b){return this.onNodeDrop(a,null,c,b)},onNodeDrop:function(h,a,g,f){var d=this,c=false,b={wait:false,processDrop:function(){d.invalidateDrop();d.handleNodeDrop(f,d.overRecord,d.currentPosition);c=true;d.fireViewEvent("drop",h,f,d.overRecord,d.currentPosition)},cancelDrop:function(){d.invalidateDrop();c=true}},i=false;if(d.valid){i=d.fireViewEvent("beforedrop",h,f,d.overRecord,d.currentPosition,b);if(b.wait){return}if(i!==false){if(!c){b.processDrop()}}}return i},destroy:function(){Ext.destroy(this.indicator);delete this.indicator;this.callParent()}});